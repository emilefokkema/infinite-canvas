!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.InfiniteCanvas=n():t.InfiniteCanvas=n()}(this,(function(){return function(t){var n={};function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(i,o,function(n){return t[n]}.bind(null,o));return i},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n,e){var{InfiniteCanvas:i}=e(1);t.exports=i},function(t,n,e){"use strict";e.r(n),e.d(n,"InfiniteCanvas",(function(){return Ie}));var i,o,r=function(){function t(t){this.viewBox=t}return t.prototype.restore=function(){this.viewBox.restoreState()},t.prototype.save=function(){this.viewBox.saveState()},t}(),s=function(){function t(t,n){this.x=t,this.y=n}return t.prototype.mod=function(){return Math.sqrt(this.modSq())},t.prototype.modSq=function(){return this.x*this.x+this.y*this.y},t.prototype.minus=function(n){return new t(this.x-n.x,this.y-n.y)},t.prototype.plus=function(n){return new t(this.x+n.x,this.y+n.y)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.getPerpendicular=function(){return new t(-this.y,this.x)},t.prototype.scale=function(n){return new t(n*this.x,n*this.y)},t.prototype.projectOn=function(t){return t.scale(this.dot(t)/t.modSq())},t.prototype.matrix=function(n,e,i,o){return new t(n*this.x+e*this.y,i*this.x+o*this.y)},t.prototype.inSameDirectionAs=function(t){return 0===this.cross(t)&&this.dot(t)>=0},t.prototype.isInOppositeDirectionAs=function(t){return 0===this.cross(t)&&this.dot(t)<0},t.prototype.isOnSameSideOfOriginAs=function(t,n){return this.isInSmallerAngleBetweenPoints(t,n)||t.isInSmallerAngleBetweenPoints(this,n)||n.isInSmallerAngleBetweenPoints(this,t)},t.prototype.isInSmallerAngleBetweenPoints=function(t,n){var e=t.cross(n);return e>0?t.cross(this)>=0&&this.cross(n)>=0:e<0?t.cross(this)<=0&&this.cross(n)<=0:!(t.dot(n)>0)||0===this.cross(t)&&this.dot(t)>0},t.origin=new t(0,0),t}(),a=function(){function t(t,n,e,i,o,r){this.a=t,this.b=n,this.c=e,this.d=i,this.e=o,this.f=r,this.scale=Math.sqrt(t*i-n*e)}return t.prototype.getMaximumLineWidthScale=function(){var t=this.a+this.c,n=this.b+this.d,e=this.a-this.c,i=this.b-this.d;return Math.sqrt(Math.max(t*t+n*n,e*e+i*i))},t.prototype.getRotationAngle=function(){var t=this.a/this.scale,n=this.b/this.scale;if(0===t)return n>0?Math.PI/2:3*Math.PI/2;var e=Math.atan(n/t);return t>0?n>0?e:0===n?0:2*Math.PI+e:n>0?Math.PI+e:0===n?Math.PI:Math.PI+e},t.prototype.applyToPointAtInfinity=function(t){return{direction:this.untranslated().apply(t.direction)}},t.prototype.apply=function(t){return new s(this.a*t.x+this.c*t.y+this.e,this.b*t.x+this.d*t.y+this.f)},t.prototype.untranslated=function(){var n=this.apply(s.origin),e=n.x,i=n.y;return this.before(t.translation(-e,-i))},t.prototype.before=function(n){return new t(n.a*this.a+n.c*this.b,n.b*this.a+n.d*this.b,n.a*this.c+n.c*this.d,n.b*this.c+n.d*this.d,n.a*this.e+n.c*this.f+n.e,n.b*this.e+n.d*this.f+n.f)},t.prototype.equals=function(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f},t.prototype.inverse=function(){var n=this.a*this.d-this.b*this.c;if(0==n)throw"error calculating inverse: zero determinant";return new t(this.d/n,-this.b/n,-this.c/n,this.a/n,(this.c*this.f-this.d*this.e)/n,(this.b*this.e-this.a*this.f)/n)},t.translation=function(n,e){return new t(1,0,0,1,n,e)},t.scale=function(n){return new t(n,0,0,n,0,0)},t.zoom=function(n,e,i,o,r){var s=1-i;return void 0!==o?new t(i,0,0,i,n*s+o,e*s+r):new t(i,0,0,i,n*s,e*s)},t.translateZoom=function(n,e,i,o,r,s,a,c){var u=i-n,h=o-e,p=u*u+h*h;if(0===p)throw new Error("divide by 0");var f=a-r,l=c-s,y=f*f+l*l,d=Math.sqrt(y/p);return t.zoom(n,e,d,r-n,s-e)},t.rotation=function(n,e,i){var o=Math.cos(i),r=Math.sin(i),s=1-o;return new t(o,r,-r,o,n*s+e*r,-n*r+e*s)},t.translateRotateZoom=function(n,e,i,o,r,s,a,c){var u=i-n,h=o-e,p=u*u+h*h;if(0===p)throw new Error("divide by 0");var f=a-r,l=c-s,y=n*o-e*i,d=i*u+o*h,v=n*u+e*h,g=(u*f+h*l)/p,P=(u*l-h*f)/p;return new t(g,P,-P,g,(r*d-a*v-y*l)/p,(s*d-c*v+y*f)/p)},t.identity=new t(1,0,0,1,0,0),t}(),c=function(){function t(t){this.propertyName=t}return t.prototype.changeInstanceValue=function(t,n){return this.valuesAreEqual(t[this.propertyName],n)?t:t.changeProperty(this.propertyName,n)},t.prototype.isEqualForInstances=function(t,n){return this.valuesAreEqual(t[this.propertyName],n[this.propertyName])},t.prototype.getInstructionToChange=function(t,n,e){return this.valuesAreEqual(t[this.propertyName],n[this.propertyName])?function(){}:this.changeToNewValue(n[this.propertyName],e)},t.prototype.valueIsTransformableForInstance=function(t){return!0},t}(),u=(i=function(t,n){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)},function(t,n){function e(){this.constructor=t}i(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}),h=new(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return u(n,t),n.prototype.valuesAreEqual=function(t,n){return t.equals(n)},n.prototype.changeToNewValue=function(t,n){return n.getTransformationInstruction(t)},n}(c))("transformation"),p=function(){function t(t){this.viewBox=t}return t.prototype.getTransform=function(){if(DOMMatrix){var t=this.viewBox.state.current.transformation;return new DOMMatrix([t.a,t.b,t.c,t.d,t.e,t.f])}},t.prototype.resetTransform=function(){this.viewBox.changeState((function(t){return h.changeInstanceValue(t,a.identity)}))},t.prototype.rotate=function(t){this.addTransformation(a.rotation(0,0,t))},t.prototype.scale=function(t,n){this.addTransformation(new a(t,0,0,n,0,0))},t.prototype.setTransform=function(t,n,e,i,o,r){var s,c,u,p,f,l;"number"==typeof t?(s=t,c=n,u=e,p=i,f=o,l=r):void 0!==t.a?(s=t.a,c=t.b,u=t.c,p=t.d,f=t.e,l=t.f):(s=t.m11,c=t.m12,u=t.m21,p=t.m22,f=t.m41,l=t.m42),this.viewBox.changeState((function(t){return h.changeInstanceValue(t,new a(s,c,u,p,f,l))}))},t.prototype.transform=function(t,n,e,i,o,r){this.addTransformation(new a(t,n,e,i,o,r))},t.prototype.translate=function(t,n){this.addTransformation(a.translation(t,n))},t.prototype.addTransformation=function(t){var n=this.viewBox.state.current.transformation,e=t.before(n);this.viewBox.changeState((function(t){return h.changeInstanceValue(t,e)}))},t}(),f=function(){},l=function(){},y=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),d=function(t){function n(n){var e=t.call(this)||this;return e.fillStrokeStyle=n,e}return y(n,t),n.prototype.setTransform=function(t){this.fillStrokeStyle.setTransform(t)},n.prototype.getInstructionToSetUntransformed=function(t){var n=this;return function(e){e[t]=n.fillStrokeStyle}},n.prototype.getInstructionToSetTransformed=function(t){var n=this;return function(e){e[t]=n.fillStrokeStyle}},n}(l),v=function(){function t(t){this.propName=t}return t.prototype.changeInstanceValue=function(t,n){return t.changeProperty(this.propName,n)},t.prototype.isEqualForInstances=function(t,n){return t[this.propName]===n[this.propName]},t.prototype.getInstructionToChange=function(t,n){var e=this,i=n[this.propName];return this.isEqualForInstances(t,n)?i instanceof l&&t.fillAndStrokeStylesTransformed!==n.fillAndStrokeStylesTransformed?n.fillAndStrokeStylesTransformed?i.getInstructionToSetTransformed(this.propName):i.getInstructionToSetUntransformed(this.propName):function(){}:i instanceof l?n.fillAndStrokeStylesTransformed?i.getInstructionToSetTransformed(this.propName):i.getInstructionToSetUntransformed(this.propName):function(t){t[e.propName]=n[e.propName]}},t.prototype.valueIsTransformableForInstance=function(t){return!(t[this.propName]instanceof d)},t}(),g=new v("fillStyle"),P=new v("strokeStyle"),m=function(){function t(t){this.viewBox=t}return Object.defineProperty(t.prototype,"fillStyle",{set:function(t){this.viewBox.changeState((function(n){return g.changeInstanceValue(n,t)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeStyle",{set:function(t){this.viewBox.changeState((function(n){return P.changeInstanceValue(n,t)}))},enumerable:!1,configurable:!0}),t.prototype.createLinearGradient=function(t,n,e,i){return this.viewBox.createLinearGradient(t,n,e,i)},t.prototype.createPattern=function(t,n){return this.viewBox.createPattern(t,n)},t.prototype.createRadialGradient=function(t,n,e,i,o,r){return this.viewBox.createRadialGradient(t,n,e,i,o,r)},t}(),w=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),I=new(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return w(n,t),n.prototype.valuesAreEqual=function(t,n){return t===n},n.prototype.changeToNewValue=function(t){return function(n){n.shadowColor=t}},n}(c))("shadowColor"),b=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),T=new(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return b(n,t),n.prototype.changeToNewValue=function(t){return function(n,e){var i=e.untranslated().apply(t),o=i.x,r=i.y;n.shadowOffsetX=o,n.shadowOffsetY=r}},n.prototype.valuesAreEqual=function(t,n){return t.x===n.x&&t.y==n.y},n.prototype.valuesAreEqualWhenTransformed=function(t,n){return 0===t.x&&0===t.y&&0===n.x&&0===n.y},n}(c))("shadowOffset"),S=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),x=new(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return S(n,t),n.prototype.valuesAreEqual=function(t,n){return t===n},n.prototype.changeToNewValue=function(t){return function(n,e){n.shadowBlur=t*e.scale}},n}(c))("shadowBlur"),C=function(){function t(t){this.viewBox=t}return Object.defineProperty(t.prototype,"shadowBlur",{get:function(){return this.viewBox.state.current.shadowBlur},set:function(t){this.viewBox.changeState((function(n){return x.changeInstanceValue(n,t)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowOffsetX",{get:function(){return this.viewBox.state.current.shadowOffset.x},set:function(t){var n=new s(t,this.viewBox.state.current.shadowOffset.y);this.viewBox.changeState((function(t){return T.changeInstanceValue(t,n)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowOffsetY",{get:function(){return this.viewBox.state.current.shadowOffset.y},set:function(t){var n=new s(this.viewBox.state.current.shadowOffset.x,t);this.viewBox.changeState((function(t){return T.changeInstanceValue(t,n)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowColor",{get:function(){return this.viewBox.state.current.shadowColor},set:function(t){this.viewBox.changeState((function(n){return I.changeInstanceValue(n,t)}))},enumerable:!1,configurable:!0}),t}(),_=function(){},O=function(){function t(t){this.viewBox=t}return t.prototype.clearRect=function(t,n,e,i){this.viewBox.clearArea(t,n,e,i)},t.prototype.fillRect=function(t,n,e,i){this.viewBox.fillRect(t,n,e,i,(function(t){return t.fill()}))},t.prototype.strokeRect=function(t,n,e,i){this.viewBox.strokeRect(t,n,e,i)},t}(),B=function(){function t(t){this.viewBox=t}return t.prototype.isFillRule=function(t){return"evenodd"===t||"nonzero"===t},t.prototype.beginPath=function(){this.viewBox.beginPath()},t.prototype.clip=function(t,n){var e=this.isFillRule(t)?function(n){n.clip(t)}:function(t){t.clip()};this.viewBox.clipPath(e)},t.prototype.fill=function(t,n){if(t&&!this.isFillRule(t)||this.viewBox.currentPathCanBeFilled()){var e=this.isFillRule(t)?function(n){n.fill(t)}:function(t){t.fill()};this.viewBox.fillPath(e)}},t.prototype.isPointInPath=function(t,n,e,i){return!0},t.prototype.isPointInStroke=function(t,n,e){return!0},t.prototype.stroke=function(t){this.viewBox.strokePath()},t}(),A=function(){function t(){}return t.prototype.drawFocusIfNeeded=function(t,n){},t.prototype.scrollPathIntoView=function(t){},t}();!function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(o||(o={}));var L=function(){function t(t,n,e){this.point=t,this.halfPlane1=n,this.halfPlane2=e,this.normal1=n.normalTowardInterior,this.normal2=e.normalTowardInterior}return t.prototype.isExpandableToContainPoint=function(t){return this.halfPlane1.interiorContainsPoint(t)||this.halfPlane2.interiorContainsPoint(t)},t.prototype.isInSameHalfPlaneAs=function(t){return this.halfPlane1.containsPoint(t)||this.halfPlane2.containsPoint(t)},t.prototype.getHalfPlaneContaining=function(t){return this.halfPlane1.containsPoint(t)?this.halfPlane1:this.halfPlane2},t.prototype.expandToContainPoint=function(n){var e=this.halfPlane1.interiorContainsPoint(n)?this.halfPlane1:this.halfPlane2,i=n.minus(this.point).getPerpendicular();this.isContainedByHalfPlaneWithNormal(i)||(i=i.scale(-1));var o=new D(this.point,i);return{newHalfPlane:o,newVertex:new t(this.point,e,o)}},t.prototype.isContainedByHalfPlaneWithNormal=function(t){return t.isInSmallerAngleBetweenPoints(this.normal1,this.normal2)},t.prototype.containsPoint=function(t){return this.halfPlane1.containsPoint(t)&&this.halfPlane2.containsPoint(t)},t.prototype.containsLineSegmentWithDirection=function(t){return this.containsPoint(this.point.plus(t))||this.containsPoint(this.point.minus(t))},t.prototype.isContainedByVertex=function(t){return this.isContainedByHalfPlaneWithNormal(t.normal1)&&this.isContainedByHalfPlaneWithNormal(t.normal2)},t}(),D=function(){function t(t,n){this.base=t,this.normalTowardInterior=n,this.lengthOfNormal=n.mod()}return t.prototype.getDistanceFromEdge=function(t){return t.minus(this.base).dot(this.normalTowardInterior)/this.lengthOfNormal},t.prototype.transform=function(n){var e=n.apply(this.base),i=n.apply(this.base.plus(this.normalTowardInterior.getPerpendicular())),o=n.apply(this.base.plus(this.normalTowardInterior));return t.throughPointsAndContainingPoint(e,i,o)},t.prototype.complement=function(){return new t(this.base,this.normalTowardInterior.scale(-1))},t.prototype.expandByDistance=function(n){return new t(this.base.plus(this.normalTowardInterior.scale(-n/this.normalTowardInterior.mod())),this.normalTowardInterior)},t.prototype.expandToIncludePoint=function(n){return this.containsPoint(n)?this:new t(n,this.normalTowardInterior)},t.prototype.containsPoint=function(t){return this.getDistanceFromEdge(t)>=0},t.prototype.interiorContainsPoint=function(t){return this.getDistanceFromEdge(t)>0},t.prototype.containsInfinityInDirection=function(t){return t.dot(this.normalTowardInterior)>=0},t.prototype.isContainedByHalfPlane=function(t){return this.normalTowardInterior.inSameDirectionAs(t.normalTowardInterior)&&t.getDistanceFromEdge(this.base)>=0},t.prototype.intersectWithLine=function(t,n){return{point:(e=this.base,i=this.normalTowardInterior.getPerpendicular(),o=t,r=n,s=o.minus(e),a=r.cross(i),c=r.getPerpendicular().dot(s)/a,e.plus(i.scale(c))),halfPlane:this};var e,i,o,r,s,a,c},t.prototype.isParallelToLine=function(t,n){return 0===this.normalTowardInterior.getPerpendicular().cross(n)},t.prototype.getIntersectionWith=function(t){var n=this.intersectWithLine(t.base,t.normalTowardInterior.getPerpendicular());return new L(n.point,this,t)},t.throughPointsAndContainingPoint=function(n,e,i){for(var o=0,r=t.withBorderPoints(n,e);o<r.length;o++){var s=r[o];if(s.containsPoint(i))return s}},t.withBorderPointAndInfinityInDirection=function(n,e){return t.withBorderPoints(n,n.plus(e))},t.withBorderPoints=function(n,e){var i=e.minus(n).getPerpendicular();return[new t(n,i),new t(n,i.scale(-1))]},t}(),F=new(function(){function t(){}return t.prototype.expandToIncludePoint=function(t){return this},t.prototype.expandToIncludePolygon=function(t){return this},t.prototype.expandToIncludeInfinityInDirection=function(t){return this},t.prototype.intersects=function(t){return!0},t.prototype.expandToInclude=function(t){return this},t.prototype.transform=function(t){return this},t.prototype.intersectWithLineSegment=function(t){return t},t.prototype.contains=function(t){return!0},t.prototype.intersectWith=function(t){return t},t.prototype.intersectWithRay=function(t){return t},t.prototype.intersectWithLine=function(t){return t},t.prototype.intersectWithConvexPolygon=function(t){return t},t.prototype.isContainedByRay=function(t){return!1},t.prototype.isContainedByLineSegment=function(t){return!1},t.prototype.isContainedByLine=function(t){return!1},t.prototype.isContainedByConvexPolygon=function(t){return!1},t.prototype.intersectsRay=function(t){return!0},t.prototype.intersectsLineSegment=function(t){return!0},t.prototype.intersectsLine=function(t){return!0},t.prototype.intersectsConvexPolygon=function(t){return!0},t}()),W=function(){function t(n,e){this.vertices=e,this.halfPlanes=n,this.vertices=this.vertices||t.getVertices(this.halfPlanes)}return t.prototype.findVertex=function(t){for(var n=0,e=this.vertices;n<e.length;n++){var i=e[n];if(i.point.equals(t))return i}},t.prototype.intersects=function(t){return t.intersectsConvexPolygon(this)},t.prototype.intersectWith=function(t){return t.intersectWithConvexPolygon(this)},t.prototype.intersectWithRay=function(t){return t.intersectWithConvexPolygon(this)},t.prototype.intersectWithLine=function(t){return t.intersectWithConvexPolygon(this)},t.prototype.intersectWithLineSegment=function(t){return t.intersectWithConvexPolygon(this)},t.prototype.contains=function(t){return t.isContainedByConvexPolygon(this)},t.prototype.containsHalfPlane=function(t){for(var n=0,e=this.halfPlanes;n<e.length;n++){var i=e[n];if(!t.isContainedByHalfPlane(i))return!1}return!0},t.prototype.isContainedByHalfPlane=function(t){for(var n=0,e=this.vertices;n<e.length;n++){var i=e[n];if(!t.containsPoint(i.point))return!1}for(var o=t.complement(),r=0,s=this.halfPlanes;r<s.length;r++){if((u=s[r]).isContainedByHalfPlane(t))return!0}for(var a=0,c=this.halfPlanes;a<c.length;a++){var u=c[a];if(this.hasAtMostOneVertex(u)&&(u.isContainedByHalfPlane(o)||o.isContainedByHalfPlane(u)))return!1;var h=u.getIntersectionWith(t),p=this.findVertex(h.point);if(p){if(!p.isContainedByHalfPlaneWithNormal(t.normalTowardInterior))return!1}else if(this.containsPoint(h.point))return!1}return!this.containsHalfPlane(t)},t.prototype.getPointInFrontInDirection=function(t,n){for(var e,i=0,o=0,r=this.vertices;o<r.length;o++){var s=r[o],a=s.point.minus(t).dot(n);a>i&&(e=s.point,i=a)}return e?t.plus(e.minus(t).projectOn(n)):t},t.prototype.expandToIncludePoint=function(n){if(this.containsPoint(n))return this;for(var e=[],i=[],o=0,r=this.halfPlanes;o<r.length;o++){var s=r[o];this.hasAtMostOneVertex(s)&&!s.containsPoint(n)&&e.push(s.expandToIncludePoint(n))}if(0===this.vertices.length)return new t(e.concat(this.halfPlanes.filter((function(t){return t.containsPoint(n)}))));for(var a=0,c=this.vertices;a<c.length;a++){var u=c[a];if(u.containsPoint(n))i.push(u);else if(u.isExpandableToContainPoint(n)){var h=u.expandToContainPoint(n);e.push(h.newHalfPlane),i.push(h.newVertex)}else u.isInSameHalfPlaneAs(n)&&e.push(u.getHalfPlaneContaining(n))}if(2!==e.length)throw new Error("expected two new half planes");return i.push(new L(n,e[0],e[1])),e=t.getHalfPlanes(i),new t(e,i)},t.prototype.expandToIncludeInfinityInDirection=function(n){if(this.containsInfinityInDirection(n))return this;var e=this.halfPlanes.filter((function(t){return t.containsInfinityInDirection(n)})).concat(this.getTangentPlanesThroughInfinityInDirection(n));return 0===(e=t.getHalfPlanesNotContainingAnyOther(e)).length?F:new t(e)},t.prototype.getIntersectionsWithLine=function(t,n){for(var e=[],i=0,o=this.halfPlanes;i<o.length;i++){var r=o[i];if(!r.isParallelToLine(t,n)){var s=r.intersectWithLine(t,n),a=this.findVertex(s.point);a&&!a.containsLineSegmentWithDirection(n)||this.containsPoint(s.point)&&e.push(s)}}return e},t.prototype.expandByDistance=function(n){return new t(this.halfPlanes.map((function(t){return t.expandByDistance(n)})))},t.prototype.transform=function(n){return new t(this.halfPlanes.map((function(t){return t.transform(n)})))},t.prototype.intersectWithConvexPolygon=function(n){if(n.isContainedByConvexPolygon(this))return n;if(this.isContainedByConvexPolygon(n))return this;if(!this.isOutsideConvexPolygon(n)){var e=t.getHalfPlanesNotContainingAnyOther(this.halfPlanes.concat(n.halfPlanes)),i=t.groupVerticesByPoint(t.getVertices(e)).map((function(n){return t.getVerticesNotContainingAnyOther(n)})).reduce((function(t,n){return t.concat(n)}),[]);if(0===i.length)return new t(e);var o=t.getHalfPlanes(i);return new t(o)}},t.prototype.containsInfinityInDirection=function(t){for(var n=0,e=this.halfPlanes;n<e.length;n++){if(!e[n].containsInfinityInDirection(t))return!1}return!0},t.prototype.containsPoint=function(t){for(var n=0,e=this.halfPlanes;n<e.length;n++){if(!e[n].containsPoint(t))return!1}return!0},t.prototype.intersectsRay=function(t){return t.intersectsConvexPolygon(this)},t.prototype.intersectsLineSegment=function(t){return t.intersectsConvexPolygon(this)},t.prototype.intersectsLine=function(t){return t.intersectsConvexPolygon(this)},t.prototype.intersectsConvexPolygon=function(t){return!(!this.isContainedByConvexPolygon(t)&&!t.isContainedByConvexPolygon(this))||!this.isOutsideConvexPolygon(t)},t.prototype.isOutsideConvexPolygon=function(t){for(var n=0,e=t.halfPlanes;n<e.length;n++){var i=e[n];if(this.isContainedByHalfPlane(i.complement()))return!0}for(var o=0,r=this.halfPlanes;o<r.length;o++){var s=r[o];if(t.isContainedByHalfPlane(s.complement()))return!0}return!1},t.prototype.hasAtMostOneVertex=function(t){for(var n=0,e=0,i=this.vertices;e<i.length;e++){var o=i[e];if((o.halfPlane1===t||o.halfPlane2===t)&&++n>1)return!1}return!0},t.prototype.getTangentPlanesThroughInfinityInDirection=function(t){for(var n=[],e=0,i=this.vertices;e<i.length;e++)for(var o=i[e],r=0,s=D.withBorderPointAndInfinityInDirection(o.point,t);r<s.length;r++){var a=s[r];this.isContainedByHalfPlane(a)&&n.push(a)}return n},t.prototype.isContainedByRay=function(t){return!1},t.prototype.isContainedByLineSegment=function(t){return!1},t.prototype.isContainedByLine=function(t){return!1},t.prototype.isContainedByConvexPolygon=function(t){for(var n=0,e=t.halfPlanes;n<e.length;n++){var i=e[n];if(!this.isContainedByHalfPlane(i))return!1}return!0},t.getHalfPlanes=function(t){for(var n=[],e=0,i=t;e<i.length;e++){var o=i[e];-1===n.indexOf(o.halfPlane1)&&n.push(o.halfPlane1),-1===n.indexOf(o.halfPlane2)&&n.push(o.halfPlane2)}return n},t.getVerticesNotContainingAnyOther=function(t){for(var n=[],e=0;e<t.length;e++){for(var i=!0,o=0;o<t.length;o++)if(e!==o&&t[o].isContainedByVertex(t[e])){i=!1;break}i&&n.push(t[e])}return n},t.getHalfPlanesNotContainingAnyOther=function(t){for(var n=[],e=0,i=t;e<i.length;e++){for(var o=i[e],r=!0,s=0,a=n;s<a.length;s++){if(a[s].isContainedByHalfPlane(o)){r=!1;break}}r&&n.push(o)}return n},t.groupVerticesByPoint=function(t){for(var n=[],e=0,i=t;e<i.length;e++){for(var o=i[e],r=void 0,s=0,a=n;s<a.length;s++){var c=a[s];if(c[0].point.equals(o.point)){r=c;break}}r?r.push(o):n.push([o])}return n},t.getVertices=function(t){for(var n=[],e=0;e<t.length;e++)for(var i=e+1;i<t.length;i++)if(!t[e].complement().isContainedByHalfPlane(t[i])){for(var o=t[e].getIntersectionWith(t[i]),r=!0,s=0;s<t.length;s++)if(s!==e&&s!==i&&!t[s].containsPoint(o.point)){r=!1;break}r&&n.push(o)}return n},t.createTriangleWithInfinityInTwoDirections=function(n,e,i){var o=e.getPerpendicular(),r=i.getPerpendicular();return e.cross(i)<0?new t([new D(n,o.scale(-1)),new D(n,r)]):new t([new D(n,o),new D(n,r.scale(-1))])},t.createFromHalfPlane=function(n){return new t([n])},t.createTriangleWithInfinityInDirection=function(n,e,i){var o=e.minus(n).projectOn(i.getPerpendicular());return new t([new D(n,o),new D(e,o.scale(-1)),D.throughPointsAndContainingPoint(n,e,n.plus(i))])},t.createTriangle=function(n,e,i){return new t([D.throughPointsAndContainingPoint(n,e,i),D.throughPointsAndContainingPoint(n,i,e),D.throughPointsAndContainingPoint(e,i,n)])},t.createRectangle=function(n,e,i,o){var r=[];return Number.isFinite(n)&&(r.push(new D(new s(n,0),new s(i>0?1:-1,0))),Number.isFinite(i)&&r.push(new D(new s(n+i,0),new s(i>0?-1:1,0)))),Number.isFinite(e)&&(r.push(new D(new s(0,e),new s(0,o>0?1:-1))),Number.isFinite(o)&&r.push(new D(new s(0,e+o),new s(0,o>0?-1:1)))),new t(r)},t}(),j=function(){function t(t){this.viewBox=t}return t.prototype.fillText=function(t,n,e,i){var r=void 0===i?function(i){i.fillText(t,n,e)}:function(o){o.fillText(t,n,e,i)};this.viewBox.addDrawing(r,this.getDrawnRectangle(n,e,t),o.Relative,!0)},t.prototype.measureText=function(t){return this.viewBox.measureText(t)},t.prototype.strokeText=function(t,n,e,i){var r=void 0===i?function(i){i.strokeText(t,n,e)}:function(o){o.strokeText(t,n,e,i)};this.viewBox.addDrawing(r,this.getDrawnRectangle(n,e,t),o.Relative,!0)},t.prototype.getDrawnRectangle=function(t,n,e){var i,o=this.viewBox.measureText(e);i=void 0!==o.actualBoundingBoxRight?Math.abs(o.actualBoundingBoxRight-o.actualBoundingBoxLeft):o.width;var r=void 0!==o.actualBoundingBoxAscent?o.actualBoundingBoxAscent+o.actualBoundingBoxDescent:1,s=void 0!==o.actualBoundingBoxAscent?o.actualBoundingBoxAscent:0;return W.createRectangle(t,n-s,i,r)},t}(),R=function(){function t(t){this.viewBox=t}return t.prototype.drawImage=function(){var t,n,e,i,r,s,a,c,u,h=Array.prototype.slice.apply(arguments);arguments.length<=5?(t=h[0],s=h[1],a=h[2],c=h[3],u=h[4]):(t=h[0],n=h[1],e=h[2],i=h[3],r=h[4],s=h[5],a=h[6],c=h[7],u=h[8]);var p=this.getDrawnLength(t.width,n,i,c),f=this.getDrawnLength(t.height,e,r,u),l=W.createRectangle(s,a,p,f),y=this.getDrawImageInstruction(arguments.length,t,n,e,i,r,s,a,c,u);this.viewBox.addDrawing(y,l,o.Relative,!0)},t.prototype.getDrawImageInstruction=function(t,n,e,i,o,r,s,a,c,u){switch(t){case 3:return function(t){t.drawImage(n,s,a)};case 5:return function(t){t.drawImage(n,s,a,c,u)};case 9:return function(t){t.drawImage(n,e,i,o,r,s,a,c,u)};default:throw new TypeError("Failed to execute 'drawImage' on 'CanvasRenderingContext2D': Valid arities are: [3, 5, 9], but "+t+" arguments provided.")}},t.prototype.getDrawnLength=function(t,n,e,i){var o=this.getLength(t);return void 0!==i?i:void 0!==n?void 0!==e?e:o-n:o},t.prototype.getLength=function(t){return"number"==typeof t?t:t.baseVal.value},t}();var k=function(){function t(t){this.viewBox=t}return t.prototype.createImageData=function(t,n){},t.prototype.getImageData=function(t,n,e,i){},t.prototype.putImageData=function(t,n,e,i,r,s,a){var c;t=function(t,n,e,i,o){n=void 0===n?0:n,e=void 0===e?0:e,i=void 0===i?t.width:i,o=void 0===o?t.height:o;for(var r=t.data,s=new Uint8ClampedArray(4*i*o),a=0;a<o;a++)for(var c=0;c<i;c++){var u=4*((e+a)*t.width+n+c),h=4*(a*i+c);s[h]=r[u],s[h+1]=r[u+1],s[h+2]=r[u+2],s[h+3]=r[u+3]}return new ImageData(s,i,o)}(t,i,r,s,a);var u=this.viewBox.getDrawingLock();this.viewBox.createPatternFromImageData(t).then((function(t){c=t,u.release()})),this.viewBox.addDrawing((function(i){i.translate(n,e),i.fillStyle=c,i.imageSmoothingEnabled=!1,i.fillRect(0,0,t.width,t.height)}),W.createRectangle(n,e,t.width,t.height),o.Absolute,!1)},t}(),E=function(){function t(t){this.propertyName=t}return t.prototype.changeInstanceValue=function(t,n){return this.valuesAreEqual(t[this.propertyName],n)?t:t.changeProperty(this.propertyName,n)},t.prototype.isEqualForInstances=function(t,n){return this.valuesAreEqual(t[this.propertyName],n[this.propertyName])},t.prototype.valueIsTransformableForInstance=function(t){return!0},t.prototype.changeToNewValue=function(t,n){return n?this.changeToNewValueTransformed(t):this.changeToNewValueUntransformed(t)},t.prototype.getInstructionToChange=function(t,n){var e=t[this.propertyName],i=n[this.propertyName];return this.valuesAreEqual(e,i)&&(t.fillAndStrokeStylesTransformed===n.fillAndStrokeStylesTransformed||this.valuesAreEqualWhenTransformed(e,i))?function(){}:this.changeToNewValue(i,n.fillAndStrokeStylesTransformed)},t}(),N=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),M=function(t){function n(n){return t.call(this,n)||this}return N(n,t),n.prototype.valuesAreEqual=function(t,n){return t===n},n.prototype.changeToNewValueTransformed=function(t){var n=this;return function(e,i){e[n.propertyName]=t*i.scale}},n.prototype.changeToNewValueUntransformed=function(t){var n=this;return function(e){e[n.propertyName]=t}},n.prototype.valuesAreEqualWhenTransformed=function(t,n){return 0===t&&0===n},n}(E),V=new M("lineWidth"),q=new M("lineDashOffset"),H=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),G=new(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return H(n,t),n.prototype.valuesAreEqual=function(t,n){if(t.length!==n.length)return!1;for(var e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0},n.prototype.changeToNewValueTransformed=function(t){return function(n,e){n.setLineDash(t.map((function(t){return t*e.scale})))}},n.prototype.changeToNewValueUntransformed=function(t){return function(n){n.setLineDash(t)}},n.prototype.valuesAreEqualWhenTransformed=function(t,n){return 0===t.length&&0===n.length},n}(E))("lineDash"),U=function(){function t(t){this.viewBox=t}return Object.defineProperty(t.prototype,"lineDashOffset",{get:function(){return this.viewBox.state.current.lineDashOffset},set:function(t){this.viewBox.changeState((function(n){return q.changeInstanceValue(n,t)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineWidth",{get:function(){return this.viewBox.state.current.lineWidth},set:function(t){this.viewBox.changeState((function(n){return V.changeInstanceValue(n,t)}))},enumerable:!1,configurable:!0}),t.prototype.getLineDash=function(){return this.viewBox.state.current.lineDash},t.prototype.setLineDash=function(t){t.length%2==1&&(t=t.concat(t)),this.viewBox.changeState((function(n){return G.changeInstanceValue(n,t)}))},t}(),z=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Y=new(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return z(n,t),n.prototype.valuesAreEqual=function(t,n){return t===n},n.prototype.changeToNewValue=function(t){return function(n){n.direction=t}},n}(c))("direction"),X=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Z=new(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return X(n,t),n.prototype.valuesAreEqual=function(t,n){return t===n},n.prototype.changeToNewValue=function(t){return function(n){n.font=t}},n}(c))("font"),J=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Q=new(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return J(n,t),n.prototype.valuesAreEqual=function(t,n){return t===n},n.prototype.changeToNewValue=function(t){return function(n){n.textAlign=t}},n}(c))("textAlign"),K=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),$=new(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return K(n,t),n.prototype.valuesAreEqual=function(t,n){return t===n},n.prototype.changeToNewValue=function(t){return function(n){n.textBaseline=t}},n}(c))("textBaseline"),tt=function(){function t(t){this.viewBox=t}return Object.defineProperty(t.prototype,"direction",{set:function(t){this.viewBox.changeState((function(n){return Y.changeInstanceValue(n,t)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"font",{set:function(t){this.viewBox.changeState((function(n){return Z.changeInstanceValue(n,t)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textAlign",{set:function(t){this.viewBox.changeState((function(n){return Q.changeInstanceValue(n,t)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBaseline",{set:function(t){this.viewBox.changeState((function(n){return $.changeInstanceValue(n,t)}))},enumerable:!1,configurable:!0}),t}();function nt(t){return void 0!==t.direction}var et=function(){function t(){}return t.arc=function(t,n,e,i,o,r){return{instruction:function(a,c){var u=c.getRotationAngle(),h=c.apply(new s(t,n)),p=h.x,f=h.y;a.arc(p,f,e*c.scale,i+u,o+u,r)},changeArea:function(i){i.addPosition(new s(t-e,n-e)),i.addPosition(new s(t-e,n+e)),i.addPosition(new s(t+e,n-e)),i.addPosition(new s(t+e,n+e))},positionChange:new s(t,n).plus(a.rotation(0,0,o).apply(new s(e,0))),initialPoint:new s(t,n).plus(a.rotation(0,0,i).apply(new s(e,0)))}},t.arcTo=function(t,n,e,i,o){var r=new s(t,n),a=new s(e,i);return{instruction:function(t,n){var e=n.apply(r),i=n.apply(a);t.arcTo(e.x,e.y,i.x,i.y,o*n.scale)},changeArea:function(t){t.addPosition(r),t.addPosition(a)},positionChange:new s(e,i)}},t.bezierCurveTo=function(t,n,e,i,o,r){},t.ellipse=function(t,n,e,i,o,r,c,u){return{instruction:function(a,h){var p=h.apply(new s(t,n)),f=h.getRotationAngle();a.ellipse(p.x,p.y,e*h.scale,i*h.scale,o+f,r,c,u)},changeArea:function(o){o.addPosition(new s(t-e,n-i)),o.addPosition(new s(t-e,n+i)),o.addPosition(new s(t+e,n-i)),o.addPosition(new s(t+e,n+i))},positionChange:new s(t,n).plus(a.rotation(0,0,c).before(new a(e,0,0,i,0,0)).before(a.rotation(0,0,o)).apply(new s(1,0))),initialPoint:new s(t,n).plus(a.rotation(0,0,r).before(new a(e,0,0,i,0,0)).before(a.rotation(0,0,o)).apply(new s(1,0)))}},t.quadraticCurveTo=function(t,n,e,i){return{instruction:function(o,r){var a=r.apply(new s(t,n)),c=r.apply(new s(e,i));o.quadraticCurveTo(a.x,a.y,c.x,c.y)},changeArea:function(o,r){nt(r)||(o.addPosition(new s((r.x+t)/2,(r.y+n)/2)),o.addPosition(new s((t+e)/2,(n+i)/2)),o.addPosition(new s(e,i)))},positionChange:new s(e,i)}},t}(),it=function(){function t(t){this.viewBox=t}return t.prototype.arc=function(t,n,e,i,o,r){this.viewBox.addPathInstruction(et.arc(t,n,e,i,o,r))},t.prototype.arcTo=function(t,n,e,i,o){this.viewBox.addPathInstruction(et.arcTo(t,n,e,i,o))},t.prototype.bezierCurveTo=function(t,n,e,i,o,r){},t.prototype.closePath=function(){this.viewBox.closePath()},t.prototype.ellipse=function(t,n,e,i,o,r,s,a){this.viewBox.addPathInstruction(et.ellipse(t,n,e,i,o,r,s,a))},t.prototype.lineTo=function(t,n){this.viewBox.lineTo(new s(t,n))},t.prototype.lineToInfinityInDirection=function(t,n){this.viewBox.lineTo({direction:new s(t,n)})},t.prototype.moveTo=function(t,n){this.viewBox.moveTo(new s(t,n))},t.prototype.moveToInfinityInDirection=function(t,n){this.viewBox.moveTo({direction:new s(t,n)})},t.prototype.quadraticCurveTo=function(t,n,e,i){this.viewBox.addPathInstruction(et.quadraticCurveTo(t,n,e,i))},t.prototype.rect=function(t,n,e,i){this.viewBox.rect(t,n,e,i)},t}(),ot=function(){function t(t,n){this.canvas=t,this.canvasState=new r(n),this.canvasTransform=new p(n),this.canvasCompositing=new f,this.canvasStrokeStyles=new m(n),this.canvasShadowStyles=new C(n),this.canvasFilters=new _,this.canvasRect=new O(n),this.canvasDrawPath=new B(n),this.canvasUserInterface=new A,this.canvasText=new j(n),this.canvasDrawImage=new R(n),this.canvasImageData=new k(n),this.canvasPathDrawingStyles=new U(n),this.canvasTextDrawingStyles=new tt(n),this.canvasPath=new it(n)}return t.prototype.save=function(){this.canvasState.save()},t.prototype.restore=function(){this.canvasState.restore()},t.prototype.getTransform=function(){return this.canvasTransform.getTransform()},t.prototype.resetTransform=function(){this.canvasTransform.resetTransform()},t.prototype.rotate=function(t){this.canvasTransform.rotate(t)},t.prototype.scale=function(t,n){this.canvasTransform.scale(t,n)},t.prototype.setTransform=function(t,n,e,i,o,r){this.canvasTransform.setTransform(t,n,e,i,o,r)},t.prototype.transform=function(t,n,e,i,o,r){this.canvasTransform.transform(t,n,e,i,o,r)},t.prototype.translate=function(t,n){this.canvasTransform.translate(t,n)},Object.defineProperty(t.prototype,"globalAlpha",{set:function(t){this.canvasCompositing.globalAlpha=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"globalCompositeOperation",{set:function(t){this.canvasCompositing.globalCompositeOperation=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageSmoothingEnabled",{set:function(t){this.canvasImageSmoothing.imageSmoothingEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageSmoothingQuality",{set:function(t){this.canvasImageSmoothing.imageSmoothingQuality=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillStyle",{set:function(t){this.canvasStrokeStyles.fillStyle=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeStyle",{set:function(t){this.canvasStrokeStyles.strokeStyle=t},enumerable:!1,configurable:!0}),t.prototype.createLinearGradient=function(t,n,e,i){return this.canvasStrokeStyles.createLinearGradient(t,n,e,i)},t.prototype.createPattern=function(t,n){return this.canvasStrokeStyles.createPattern(t,n)},t.prototype.createRadialGradient=function(t,n,e,i,o,r){return this.canvasStrokeStyles.createRadialGradient(t,n,e,i,o,r)},Object.defineProperty(t.prototype,"shadowBlur",{set:function(t){this.canvasShadowStyles.shadowBlur=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowColor",{set:function(t){this.canvasShadowStyles.shadowColor=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowOffsetX",{set:function(t){this.canvasShadowStyles.shadowOffsetX=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowOffsetY",{set:function(t){this.canvasShadowStyles.shadowOffsetY=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filter",{set:function(t){this.canvasFilters.filter=t},enumerable:!1,configurable:!0}),t.prototype.clearRect=function(t,n,e,i){this.canvasRect.clearRect(t,n,e,i)},t.prototype.fillRect=function(t,n,e,i){this.canvasRect.fillRect(t,n,e,i)},t.prototype.strokeRect=function(t,n,e,i){this.canvasRect.strokeRect(t,n,e,i)},t.prototype.beginPath=function(){this.canvasDrawPath.beginPath()},t.prototype.clip=function(t,n){this.canvasDrawPath.clip(t,n)},t.prototype.fill=function(t,n){this.canvasDrawPath.fill(t,n)},t.prototype.isPointInPath=function(t,n,e,i){return this.canvasDrawPath.isPointInPath(t,n,e,i)},t.prototype.isPointInStroke=function(t,n,e){return this.canvasDrawPath.isPointInStroke(t,n,e)},t.prototype.stroke=function(t){this.canvasDrawPath.stroke(t)},t.prototype.drawFocusIfNeeded=function(t,n){this.canvasUserInterface.drawFocusIfNeeded(t,n)},t.prototype.scrollPathIntoView=function(t){this.canvasUserInterface.scrollPathIntoView(t)},t.prototype.fillText=function(t,n,e,i){this.canvasText.fillText(t,n,e,i)},t.prototype.measureText=function(t){return this.canvasText.measureText(t)},t.prototype.strokeText=function(t,n,e,i){this.canvasText.strokeText(t,n,e,i)},t.prototype.drawImage=function(){this.canvasDrawImage.drawImage.apply(this.canvasDrawImage,arguments)},t.prototype.createImageData=function(t,n){return this.canvasImageData.createImageData(t,n)},t.prototype.getImageData=function(t,n,e,i){return this.canvasImageData.getImageData(t,n,e,i)},t.prototype.putImageData=function(t,n,e,i,o,r,s){this.canvasImageData.putImageData(t,n,e,i,o,r,s)},Object.defineProperty(t.prototype,"lineCap",{set:function(t){this.canvasPathDrawingStyles.lineCap=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineDashOffset",{set:function(t){this.canvasPathDrawingStyles.lineDashOffset=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineJoin",{set:function(t){this.canvasPathDrawingStyles.lineJoin=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineWidth",{set:function(t){this.canvasPathDrawingStyles.lineWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"miterLimit",{set:function(t){this.canvasPathDrawingStyles.miterLimit=t},enumerable:!1,configurable:!0}),t.prototype.getLineDash=function(){return this.canvasPathDrawingStyles.getLineDash()},t.prototype.setLineDash=function(t){this.canvasPathDrawingStyles.setLineDash(t)},Object.defineProperty(t.prototype,"direction",{set:function(t){this.canvasTextDrawingStyles.direction=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"font",{set:function(t){this.canvasTextDrawingStyles.font=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textAlign",{set:function(t){this.canvasTextDrawingStyles.textAlign=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBaseline",{set:function(t){this.canvasTextDrawingStyles.textBaseline=t},enumerable:!1,configurable:!0}),t.prototype.arc=function(t,n,e,i,o,r){this.canvasPath.arc(t,n,e,i,o,r)},t.prototype.arcTo=function(t,n,e,i,o){this.canvasPath.arcTo(t,n,e,i,o)},t.prototype.bezierCurveTo=function(t,n,e,i,o,r){this.canvasPath.bezierCurveTo(t,n,e,i,o,r)},t.prototype.closePath=function(){this.canvasPath.closePath()},t.prototype.ellipse=function(t,n,e,i,o,r,s,a){this.canvasPath.ellipse(t,n,e,i,o,r,s)},t.prototype.lineTo=function(t,n){this.canvasPath.lineTo(t,n)},t.prototype.lineToInfinityInDirection=function(t,n){this.canvasPath.lineToInfinityInDirection(t,n)},t.prototype.moveTo=function(t,n){this.canvasPath.moveTo(t,n)},t.prototype.moveToInfinityInDirection=function(t,n){this.canvasPath.moveToInfinityInDirection(t,n)},t.prototype.quadraticCurveTo=function(t,n,e,i){this.canvasPath.quadraticCurveTo(t,n,e,i)},t.prototype.rect=function(t,n,e,i){if(!Number.isFinite(t)&&!Number.isFinite(n))throw new Error("The starting coordinates provided ("+t+" and "+n+") do not determine a direction.");this.canvasPath.rect(t,n,e,i)},t}(),rt=function(){function t(t,n,e){this.area=t,this.latestClippedPath=n,this.previouslyClippedPaths=e}return t.prototype.withClippedPath=function(n){return new t(n.getClippedArea(this.area),n,this)},Object.defineProperty(t.prototype,"initialState",{get:function(){return this.previouslyClippedPaths?this.previouslyClippedPaths.initialState:this.latestClippedPath.initialState},enumerable:!1,configurable:!0}),t.prototype.except=function(n){if(n!==this)return this.previouslyClippedPaths?new t(this.area,this.latestClippedPath,this.previouslyClippedPaths.except(n)):this},t.prototype.contains=function(t){return!!t&&(this===t||!!this.previouslyClippedPaths&&this.previouslyClippedPaths.contains(t))},t.prototype.getInstructionToRecreate=function(t){var n=this,e=function(t,e){n.latestClippedPath.execute(t,e)};if(this.previouslyClippedPaths){var i=this.previouslyClippedPaths.getInstructionToRecreate(t),o=this.previouslyClippedPaths.latestClippedPath.state.getInstructionToConvertToState(this.latestClippedPath.initialState,t);return function(t,n){i(t,n),o(t,n),e(t,n)}}return e},t}(),st=[Y,g,q,G,V,P,Q,$,h,Z,T,x,I],at=function(){function t(t){this.fillStyle=t.fillStyle,this.lineWidth=t.lineWidth,this.lineDash=t.lineDash,this.strokeStyle=t.strokeStyle,this.lineDashOffset=t.lineDashOffset,this.transformation=t.transformation,this.direction=t.direction,this.font=t.font,this.textAlign=t.textAlign,this.textBaseline=t.textBaseline,this.clippedPaths=t.clippedPaths,this.fillAndStrokeStylesTransformed=t.fillAndStrokeStylesTransformed,this.shadowOffset=t.shadowOffset,this.shadowColor=t.shadowColor,this.shadowBlur=t.shadowBlur}return t.prototype.changeProperty=function(n,e){var i=this,o={fillStyle:i.fillStyle,lineWidth:i.lineWidth,lineDash:i.lineDash,strokeStyle:i.strokeStyle,lineDashOffset:i.lineDashOffset,transformation:i.transformation,direction:i.direction,font:i.font,textAlign:i.textAlign,textBaseline:i.textBaseline,clippedPaths:i.clippedPaths,fillAndStrokeStylesTransformed:i.fillAndStrokeStylesTransformed,shadowOffset:i.shadowOffset,shadowColor:i.shadowColor,shadowBlur:i.shadowBlur};return o[n]=e,new t(o)},Object.defineProperty(t.prototype,"clippingRegion",{get:function(){return this.clippedPaths?this.clippedPaths.area:void 0},enumerable:!1,configurable:!0}),t.prototype.equals=function(t){for(var n=0,e=st;n<e.length;n++){if(!e[n].isEqualForInstances(this,t))return!1}return(!this.clippedPaths&&!t.clippedPaths||this.clippedPaths&&this.clippedPaths===t.clippedPaths)&&this.fillAndStrokeStylesTransformed===t.fillAndStrokeStylesTransformed},t.prototype.getMaximumLineWidth=function(){return this.lineWidth*this.transformation.getMaximumLineWidthScale()},t.prototype.getLineDashPeriod=function(){return this.lineDash.reduce((function(t,n){return t+n}),0)},t.prototype.isTransformable=function(){for(var t=0,n=st;t<n.length;t++){if(!n[t].valueIsTransformableForInstance(this))return!1}return!0},t.prototype.getInstructionToConvertToState=function(t,n){var e=this,i=st.map((function(i){return i.getInstructionToChange(e,t,n)}));return function(t,n){for(var e=0;e<i.length;e++)i[e](t,n)}},t.prototype.withClippedPath=function(t){var n=this.clippedPaths?this.clippedPaths.withClippedPath(t):new rt(t.getClippedArea(),t);return this.changeProperty("clippedPaths",n)},t.default=new t({fillStyle:"#000",lineWidth:1,lineDash:[],strokeStyle:"#000",lineDashOffset:0,transformation:a.identity,direction:"inherit",font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic",clippedPaths:void 0,fillAndStrokeStylesTransformed:!1,shadowOffset:s.origin,shadowColor:"rgba(0, 0, 0, 0)",shadowBlur:0}),t.setDefault=function(){},t}(),ct=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),ut=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.colorStops=[],n}return ct(n,t),n.prototype.addColorStopsToGradient=function(t){for(var n=0,e=this.colorStops;n<e.length;n++){var i=e[n];t.addColorStop(i.offset,i.color)}},n.prototype.addColorStop=function(t,n){this.colorStops.push({offset:t,color:n})},n.prototype.getInstructionToSetTransformed=function(t){var n=this;return function(e,i){e[t]=n.createTransformedGradient(i)}},n.prototype.getInstructionToSetUntransformed=function(t){var n=this;return function(e){e[t]=n.createGradient()}},n}(l),ht=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),pt=function(t){function n(n,e,i,o,r){var s=t.call(this)||this;return s.context=n,s.x0=e,s.y0=i,s.x1=o,s.y1=r,s}return ht(n,t),n.prototype.createTransformedGradient=function(t){var n=t.apply(new s(this.x0,this.y0)),e=n.x,i=n.y,o=t.apply(new s(this.x1,this.y1)),r=o.x,a=o.y,c=this.context.createLinearGradient(e,i,r,a);return this.addColorStopsToGradient(c),c},n.prototype.createGradient=function(){var t=this.context.createLinearGradient(this.x0,this.y0,this.x1,this.y1);return this.addColorStopsToGradient(t),t},n}(ut),ft=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),lt=function(t){function n(n,e,i,o,r,s,a){var c=t.call(this)||this;return c.context=n,c.x0=e,c.y0=i,c.r0=o,c.x1=r,c.y1=s,c.r1=a,c}return ft(n,t),n.prototype.createTransformedGradient=function(t){var n=t.apply(new s(this.x0,this.y0)),e=n.x,i=n.y,o=t.apply(new s(this.x1,this.y1)),r=o.x,a=o.y,c=this.r0*t.scale,u=this.r1*t.scale,h=this.context.createRadialGradient(e,i,c,r,a,u);return this.addColorStopsToGradient(h),h},n.prototype.createGradient=function(){var t=this.context.createRadialGradient(this.x0,this.y0,this.r0,this.x1,this.y1,this.r1);return this.addColorStopsToGradient(t),t},n}(ut),yt=function(){function t(t){this.initiallyWithState=t,this.added=[]}return Object.defineProperty(t.prototype,"length",{get:function(){return this.added.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentlyWithState",{get:function(){return this.addedLast?this.addedLast:this.initiallyWithState},enumerable:!1,configurable:!0}),t.prototype.reconstructState=function(t,n){n.setInitialState(t)},Object.defineProperty(t.prototype,"stateOfFirstInstruction",{get:function(){return this.initiallyWithState.stateOfFirstInstruction},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this.currentlyWithState.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"initialState",{get:function(){return this.initiallyWithState.initialState},enumerable:!1,configurable:!0}),t.prototype.addClippedPath=function(t){this.currentlyWithState.addClippedPath(t)},t.prototype.add=function(t){this.added.push(t),this.addedLast=t},t.prototype.removeAll=function(t){for(var n;(n=this.added.findIndex(t))>-1;)this.removeAtIndex(n)},t.prototype.contains=function(t){return!!this.added.find(t)},t.prototype.setInitialState=function(t){this.initiallyWithState.setInitialState(t)},t.prototype.setInitialStateWithClippedPaths=function(t){this.initiallyWithState.setInitialStateWithClippedPaths(t)},t.prototype.execute=function(t,n){this.initiallyWithState.execute(t,n);for(var e=0,i=this.added;e<i.length;e++){i[e].execute(t,n)}},t.prototype.beforeIndex=function(t){return 0===t?this.initiallyWithState.state:this.added[t-1].state},t.prototype.removeAtIndex=function(t){t===this.added.length-1?1===this.added.length?this.addedLast=void 0:this.addedLast=this.added[t-1]:this.reconstructState(this.beforeIndex(t),this.added[t+1]),this.added.splice(t,1)},t}(),dt=function(){function t(t){this.currentState=t,this.instructions=[]}return t.prototype.restore=function(){this.addChangeToState(this.currentState.restored(),(function(t){t.restore()}))},t.prototype.save=function(){this.addChangeToState(this.currentState.saved(),(function(t){t.save()}))},t.prototype.changeCurrentInstanceTo=function(t,n){if(!this.currentState.current.equals(t)){var e=this.currentState.current.getInstructionToConvertToState(t,n),i=this.currentState.withCurrentState(t);this.addChangeToState(i,e)}},t.prototype.addChangeToState=function(t,n){this.currentState=t,n&&this.instructions.push(n)},Object.defineProperty(t.prototype,"instruction",{get:function(){var t=this;if(0!==this.instructions.length)return function(n,e){for(var i=0,o=t.instructions;i<o.length;i++){(0,o[i])(n,e)}}},enumerable:!1,configurable:!0}),t}(),vt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),gt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return vt(n,t),n.prototype.changeCurrentInstanceTo=function(e,i){if(!this.currentState.current.equals(e)){if(!n.canConvert(this.currentState.current,e)){if(!(this.currentState.stack.length>0))return void t.prototype.changeCurrentInstanceTo.call(this,e,i);this.restore(),this.save()}if(e.clippedPaths){var o=this.currentState,r=o.current.clippedPaths;if(e.clippedPaths===r)t.prototype.changeCurrentInstanceTo.call(this,e,i);else{var s=e.clippedPaths.except(r);this.convertToState(s.initialState,i),this.addChangeToState(s.latestClippedPath.state,s.getInstructionToRecreate(i)),this.convertToState(o.replaceCurrent(e),i)}}else t.prototype.changeCurrentInstanceTo.call(this,e,i)}},n.prototype.convertToState=function(t,n){var e=this.currentState.getInstructionToConvertToState(t,n);this.addChangeToState(t,e)},n.canConvert=function(t,n){return!t.clippedPaths||!!n.clippedPaths&&n.clippedPaths.contains(t.clippedPaths)},n}(dt),Pt=new(function(){function t(t,n){void 0===n&&(n=[]),this.current=t,this.stack=n}return t.prototype.replaceCurrent=function(n){return new t(n,this.stack)},t.prototype.withCurrentState=function(n){return new t(n,this.stack)},t.prototype.currentlyTransformed=function(t){return this.withCurrentState(this.current.changeProperty("fillAndStrokeStylesTransformed",t))},t.prototype.withClippedPath=function(n){return new t(this.current.withClippedPath(n),this.stack)},t.prototype.saved=function(){return new t(this.current,(this.stack||[]).concat([this.current]))},t.prototype.restored=function(){return this.stack&&0!==this.stack.length?new t(this.stack[this.stack.length-1],this.stack.slice(0,this.stack.length-1)):this},t.prototype.convertToLastSavedInstance=function(t,n){for(var e=this.stack.length-1;e>n;e--)t.restore()},t.prototype.convertFromLastSavedInstance=function(t,n,e){for(var i=n+1;i<this.stack.length;i++)t.changeCurrentInstanceTo(this.stack[i],e),t.save();t.changeCurrentInstanceTo(this.current,e)},t.prototype.getInstructionToConvertToStateUsingConversion=function(n,e,i){var o=t.findIndexOfHighestCommon(this.stack,e.stack);return this.convertToLastSavedInstance(n,o),e.convertFromLastSavedInstance(n,o,i),n.instruction},t.prototype.getInstructionToConvertToState=function(t,n){return this.getInstructionToConvertToStateUsingConversion(new dt(this),t,n)},t.prototype.getInstructionToClearStack=function(){var t=this.stack.length;return function(n){for(var e=0;e<t;e++)n.restore()}},t.prototype.getInstructionToConvertToStateWithClippedPath=function(t,n){return this.getInstructionToConvertToStateUsingConversion(new gt(this),t,n)},t.findIndexOfHighestCommon=function(t,n){for(var e=0,i=Math.min(t.length-1,n.length-1);e<=i;){if(!t[e].equals(n[e]))return e-1;e++}return e-1},t}())(at.default,[]),mt=function(){function t(t,n,e){this.initialState=t,this.state=n,this.rectangle=e,this.stateConversion=function(){}}return t.prototype.setInitialState=function(t){this.initialState=t;var n=this.initialState.getInstructionToConvertToState(this.state,this.rectangle);this.stateConversion=n},Object.defineProperty(t.prototype,"stateOfFirstInstruction",{get:function(){return this.state},enumerable:!1,configurable:!0}),t.prototype.addClippedPath=function(t){this.state=this.state.withClippedPath(t)},t.prototype.setInitialStateWithClippedPaths=function(t){this.initialState=t;var n=this.initialState.getInstructionToConvertToStateWithClippedPath(this.state,this.rectangle);this.stateConversion=n},t.prototype.execute=function(t,n){this.stateConversion&&this.stateConversion(t,n),this.executeInstruction(t,n)},t}(),wt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),It=function(t){function n(n,e,i,o,r){var s=t.call(this,n,e,r)||this;return s.instruction=i,s.stateConversion=o,s}return wt(n,t),n.prototype.executeInstruction=function(t,n){this.instruction(t,n)},n.prototype.copy=function(){return new n(this.initialState,this.state,this.instruction,this.stateConversion,this.rectangle)},n.create=function(t,e,i){return new n(t,t,e,(function(){}),i)},n}(mt),bt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Tt=function(t){function n(n,e,i,o,r,s){var a=t.call(this,n,e,i,o,s)||this;return a.area=r,a}return bt(n,t),n.prototype.hasDrawingAcrossBorderOf=function(t){return!1},n.prototype.intersects=function(t){return this.area.intersects(t)},n.prototype.isContainedBy=function(t){return t.contains(this.area)},n.createClearRect=function(t,e,i,o,r,s,a,c){return new n(t,t,(function(t,n){i.clearRect(t,n,o,r,s,a)}),(function(){}),e,c)},n}(It),St=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),xt=function(t){function n(n,e){var i=t.call(this,n)||this;return i.rectangle=e,i}return St(n,t),n.prototype.reconstructState=function(t,n){n.setInitialStateWithClippedPaths(t)},n.prototype.hasDrawingAcrossBorderOf=function(t){return this.contains((function(n){return n.hasDrawingAcrossBorderOf(t)}))},n.prototype.intersects=function(t){return this.contains((function(n){return n.intersects(t)}))},n.prototype.addClearRect=function(t,n,e,i,o,r){var s=this.rectangle.getForPath().getInfinity(n),a=Tt.createClearRect(n,t,s,e,i,o,r,this.rectangle);a.setInitialState(this.state),this.add(a)},n.prototype.clearContentsInsideArea=function(t){this.removeAll((function(n){return n.isContainedBy(t)}))},n.prototype.isContainedBy=function(t){return!this.contains((function(n){return!n.isContainedBy(t)}))},n.create=function(t){return new n(It.create(Pt,at.setDefault,t),t)},n}(yt);function Ct(t,n){return nt(t)?n.applyToPointAtInfinity(t):n.apply(t)}var _t=function(){function t(t,n){this.areaBuilder=t,this.transformation=n}return t.prototype.addPosition=function(t){this.areaBuilder.addPosition(Ct(t,this.transformation))},t}(),Ot=new(function(){function t(){}return t.prototype.intersectWith=function(t){return this},t.prototype.intersectWithConvexPolygon=function(t){return this},t.prototype.intersects=function(t){return!1},t.prototype.intersectWithLineSegment=function(t){return this},t.prototype.intersectWithRay=function(t){return this},t.prototype.intersectWithLine=function(t){return this},t.prototype.expandToInclude=function(t){return t},t.prototype.transform=function(t){return this},t.prototype.contains=function(t){return!1},t.prototype.isContainedByConvexPolygon=function(t){return!0},t.prototype.isContainedByRay=function(t){return!0},t.prototype.isContainedByLineSegment=function(t){return!0},t.prototype.isContainedByLine=function(t){return!0},t.prototype.intersectsRay=function(t){return!1},t.prototype.intersectsConvexPolygon=function(t){return!1},t.prototype.intersectsLineSegment=function(t){return!1},t.prototype.intersectsLine=function(t){return!1},t.prototype.expandToIncludePoint=function(t){return this},t.prototype.expandToIncludeInfinityInDirection=function(t){return this},t.prototype.expandToIncludePolygon=function(t){return t},t}()),Bt=function(){function t(t,n){this.base=t,this.direction=n}return t.prototype.pointIsOnSameLine=function(t){return 0===t.minus(this.base).cross(this.direction)},t.prototype.comesBefore=function(t,n){return n.minus(t).dot(this.direction)>=0},t.prototype.lineSegmentIsOnSameLine=function(t){return 0===this.direction.cross(t.direction)&&this.pointIsOnSameLine(t.point1)},t.prototype.getPointsInSameDirection=function(t,n){return this.comesBefore(n,t)?{point1:n,point2:t}:{point1:t,point2:n}},t.prototype.pointIsBetweenPoints=function(t,n,e){return t.minus(n).dot(this.direction)*t.minus(e).dot(this.direction)<=0},t.prototype.intersectsConvexPolygon=function(t){if(this.isContainedByConvexPolygon(t))return!0;for(var n=0,e=t.getIntersectionsWithLine(this.base,this.direction);n<e.length;n++){var i=e[n];if(this.interiorContainsPoint(i.point))return!0}return!1},t}(),At=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Lt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return At(n,t),n.prototype.intersectWith=function(t){return t.intersectWithLine(this)},n.prototype.intersectWithConvexPolygon=function(t){if(!this.intersectsConvexPolygon(t))return Ot;if(this.isContainedByConvexPolygon(t))return this;for(var n,e,i=0,o=t.getIntersectionsWithLine(this.base,this.direction);i<o.length;i++){var r=o[i];(!n&&!e||!n&&this.comesBefore(r.point,e)||!e&&this.comesBefore(n,r.point)||n&&e&&this.pointIsBetweenPoints(r.point,n,e))&&(r.halfPlane.normalTowardInterior.dot(this.direction)>0?n=r.point:e=r.point)}return n&&e?new jt(n,e):n?new Ft(n,this.direction):new Ft(e,this.direction.scale(-1))},n.prototype.intersectWithLine=function(t){return this.intersectsLine(t)?this:Ot},n.prototype.intersectWithLineSegment=function(t){return this.lineSegmentIsOnSameLine(t)?t:Ot},n.prototype.intersectWithRay=function(t){return this.intersectsRay(t)?t:Ot},n.prototype.isContainedByConvexPolygon=function(t){return t.containsPoint(this.base)&&t.containsInfinityInDirection(this.direction)&&t.containsInfinityInDirection(this.direction.scale(-1))},n.prototype.isContainedByLine=function(t){return this.intersectsSubsetOfLine(t)},n.prototype.isContainedByLineSegment=function(t){return!1},n.prototype.isContainedByRay=function(t){return!1},n.prototype.contains=function(t){return t.isContainedByLine(this)},n.prototype.intersectsLine=function(t){return this.intersectsSubsetOfLine(t)},n.prototype.intersectsSubsetOfLine=function(t){return this.pointIsOnSameLine(t.base)&&0===this.direction.cross(t.direction)},n.prototype.intersectsLineSegment=function(t){return this.lineSegmentIsOnSameLine(t)},n.prototype.intersectsRay=function(t){return this.intersectsSubsetOfLine(t)},n.prototype.intersects=function(t){return t.intersectsLine(this)},n.prototype.expandToIncludePoint=function(t){return this.pointIsOnSameLine(t)?this:W.createFromHalfPlane(D.throughPointsAndContainingPoint(this.base,this.base.plus(this.direction),t))},n.prototype.expandToIncludeInfinityInDirection=function(t){var n=t.cross(this.direction),e=this.direction.getPerpendicular();return 0===n?this:n>0?W.createFromHalfPlane(new D(this.base,e.scale(-1))):W.createFromHalfPlane(new D(this.base,e))},n.prototype.transform=function(t){var e=t.apply(this.base);return new n(e,t.apply(this.base.plus(this.direction)).minus(e))},n.prototype.interiorContainsPoint=function(t){return this.pointIsOnSameLine(t)},n}(Bt),Dt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Ft=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Dt(n,t),n.prototype.intersectWith=function(t){return t.intersectWithRay(this)},n.prototype.intersectWithConvexPolygon=function(t){if(!this.intersectsConvexPolygon(t))return Ot;if(this.isContainedByConvexPolygon(t))return this;for(var e,i=t.getIntersectionsWithLine(this.base,this.direction),o=this.base,r=0,s=i;r<s.length;r++){var a=s[r];(!e&&this.comesBefore(o,a.point)||e&&this.pointIsBetweenPoints(a.point,o,e))&&(a.halfPlane.normalTowardInterior.dot(this.direction)>0?o=a.point:e=a.point)}return e?new jt(o,e):new n(o,this.direction)},n.prototype.intersectWithRay=function(t){return this.isContainedByRay(t)?this:t.isContainedByRay(this)?t:this.interiorContainsPoint(t.base)?new jt(this.base,t.base):Ot},n.prototype.intersectWithLine=function(t){return t.intersectWithRay(this)},n.prototype.intersectWithLineSegment=function(t){if(t.isContainedByRay(this))return t;if(!this.lineSegmentIsOnSameLine(t))return Ot;var n=this.getPointsInSameDirection(t.point1,t.point2).point2;return this.comesBefore(n,this.base)?Ot:new jt(this.base,n)},n.prototype.isContainedByConvexPolygon=function(t){return t.containsPoint(this.base)&&t.containsInfinityInDirection(this.direction)},n.prototype.isContainedByRay=function(t){return t.containsPoint(this.base)&&t.containsInfinityInDirection(this.direction)},n.prototype.isContainedByLine=function(t){return t.intersectsSubsetOfLine(this)},n.prototype.isContainedByLineSegment=function(t){return!1},n.prototype.contains=function(t){return t.isContainedByRay(this)},n.prototype.intersectsRay=function(t){return this.isContainedByRay(t)||t.isContainedByRay(this)||this.interiorContainsPoint(t.base)},n.prototype.intersectsLine=function(t){return t.intersectsSubsetOfLine(this)},n.prototype.intersectsLineSegment=function(t){if(t.isContainedByRay(this))return!0;if(!this.lineSegmentIsOnSameLine(t))return!1;var n=this.getPointsInSameDirection(t.point1,t.point2).point2;return!this.comesBefore(n,this.base)},n.prototype.intersects=function(t){return t.intersectsRay(this)},n.prototype.expandToIncludePoint=function(t){return this.containsPoint(t)?this:this.pointIsOnSameLine(t)?new n(t,this.direction):W.createTriangleWithInfinityInDirection(this.base,t,this.direction)},n.prototype.expandToIncludeInfinityInDirection=function(t){return t.inSameDirectionAs(this.direction)?this:0===this.direction.cross(t)?new Lt(this.base,this.direction):W.createTriangleWithInfinityInTwoDirections(this.base,this.direction,t)},n.prototype.transform=function(t){var e=t.apply(this.base);return new n(e,t.apply(this.base.plus(this.direction)).minus(e))},n.prototype.interiorContainsPoint=function(t){return this.pointIsOnSameLine(t)&&!this.comesBefore(t,this.base)},n.prototype.containsInfinityInDirection=function(t){return this.direction.inSameDirectionAs(t)},n.prototype.containsPoint=function(t){return this.pointIsOnSameLine(t)&&this.comesBefore(this.base,t)},n}(Bt),Wt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),jt=function(t){function n(n,e){var i=t.call(this,n,e.minus(n))||this;return i.point1=n,i.point2=e,i}return Wt(n,t),n.prototype.intersectWith=function(t){return t.intersectWithLineSegment(this)},n.prototype.intersectWithLineSegment=function(t){if(this.isContainedByLineSegment(t))return this;if(t.isContainedByLineSegment(this))return t;if(!this.lineSegmentIsOnSameLine(t))return Ot;var e=this.getPointsInSameDirection(t.point1,t.point2),i=e.point1,o=e.point2;return this.comesBefore(o,this.point1)||this.comesBefore(this.point2,i)?Ot:this.comesBefore(this.point1,i)?new n(i,this.point2):new n(this.point1,o)},n.prototype.intersectWithRay=function(t){return t.intersectWithLineSegment(this)},n.prototype.intersectWithLine=function(t){return t.intersectWithLineSegment(this)},n.prototype.isContainedByRay=function(t){return t.containsPoint(this.point1)&&t.containsPoint(this.point2)},n.prototype.isContainedByLine=function(t){return t.intersectsSubsetOfLine(this)},n.prototype.isContainedByLineSegment=function(t){return t.containsPoint(this.point1)&&t.containsPoint(this.point2)},n.prototype.intersectWithConvexPolygon=function(t){if(!this.intersectsConvexPolygon(t))return Ot;if(this.isContainedByConvexPolygon(t))return this;for(var e=t.getIntersectionsWithLine(this.point1,this.direction),i=this.point1,o=this.point2,r=0,s=e;r<s.length;r++){var a=s[r];this.pointIsBetweenPoints(a.point,i,o)&&(a.halfPlane.normalTowardInterior.dot(this.direction)>0?i=a.point:o=a.point)}return new n(i,o)},n.prototype.isContainedByConvexPolygon=function(t){return t.containsPoint(this.point1)&&t.containsPoint(this.point2)},n.prototype.contains=function(t){return t.isContainedByLineSegment(this)},n.prototype.pointIsStrictlyBetweenPoints=function(t,n,e){return t.minus(n).dot(this.direction)*t.minus(e).dot(this.direction)<0},n.prototype.containsPoint=function(t){return this.pointIsOnSameLine(t)&&this.pointIsBetweenPoints(t,this.point1,this.point2)},n.prototype.interiorContainsPoint=function(t){return this.pointIsOnSameLine(t)&&this.pointIsStrictlyBetweenPoints(t,this.point1,this.point2)},n.prototype.intersectsRay=function(t){return t.intersectsLineSegment(this)},n.prototype.intersectsLineSegment=function(t){if(this.isContainedByLineSegment(t)||t.isContainedByLineSegment(this))return!0;if(!this.lineSegmentIsOnSameLine(t))return!1;var n=this.getPointsInSameDirection(t.point1,t.point2),e=n.point1,i=n.point2;return!this.comesBefore(i,this.point1)&&!this.comesBefore(this.point2,e)},n.prototype.intersectsLine=function(t){return t.intersectsSubsetOfLine(this)},n.prototype.intersects=function(t){return t.intersectsLineSegment(this)},n.prototype.expandToIncludePoint=function(t){return this.containsPoint(t)?this:this.pointIsOnSameLine(t)?this.comesBefore(t,this.point1)?new n(t,this.point2):new n(this.point1,t):W.createTriangle(this.point1,t,this.point2)},n.prototype.expandToIncludeInfinityInDirection=function(t){return t.inSameDirectionAs(this.direction)?new Ft(this.point1,t):0===t.cross(this.direction)?new Ft(this.point2,t):W.createTriangleWithInfinityInDirection(this.point1,this.point2,t)},n.prototype.transform=function(t){return new n(t.apply(this.point1),t.apply(this.point2))},n}(Bt),Rt=new(function(){function t(){}return t.prototype.addPoint=function(t){return F},t.prototype.addPointAtInfinity=function(t){return this},t.prototype.addArea=function(t){return F},t}()),kt=function(){function t(t){this.towardsMiddle=t}return t.prototype.addPoint=function(t){return W.createFromHalfPlane(new D(t,this.towardsMiddle))},t.prototype.addPointAtInfinity=function(t){return t.dot(this.towardsMiddle)>=0?this:Rt},t.prototype.addArea=function(t){var n=this.towardsMiddle.getPerpendicular();return t.expandToIncludeInfinityInDirection(this.towardsMiddle).expandToIncludeInfinityInDirection(n).expandToIncludeInfinityInDirection(n.scale(-1))},t}(),Et=function(){function t(t,n){this.direction1=t,this.direction2=n}return t.prototype.addPoint=function(t){return W.createTriangleWithInfinityInTwoDirections(t,this.direction1,this.direction2)},t.prototype.addPointAtInfinity=function(n){return n.isInSmallerAngleBetweenPoints(this.direction1,this.direction2)?this:0===n.cross(this.direction1)?new kt(this.direction2.projectOn(this.direction1.getPerpendicular())):0===n.cross(this.direction2)?new kt(this.direction1.projectOn(this.direction2.getPerpendicular())):this.direction1.isInSmallerAngleBetweenPoints(n,this.direction2)?new t(n,this.direction2):this.direction2.isInSmallerAngleBetweenPoints(n,this.direction1)?new t(n,this.direction1):Rt},t.prototype.addArea=function(t){return t.expandToIncludeInfinityInDirection(this.direction1).expandToIncludeInfinityInDirection(this.direction2)},t}(),Nt=function(){function t(t){this.direction=t}return t.prototype.addPoint=function(t){return new Lt(t,this.direction)},t.prototype.addPointAtInfinity=function(t){return 0===t.cross(this.direction)?this:new kt(t.projectOn(this.direction.getPerpendicular()))},t.prototype.addArea=function(t){return t.expandToIncludeInfinityInDirection(this.direction).expandToIncludeInfinityInDirection(this.direction.scale(-1))},t}(),Mt=function(){function t(t){this.direction=t}return t.prototype.addPointAtInfinity=function(t){return t.inSameDirectionAs(this.direction)?this:0===t.cross(this.direction)?new Nt(this.direction):new Et(this.direction,t)},t.prototype.addPoint=function(t){return new Ft(t,this.direction)},t.prototype.addArea=function(t){return t.expandToIncludeInfinityInDirection(this.direction)},t}(),Vt=function(){function t(t,n,e){this._area=t,this.firstPoint=n,this.subsetOfLineAtInfinity=e}return Object.defineProperty(t.prototype,"area",{get:function(){return this._area||Ot},enumerable:!1,configurable:!0}),t.prototype.addPoint=function(t){this._area?this._area=this._area.expandToIncludePoint(t):this.firstPoint?t.equals(this.firstPoint)||(this._area=new jt(this.firstPoint,t)):this.subsetOfLineAtInfinity?this._area=this.subsetOfLineAtInfinity.addPoint(t):this.firstPoint=t},t.prototype.addPosition=function(t){nt(t)?this.addInfinityInDirection(t.direction):this.addPoint(t)},t.prototype.addInfinityInDirection=function(t){this._area?this._area=this._area.expandToIncludeInfinityInDirection(t):this.firstPoint?this._area=new Ft(this.firstPoint,t):this.subsetOfLineAtInfinity?(this.subsetOfLineAtInfinity=this.subsetOfLineAtInfinity.addPointAtInfinity(t),this.subsetOfLineAtInfinity===Rt&&(this._area=F)):this.subsetOfLineAtInfinity=new Mt(t)},t.prototype.transformedWith=function(t){return new _t(this,t)},t.prototype.copy=function(){return new t(this._area,this.firstPoint,this.subsetOfLineAtInfinity)},t}(),qt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Ht=function(t){function n(n,e,i,o,r,s){var a=t.call(this,n,i,s)||this;return a.infinity=e,a.instruction=o,a.stateConversion=r,a}return qt(n,t),n.prototype.executeInstruction=function(t,n){this.instruction(t,n,this.infinity)},n.prototype.replaceInstruction=function(t){this.instruction=t},n.prototype.copy=function(t){return new n(this.initialState,t.getInfinity(this.state),this.state,this.instruction,this.stateConversion,this.rectangle)},n.create=function(t,e,i,o){return new n(t,e,t,i,(function(){}),o)},n}(mt);var Gt=function(){function t(t){this.shape=t}return t.prototype.getInstructionToDrawLineTo=function(t,n){return this.getInstructionToExtendShapeWithLineTo(this.shape.transform(n.current.transformation.inverse()),t)},t.prototype.getInstructionToMoveToBeginning=function(t){return this.getInstructionToMoveToBeginningOfShape(this.shape.transform(t.current.transformation.inverse()))},Object.defineProperty(t.prototype,"currentPosition",{get:function(){return this.shape.currentPosition},enumerable:!1,configurable:!0}),t.prototype.moveToInfinityFromPointInDirection=function(t,n){return function(e,i,o){o.moveToInfinityFromPointInDirection(e,i,t,n)}},t.prototype.lineFromInfinityFromPointToInfinityFromPoint=function(t,n,e){return function(i,o,r){r.drawLineFromInfinityFromPointToInfinityFromPoint(i,o,t,n,e)}},t.prototype.lineFromInfinityFromPointToPoint=function(t,n){return function(e,i,o){o.drawLineFromInfinityFromPointToPoint(e,i,t,n)}},t.prototype.lineToInfinityFromPointInDirection=function(t,n){return function(e,i,o){o.drawLineToInfinityFromPointInDirection(e,i,t,n)}},t.prototype.lineToInfinityFromInfinityFromPoint=function(t,n,e){return function(i,o,r){r.drawLineToInfinityFromInfinityFromPoint(i,o,t,n,e)}},t.prototype.lineTo=function(t){return function(n,e){var i=e.apply(t),o=i.x,r=i.y;n.lineTo(o,r)}},t.prototype.moveTo=function(t){return function(n,e){var i=e.apply(t),o=i.x,r=i.y;n.moveTo(o,r)}},t}(),Ut=function(){function t(t,n,e,i){this.initialPosition=t,this.firstFinitePoint=n,this.lastFinitePoint=e,this.currentPosition=i}return t.prototype.transform=function(n){return new t(n.applyToPointAtInfinity(this.initialPosition),n.apply(this.firstFinitePoint),n.apply(this.lastFinitePoint),n.applyToPointAtInfinity(this.currentPosition))},t}(),zt=function(){function t(t,n,e){this.initialPosition=t,this.firstFinitePoint=n,this.currentPosition=e}return t.prototype.transform=function(n){return new t(n.applyToPointAtInfinity(this.initialPosition),n.apply(this.firstFinitePoint),n.apply(this.currentPosition))},t}();function Yt(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(n,e,i){for(var o=0,r=t;o<r.length;o++){(0,r[o])(n,e,i)}}}var Xt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Zt=function(t){function n(n,e){var i=t.call(this,e)||this;return i.pathBuilderProvider=n,i}return Xt(n,t),n.prototype.getInstructionToMoveToBeginningOfShape=function(t){return 0===t.initialPosition.direction.cross(t.currentPosition.direction)?this.moveToInfinityFromPointInDirection(t.firstFinitePoint,t.initialPosition.direction):Yt(this.moveToInfinityFromPointInDirection(t.lastFinitePoint,t.currentPosition.direction),this.lineToInfinityFromInfinityFromPoint(t.lastFinitePoint,t.currentPosition.direction,t.initialPosition.direction),this.lineFromInfinityFromPointToInfinityFromPoint(t.lastFinitePoint,t.firstFinitePoint,t.initialPosition.direction))},n.prototype.getInstructionToExtendShapeWithLineTo=function(t,n){return nt(n)?this.lineToInfinityFromInfinityFromPoint(t.lastFinitePoint,t.currentPosition.direction,n.direction):Yt(this.lineFromInfinityFromPointToInfinityFromPoint(t.lastFinitePoint,n,t.currentPosition.direction),this.lineFromInfinityFromPointToPoint(n,t.currentPosition.direction))},n.prototype.containsFinitePoint=function(){return!0},n.prototype.isClosable=function(){return!this.shape.initialPosition.direction.isInOppositeDirectionAs(this.shape.currentPosition.direction)},n.prototype.canAddLineTo=function(t){return!nt(t)||!t.direction.isInOppositeDirectionAs(this.shape.currentPosition.direction)},n.prototype.addPosition=function(t){return nt(t)?this.pathBuilderProvider.fromPointAtInfinityToPointAtInfinity(new Ut(this.shape.initialPosition,this.shape.firstFinitePoint,this.shape.lastFinitePoint,t)):this.pathBuilderProvider.fromPointAtInfinityToPoint(new zt(this.shape.initialPosition,this.shape.firstFinitePoint,t))},n}(Gt),Jt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Qt=function(t){function n(n,e){var i=t.call(this,e)||this;return i.pathBuilderProvider=n,i}return Jt(n,t),n.prototype.getInstructionToMoveToBeginningOfShape=function(t){var n=this.moveToInfinityFromPointInDirection(t.currentPosition,t.initialPosition.direction);return t.currentPosition.equals(t.firstFinitePoint)?n:Yt(n,this.lineFromInfinityFromPointToInfinityFromPoint(t.currentPosition,t.firstFinitePoint,t.initialPosition.direction))},n.prototype.getInstructionToExtendShapeWithLineTo=function(t,n){return nt(n)?this.lineToInfinityFromPointInDirection(t.currentPosition,n.direction):this.lineTo(n)},n.prototype.canAddLineTo=function(t){return!0},n.prototype.containsFinitePoint=function(){return!0},n.prototype.isClosable=function(){return!0},n.prototype.addPosition=function(t){return nt(t)?this.pathBuilderProvider.fromPointAtInfinityToPointAtInfinity(new Ut(this.shape.initialPosition,this.shape.firstFinitePoint,this.shape.currentPosition,t)):this.pathBuilderProvider.fromPointAtInfinityToPoint(new zt(this.shape.initialPosition,this.shape.firstFinitePoint,t))},n}(Gt),Kt=function(){function t(t,n){this.initialPoint=t,this.currentPosition=n}return t.prototype.transform=function(n){return new t(n.apply(this.initialPoint),n.applyToPointAtInfinity(this.currentPosition))},t}(),$t=function(){function t(t,n){this.initialPoint=t,this.currentPosition=n}return t.prototype.transform=function(n){return new t(n.apply(this.initialPoint),n.apply(this.currentPosition))},t}(),tn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),nn=function(t){function n(n,e){var i=t.call(this,e)||this;return i.pathBuilderProvider=n,i}return tn(n,t),n.prototype.getInstructionToMoveToBeginningOfShape=function(t){return this.moveTo(t.initialPoint)},n.prototype.getInstructionToExtendShapeWithLineTo=function(t,n){return nt(n)?n.direction.inSameDirectionAs(t.currentPosition.direction)?function(){}:this.lineToInfinityFromInfinityFromPoint(t.initialPoint,t.currentPosition.direction,n.direction):Yt(this.lineFromInfinityFromPointToInfinityFromPoint(t.initialPoint,n,t.currentPosition.direction),this.lineFromInfinityFromPointToPoint(n,t.currentPosition.direction))},n.prototype.canAddLineTo=function(t){return!nt(t)||!t.direction.isInOppositeDirectionAs(this.shape.currentPosition.direction)},n.prototype.containsFinitePoint=function(){return!0},n.prototype.isClosable=function(){return!0},n.prototype.addPosition=function(t){return nt(t)?this.pathBuilderProvider.fromPointToPointAtInfinity(new Kt(this.shape.initialPoint,t)):this.pathBuilderProvider.fromPointToPoint(new $t(this.shape.initialPoint,t))},n}(Gt),en=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),on=function(t){function n(n,e){var i=t.call(this,e)||this;return i.pathBuilderProvider=n,i}return en(n,t),n.prototype.getInstructionToMoveToBeginningOfShape=function(t){return this.moveTo(t.initialPoint)},n.prototype.getInstructionToExtendShapeWithLineTo=function(t,n){if(nt(n)){var e=this.lineToInfinityFromPointInDirection(t.currentPosition,n.direction);return 0===t.currentPosition.minus(t.initialPoint).cross(n.direction)?e:Yt(e,this.lineFromInfinityFromPointToInfinityFromPoint(t.currentPosition,t.initialPoint,n.direction))}return this.lineTo(n)},n.prototype.canAddLineTo=function(t){return!0},n.prototype.containsFinitePoint=function(){return!0},n.prototype.isClosable=function(){return!0},n.prototype.addPosition=function(t){return nt(t)?this.pathBuilderProvider.fromPointToPointAtInfinity(new Kt(this.shape.initialPoint,t)):this.pathBuilderProvider.fromPointToPoint(new $t(this.shape.initialPoint,t))},n}(Gt),rn=function(){function t(t,n,e,i){this.initialPosition=t,this.containsFinitePoint=n,this.positionsSoFar=e,this.currentPosition=i}return t.prototype.transform=function(n){return new t(n.applyToPointAtInfinity(this.initialPosition),this.containsFinitePoint,this.positionsSoFar.map((function(t){return n.applyToPointAtInfinity(t)})),n.applyToPointAtInfinity(this.currentPosition))},t}(),sn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),an=function(t){function n(n,e){var i=t.call(this,e)||this;return i.pathBuilderProvider=n,i}return sn(n,t),n.prototype.getInstructionToMoveToBeginningOfShape=function(t){return t.containsFinitePoint?function(t,n,e){return e.addPathAroundViewbox(t)}:function(){}},n.prototype.getInstructionToExtendShapeWithLineTo=function(t,n){if(!nt(n)){if(1===t.positionsSoFar.length)return this.lineFromInfinityFromPointToPoint(n,t.positionsSoFar[0].direction);for(var e,i=t.positionsSoFar.slice(1),o=t.initialPosition,r=[],s=0,a=i;s<a.length;s++){var c=a[s];r.push(this.lineToInfinityFromInfinityFromPoint(n,o.direction,c.direction)),o=c}return Yt((e=r,function(t,n,i){for(var o=0,r=e;o<r.length;o++)(0,r[o])(t,n,i)}),this.lineFromInfinityFromPointToPoint(n,o.direction))}},n.prototype.canAddLineTo=function(t){return!nt(t)||!t.direction.isInOppositeDirectionAs(this.shape.currentPosition.direction)},n.prototype.containsFinitePoint=function(){return this.shape.containsFinitePoint},n.prototype.isClosable=function(){return!0},n.prototype.addPosition=function(t){if(nt(t)){var n=t.direction.isOnSameSideOfOriginAs(this.shape.initialPosition.direction,this.shape.currentPosition.direction)?this.shape.containsFinitePoint:!this.shape.containsFinitePoint;return this.pathBuilderProvider.atInfinity(new rn(this.shape.initialPosition,n,this.shape.positionsSoFar.concat([t]),t))}return this.pathBuilderProvider.fromPointAtInfinityToPoint(new zt(this.shape.initialPosition,t,t))},n}(Gt),cn=function(){function t(){}return t.prototype.fromPointAtInfinityToPointAtInfinity=function(t){return new Zt(this,t)},t.prototype.fromPointAtInfinityToPoint=function(t){return new Qt(this,t)},t.prototype.fromPointToPointAtInfinity=function(t){return new nn(this,t)},t.prototype.fromPointToPoint=function(t){return new on(this,t)},t.prototype.atInfinity=function(t){return new an(this,t)},t.prototype.getBuilderFromPosition=function(t){return nt(t)?new an(this,new rn(t,!1,[t],t)):new on(this,new $t(t,t))},t}(),un=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),hn=function(t){function n(n,e,i,o){var r=t.call(this,n)||this;return r._initiallyWithState=n,r.pathInfinityProvider=e,r.pathInstructionBuilder=i,r.rectangle=o,r}return un(n,t),Object.defineProperty(n.prototype,"currentPosition",{get:function(){return this.pathInstructionBuilder.currentPosition},enumerable:!1,configurable:!0}),n.prototype.addInstruction=function(t){t.setInitialState(this.state),this.add(t)},n.prototype.closePath=function(){var t=It.create(this.state,(function(t){t.closePath()}),this.rectangle);t.setInitialState(this.state),this.add(t)},n.prototype.copy=function(t){for(var e=new n(this._initiallyWithState.copy(t),t,this.pathInstructionBuilder,this.rectangle),i=0,o=this.added;i<o.length;i++){var r=o[i];e.add(r.copy(t))}return e},n.prototype.containsFinitePoint=function(){return this.pathInstructionBuilder.containsFinitePoint()},n.prototype.isClosable=function(){return this.pathInstructionBuilder.isClosable()},n.prototype.canAddLineTo=function(t){return this.pathInstructionBuilder.canAddLineTo(t)},n.prototype.lineTo=function(t,n){var e=Ct(t,n.current.transformation);nt(t)&&!this.pathInstructionBuilder.containsFinitePoint()||this.addInstructionToDrawLineTo(t,n),this.pathInstructionBuilder=this.pathInstructionBuilder.addPosition(e);var i=this.pathInstructionBuilder.getInstructionToMoveToBeginning(this._initiallyWithState.state);this._initiallyWithState.replaceInstruction((function(t,n,e){i(t,n,e)}))},n.prototype.addInstructionToDrawLineTo=function(t,n){var e=this.pathInstructionBuilder.getInstructionToDrawLineTo(t,n),i=this.pathInfinityProvider.getInfinity(n),o=Ht.create(n,i,e,this.rectangle);o.setInitialState(this.state),this.add(o)},n.prototype.addPathInstruction=function(t,n,e){var i,o;t.initialPoint&&(i=this.pathInstructionBuilder.currentPosition,o=t.initialPoint,!(i?o?nt(i)?nt(o)&&i.direction.equals(o.direction):!nt(o)&&i.equals(o):!i:!o))&&this.lineTo(t.initialPoint,e),t.positionChange&&(this.pathInstructionBuilder=this.pathInstructionBuilder.addPosition(Ct(t.positionChange,e.current.transformation))),n.setInitialState(this.state),this.add(n)},n.create=function(t,e,i,o){var r=i.getInfinity(t),s=Ct(e,t.current.transformation),a=(new cn).getBuilderFromPosition(s),c=a.getInstructionToMoveToBeginning(t);return new n(Ht.create(t,r,c,o),i,a,o)},n}(yt),pn={direction:new s(0,1)},fn={direction:new s(0,-1)},ln={direction:new s(-1,0)},yn={direction:new s(1,0)};function dn(t,n){return!!Number.isFinite(t)||!Number.isFinite(n)&&(t<0&&n>0||t>0&&n<0)}function vn(t,n,e,i){return dn(t,e)&&dn(n,i)}var gn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Pn=function(t){function n(n,e,i){var o=t.call(this,n)||this;return o._initiallyWithState=n,o.rectangle=e,o.pathInfinityProvider=i,o.areaBuilder=new Vt,o}return gn(n,t),Object.defineProperty(n.prototype,"area",{get:function(){return this.areaBuilder.area},enumerable:!1,configurable:!0}),n.prototype.getCurrentlyDrawableArea=function(){if(this.area)return this.state.current.clippingRegion?this.state.current.clippingRegion.intersectWith(this.area):this.area},n.prototype.containsFinitePoint=function(){for(var t=0,n=this.added;t<n.length;t++){if(n[t].containsFinitePoint())return!0}return!1},n.prototype.currentSubpathIsClosable=function(){return 0===this.added.length||this.added[this.added.length-1].isClosable()},n.prototype.allSubpathsAreClosable=function(){if(0===this.added.length)return!0;for(var t=0,n=this.added;t<n.length;t++){if(!n[t].isClosable())return!1}return!0},n.prototype.fillPath=function(t,n){this.drawPath(t,n)},n.prototype.strokePath=function(t,n){this.pathInfinityProvider.addDrawnLineWidth(n.current.getMaximumLineWidth()),this.pathInfinityProvider.addLineDashPeriod(n.current.getLineDashPeriod()),this.drawPath(t,n)},n.prototype.drawPath=function(t,n){if(0!==this.added.length){var e=this.added[this.added.length-1],i=this.getCurrentlyDrawableArea();this.drawnArea=i;var o=It.create(n,t,this.rectangle);e.addInstruction(o)}},n.prototype.clipPath=function(t,n){if(0!==this.added.length){var e=this.added[this.added.length-1],i=It.create(n,t,this.rectangle);e.addInstruction(i);var o=this.recreatePath();this.addClippedPath(o)}},n.prototype.closePath=function(){0!==this.added.length&&this.added[this.added.length-1].closePath()},n.prototype.moveTo=function(t,n){var e=Ct(t,n.current.transformation);this.areaBuilder.addPosition(e);var i=hn.create(n,t,this.pathInfinityProvider,this.rectangle);i.setInitialState(this.state),this.add(i)},n.prototype.canAddLineTo=function(t,n){if(0===this.added.length)return!0;var e=Ct(t,n.current.transformation);return this.added[this.added.length-1].canAddLineTo(e)},n.prototype.lineTo=function(t,n){if(0!==this.added.length){var e=this.added[this.added.length-1],i=Ct(t,n.current.transformation);this.areaBuilder.addPosition(i),e.lineTo(t,n)}else this.moveTo(t,n)},n.prototype.moveToPositionDeterminedBy=function(t,n,e){Number.isFinite(t)?Number.isFinite(n)?this.moveTo(new s(t,n),e):this.moveTo(n<0?fn:pn,e):this.moveTo(t<0?ln:yn,e)},n.prototype.rect=function(t,n,e,i,o){if(!Number.isFinite(t)&&!Number.isFinite(n))return this.moveTo({direction:new s(1,0)},o),this.lineTo({direction:new s(0,1)},o),void this.lineTo({direction:new s(-1,-1)},o);this.moveToPositionDeterminedBy(t,n,o),vn(t,n,e,i)&&(Number.isFinite(t)?Number.isFinite(n)?(Number.isFinite(e)?(this.lineTo(new s(t+e,n),o),Number.isFinite(i)?(this.lineTo(new s(t+e,n+i),o),this.lineTo(new s(t,n+i),o)):this.lineTo(i>0?pn:fn,o)):(this.lineTo(e>0?yn:ln,o),Number.isFinite(i)?this.lineTo(new s(t,n+i),o):this.lineTo(i>0?pn:fn,o)),this.lineTo(new s(t,n),o)):(Number.isFinite(e)?this.lineTo(new s(t+e,0),o):this.lineTo(e>0?yn:ln,o),this.lineTo(i>0?pn:fn,o),this.lineTo(new s(t,0),o),this.lineTo(n<0?fn:pn,o)):(this.lineTo(new s(0,n),o),this.lineTo(e>0?yn:ln,o),Number.isFinite(i)?this.lineTo(new s(0,n+i),o):this.lineTo(i>0?pn:fn,o),this.lineTo(t<0?ln:yn,o)))},n.prototype.addPathInstruction=function(t,n){if(0===this.added.length){if(!t.initialPoint)return;this.moveTo(t.initialPoint,n)}var e=this.added[this.added.length-1],i=Ct(e.currentPosition,n.current.transformation.inverse());t.changeArea(this.areaBuilder.transformedWith(n.current.transformation),i);var o=It.create(n,t.instruction,this.rectangle);e.addPathInstruction(t,o,n)},n.prototype.hasDrawingAcrossBorderOf=function(t){return!t.contains(this.area)&&this.area.intersects(t)},n.prototype.isContainedBy=function(t){return t.contains(this.drawnArea)},n.prototype.intersects=function(t){return!!this.area&&this.area.intersects(t)},n.prototype.getClippedArea=function(t){return t?this.area.intersectWith(t):this.area},n.prototype.recreatePath=function(){for(var t=this.rectangle.getForPath(),e=new n(this._initiallyWithState.copy(),this.rectangle,t),i=0,o=this.added;i<o.length;i++){var r=o[i];e.add(r.copy(t))}return e.areaBuilder=this.areaBuilder.copy(),e.setInitialState(e.stateOfFirstInstruction),e},n.create=function(t,e,i){return new n(It.create(t,(function(t){t.beginPath()}),e),e,i)},n}(yt),mn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),wn=function(t){function n(n,e,i,o,r,s){var a=t.call(this,n,e,i,o,s)||this;return a.area=r,a}return mn(n,t),n.prototype.hasDrawingAcrossBorderOf=function(t){return this.intersects(t)&&!this.isContainedBy(t)},n.prototype.intersects=function(t){return this.area.intersects(t)},n.prototype.isContainedBy=function(t){return t.contains(this.area)},n.createDrawing=function(t,e,i,o){return new n(t,t,e,(function(){}),i,o)},n}(It);function In(t,n){return!Number.isFinite(t)&&!Number.isFinite(n)&&(t<0&&n>0||t>0&&n<0)}function bn(t,n,e,i){return In(t,e)&&In(n,i)}var Tn=function(){function t(t,n){this.onChange=t,this.rectangle=n,this.previousInstructionsWithPath=xt.create(n),this.state=this.previousInstructionsWithPath.state}return t.prototype.beginPath=function(){this.replaceCurrentInstructionsWithPath(Pn.create(this.state,this.rectangle,this.rectangle.getForPath()))},t.prototype.changeState=function(t){this.state=this.state.withCurrentState(t(this.state.current))},t.prototype.saveState=function(){this.state=this.state.saved(),this.setInstructionToRestoreState()},t.prototype.restoreState=function(){this.state=this.state.restored(),this.setInstructionToRestoreState()},t.prototype.allSubpathsAreClosable=function(){return!this.currentInstructionsWithPath||this.currentInstructionsWithPath.allSubpathsAreClosable()},t.prototype.currentPathContainsFinitePoint=function(){return this.currentInstructionsWithPath&&this.currentInstructionsWithPath.containsFinitePoint()},t.prototype.currentSubpathIsClosable=function(){return!this.currentInstructionsWithPath||this.currentInstructionsWithPath.currentSubpathIsClosable()},t.prototype.fillPath=function(t){this.drawPath(t,(function(t,n,e){t.fillPath(n,e)}))},t.prototype.strokePath=function(){this.drawPath((function(t){t.stroke()}),(function(t,n,e){t.strokePath(n,e)}))},t.prototype.fillRect=function(t,n,e,i,o){this.drawRect(t,n,e,i,o,(function(t,n,e){t.fillPath(n,e)}))},t.prototype.strokeRect=function(t,n,e,i){this.drawRect(t,n,e,i,(function(t){t.stroke()}),(function(t,n,e){t.strokePath(n,e)}))},t.prototype.drawPath=function(t,n){if(this.currentInstructionsWithPath){var e=this.state.current.isTransformable();e||(t=this.rectangle.transformRelatively(t)),this.state=this.state.currentlyTransformed(e);var i=this.currentInstructionsWithPath.recreatePath();n(this.currentInstructionsWithPath,t,this.state),this.previousInstructionsWithPath.add(this.currentInstructionsWithPath),i.setInitialStateWithClippedPaths(this.previousInstructionsWithPath.state),this.currentInstructionsWithPath=i,this.setInstructionToRestoreState(),this.onChange()}},t.prototype.drawRect=function(t,n,e,i,o,r){this.state.current.isTransformable()||(o=this.rectangle.transformRelatively(o));var s=this.state.currentlyTransformed(this.state.current.isTransformable()),a=Pn.create(s,this.rectangle,this.rectangle.getForPath());a.rect(t,n,e,i,s),r(a,o,s),this.drawBeforeCurrentPath(a),this.onChange()},t.prototype.addDrawing=function(t,n,e,i){e===o.Relative?(t=this.rectangle.transformRelatively(t),n=n.transform(this.state.current.transformation)):e===o.Absolute&&(t=this.rectangle.transformAbsolutely(t));var r=n;this.state.current.clippingRegion&&i&&(r=n.intersectWith(this.state.current.clippingRegion));var s=wn.createDrawing(this.state.currentlyTransformed(!1),t,r,this.rectangle);this.drawBeforeCurrentPath(s),this.onChange()},t.prototype.clipPath=function(t){this.clipCurrentPath(t)},t.prototype.replaceCurrentInstructionsWithPath=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];for(var i=0,o=n;i<o.length;i++){var r=o[i];r.setInitialStateWithClippedPaths(this.previousInstructionsWithPath.state),this.previousInstructionsWithPath.add(r)}t.setInitialStateWithClippedPaths(this.previousInstructionsWithPath.state),this.currentInstructionsWithPath=t,this.setInstructionToRestoreState()},t.prototype.clipCurrentPath=function(t){this.currentInstructionsWithPath&&(this.currentInstructionsWithPath.clipPath(t,this.state),this.state=this.currentInstructionsWithPath.state)},t.prototype.setInstructionToRestoreState=function(){var t=this.previousInstructionsWithPath.state;this.instructionToRestoreState=t.getInstructionToClearStack()},t.prototype.drawBeforeCurrentPath=function(t){if(this.currentInstructionsWithPath){var n=this.currentInstructionsWithPath.recreatePath();n.setInitialState(this.currentInstructionsWithPath.state),this.replaceCurrentInstructionsWithPath(n,t)}else t.setInitialState(this.previousInstructionsWithPath.state),this.previousInstructionsWithPath.add(t),this.state=this.previousInstructionsWithPath.state},t.prototype.addPathInstruction=function(t){this.currentInstructionsWithPath&&this.currentInstructionsWithPath.addPathInstruction(t,this.state)},t.prototype.closePath=function(){this.currentInstructionsWithPath&&this.currentInstructionsWithPath.closePath()},t.prototype.moveTo=function(t){this.currentInstructionsWithPath&&this.currentInstructionsWithPath.moveTo(t,this.state)},t.prototype.canAddLineTo=function(t){return!this.currentInstructionsWithPath||this.currentInstructionsWithPath.canAddLineTo(t,this.state)},t.prototype.lineTo=function(t){this.currentInstructionsWithPath&&this.currentInstructionsWithPath.lineTo(t,this.state)},t.prototype.rect=function(t,n,e,i){this.currentInstructionsWithPath&&this.currentInstructionsWithPath.rect(t,n,e,i,this.state)},t.prototype.intersects=function(t){return this.previousInstructionsWithPath.intersects(t)||this.currentInstructionsWithPath&&this.currentInstructionsWithPath.intersects(t)},t.prototype.clearContentsInsideArea=function(t){this.previousInstructionsWithPath.clearContentsInsideArea(t),this.currentInstructionsWithPath&&this.currentInstructionsWithPath.setInitialStateWithClippedPaths(this.previousInstructionsWithPath.state)},t.prototype.clearArea=function(t,n,e,i){if(vn(t,n,e,i)){var o=bn(t,n,e,i)?F:W.createRectangle(t,n,e,i),r=o.transform(this.state.current.transformation);this.intersects(r)&&(this.clearContentsInsideArea(r),this.previousInstructionsWithPath.hasDrawingAcrossBorderOf(r)&&(this.previousInstructionsWithPath.addClearRect(o,this.state,t,n,e,i),this.currentInstructionsWithPath&&this.currentInstructionsWithPath.setInitialStateWithClippedPaths(this.state)),this.onChange())}},t.prototype.execute=function(t,n){this.previousInstructionsWithPath.length&&this.previousInstructionsWithPath.execute(t,n),this.instructionToRestoreState&&this.instructionToRestoreState(t,n)},t}(),Sn=function(t,n,e,i){return new(e||(e=Promise))((function(o,r){function s(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,a)}c((i=i.apply(t,n||[])).next())}))},xn=function(t,n){var e,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=n.call(t,s)}catch(t){r=[6,t],i=0}finally{e=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},Cn=function(){function t(t,n,e,i,o){var r=this;this.canvasRectangle=t,this.context=n,this.drawingIterationProvider=e,this.drawLockProvider=i,this.isTransforming=o,this.instructionSet=new Tn((function(){return r.draw()}),t)}return Object.defineProperty(t.prototype,"width",{get:function(){return this.canvasRectangle.viewboxWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvasRectangle.viewboxHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this.instructionSet.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transformation",{get:function(){return this.canvasRectangle.transformation},set:function(t){this.canvasRectangle.transformation=t,this.draw()},enumerable:!1,configurable:!0}),t.prototype.getDrawingLock=function(){return this.drawLockProvider()},t.prototype.changeState=function(t){this.instructionSet.changeState(t)},t.prototype.measureText=function(t){this.context.save(),at.default.getInstructionToConvertToState(this.state.currentlyTransformed(!1).current,this.canvasRectangle)(this.context,a.identity);var n=this.context.measureText(t);return this.context.restore(),n},t.prototype.saveState=function(){this.instructionSet.saveState()},t.prototype.restoreState=function(){this.instructionSet.restoreState()},t.prototype.beginPath=function(){this.instructionSet.beginPath()},t.prototype.createPatternFromImageData=function(t){return Sn(this,void 0,void 0,(function(){var n;return xn(this,(function(e){switch(e.label){case 0:return[4,createImageBitmap(t)];case 1:return n=e.sent(),[2,this.context.createPattern(n,"no-repeat")]}}))}))},t.prototype.addDrawing=function(t,n,e,i){this.instructionSet.addDrawing(t,n,e,i)},t.prototype.addPathInstruction=function(t){this.instructionSet.addPathInstruction(t)},t.prototype.closePath=function(){this.instructionSet.currentSubpathIsClosable()&&this.instructionSet.closePath()},t.prototype.moveTo=function(t){this.instructionSet.moveTo(t)},t.prototype.lineTo=function(t){this.instructionSet.canAddLineTo(t)&&this.instructionSet.lineTo(t)},t.prototype.rect=function(t,n,e,i){this.instructionSet.rect(t,n,e,i)},t.prototype.currentPathCanBeFilled=function(){return this.instructionSet.allSubpathsAreClosable()&&this.instructionSet.currentPathContainsFinitePoint()},t.prototype.fillPath=function(t){this.instructionSet.fillPath(t)},t.prototype.strokePath=function(){this.instructionSet.strokePath()},t.prototype.fillRect=function(t,n,e,i,o){vn(t,n,e,i)&&this.instructionSet.fillRect(t,n,e,i,o)},t.prototype.strokeRect=function(t,n,e,i){vn(t,n,e,i)&&!bn(t,n,e,i)&&this.instructionSet.strokeRect(t,n,e,i)},t.prototype.clipPath=function(t){this.instructionSet.clipPath(t)},t.prototype.clearArea=function(t,n,e,i){this.instructionSet.clearArea(t,n,e,i)},t.prototype.createLinearGradient=function(t,n,e,i){return new pt(this.context,t,n,e,i)},t.prototype.createRadialGradient=function(t,n,e,i,o,r){return new lt(this.context,t,n,e,i,o,r)},t.prototype.createPattern=function(t,n){return new d(this.context.createPattern(t,n))},t.prototype.draw=function(){var t=this;this.drawingIterationProvider.provideDrawingIteration((function(){t.isTransforming()||t.canvasRectangle.measure(),t.context.restore(),t.context.save(),t.context.clearRect(0,0,t.width,t.height),t.canvasRectangle.applyInitialTransformation(t.context),t.instructionSet.execute(t.context,t.transformation)}))},t}(),_n=function(t,n){this.initial=t,this.cancel=n,this.current=t},On=function(){function t(t){this.point=t,this.handlers=[]}return t.prototype.removeHandler=function(t){var n=this.handlers.indexOf(t);return n>-1&&this.handlers.splice(n,1),this},t.prototype.moveTo=function(t,n){var e=new s(t,n);this.point=e;for(var i=0,o=this.handlers;i<o.length;i++){(0,o[i])(e)}},t.prototype.onMoved=function(t){var n,e=this,i=function(e){n.current=e,t()};return this.handlers.push(i),n=new _n(this.point,(function(){return e.removeHandler(i)}))},t}(),Bn=function(){function t(t,n){var e=this;this.transformable=n,this.initialTransformation=n.transformation,this.angularVelocity=Math.PI/100,this.point=t.onMoved((function(){e.setTransformation()}))}return t.prototype.setTransformation=function(){this.transformable.transformation=this.initialTransformation.before(a.rotation(this.point.initial.x,this.point.initial.y,(this.point.initial.x-this.point.current.x)*this.angularVelocity))},t.prototype.end=function(){this.point.cancel()},t}(),An=function(){function t(t,n,e,i,o){this.transformable=t,this.centerX=n,this.centerY=e,this.onFinish=o,this.initialTransformation=t.transformation,this.maxScaleLogStep=.1,this.currentScaleLog=0,this.targetScaleLog=Math.log(i),this.makeStep()}return t.prototype.makeStep=function(){var t=this,n=this.targetScaleLog-this.currentScaleLog;Math.abs(n)<=this.maxScaleLogStep?(this.currentScaleLog+=n,this.setTransformToCurrentScaleLog(),this.onFinish()):(this.currentScaleLog+=n<0?-this.maxScaleLogStep:this.maxScaleLogStep,this.setTransformToCurrentScaleLog(),this.stepTimeout=setTimeout((function(){return t.makeStep()}),20))},t.prototype.setTransformToCurrentScaleLog=function(){this.transformable.transformation=this.initialTransformation.before(a.zoom(this.centerX,this.centerY,Math.exp(this.currentScaleLog)))},t.prototype.cancel=function(){void 0!==this.stepTimeout&&clearTimeout(this.stepTimeout)},t}(),Ln=function(){function t(){this.latestIdentifier=0,this.records=[]}return t.prototype.addAnchor=function(t,n){var e=++this.latestIdentifier;return this.records.push({identifier:e,anchor:t,externalIdentifier:n}),e},t.prototype.getAnchorByIdentifier=function(t){var n=this.records.find((function(n){return n.identifier===t}));if(n)return n.anchor},t.prototype.getAnchorByExternalIdentifier=function(t){var n=this.records.find((function(n){return n.externalIdentifier===t}));if(n)return n.anchor},t.prototype.removeAnchorByIdentifier=function(t){var n=this.records.findIndex((function(n){return n.identifier===t}));n>-1&&this.records.splice(n,1)},t.prototype.removeAnchorByExternalIdentifier=function(t){var n=this.records.findIndex((function(n){return n.externalIdentifier===t}));n>-1&&this.records.splice(n,1)},t}(),Dn=function(){function t(t,n){var e=this;this.context=n,this.initialTransformation=n.transformation,this.point=t.onMoved((function(){e.setTransformation()}))}return t.prototype.setTransformation=function(){this.context.transformation=this.initialTransformation.before(this.getTranslation())},t.prototype.getTranslation=function(){return a.translation(this.point.current.x-this.point.initial.x,this.point.current.y-this.point.initial.y)},t.prototype.withMovable=function(t){return this.context.getGestureForTwoMovables(this.point.cancel(),t)},t.prototype.withoutMovable=function(t){},t}(),Fn=function(){function t(t,n,e){var i=this;this.context=e,this.initialTransformation=e.transformation,this.point1=t.onMoved((function(){return i.setTransformation()})),this.point2=n.onMoved((function(){return i.setTransformation()}))}return t.prototype.withMovable=function(t){},t.prototype.withoutMovable=function(t){var n=this.point1.cancel(),e=this.point2.cancel();return t===n?this.context.getGestureForOneMovable(e):t===e?this.context.getGestureForOneMovable(n):void 0},t}(),Wn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),jn=function(t){function n(n,e,i){return t.call(this,n,e,i)||this}return Wn(n,t),n.prototype.setTransformation=function(){this.context.transformation=this.initialTransformation.before(a.translateZoom(this.point1.initial.x,this.point1.initial.y,this.point2.initial.x,this.point2.initial.y,this.point1.current.x,this.point1.current.y,this.point2.current.x,this.point2.current.y))},n}(Fn),Rn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),kn=function(t){function n(n,e,i){return t.call(this,n,e,i)||this}return Rn(n,t),n.prototype.setTransformation=function(){this.context.transformation=this.initialTransformation.before(a.translateRotateZoom(this.point1.initial.x,this.point1.initial.y,this.point2.initial.x,this.point2.initial.y,this.point1.current.x,this.point1.current.y,this.point2.current.x,this.point2.current.y))},n}(Fn),En=function(){function t(){this.listeners=[],this.onceListeners=[]}return t.prototype.dispatchEvent=function(t){var n=this.onceListeners;this.onceListeners=[];for(var e=0,i=n;e<i.length;e++){var o=i[e];this.notifyListener(o,t)}for(var r=0,s=this.listeners;r<s.length;r++){var a=s[r];this.notifyListener(a,t)}},t.prototype.addListener=function(t,n){n&&n.once?this.onceListeners.push(t):this.listeners.push(t)},t.prototype.removeListener=function(t){var n=this.listeners.indexOf(t);n>-1&&this.listeners.splice(n,1),(n=this.onceListeners.indexOf(t))>-1&&this.onceListeners.splice(n,1)},t.prototype.notifyListener=function(t,n){try{t(n)}catch(t){console.error(t)}},t}(),Nn=function(){function t(t,n){this.setNewValue=t,this.timeoutInMs=n,this._changing=!1,this._firstChange=new En,this._subsequentChange=new En,this._changeEnd=new En}return Object.defineProperty(t.prototype,"firstChange",{get:function(){return this._firstChange},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subsequentChange",{get:function(){return this._subsequentChange},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"changeEnd",{get:function(){return this._changeEnd},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"changing",{get:function(){return this._changing},enumerable:!1,configurable:!0}),t.prototype.refreshTimeout=function(){var t=this;void 0!==this.currentTimeout&&clearTimeout(this.currentTimeout),this.currentTimeout=setTimeout((function(){t._changing=!1,t.currentTimeout=void 0,t._changeEnd.dispatchEvent()}),this.timeoutInMs)},t.prototype.setValue=function(t){this.setNewValue(t),this._changing?this._subsequentChange.dispatchEvent():(this._changing=!0,this._firstChange.dispatchEvent()),this.refreshTimeout()},t}(),Mn=function(){function t(t,n){var e=this;this.viewBox=t,this.config=n,this.anchorSet=new Ln,this._transformationChangeMonitor=new Nn((function(t){return e.viewBox.transformation=t}),100)}return Object.defineProperty(t.prototype,"isTransforming",{get:function(){return this._transformationChangeMonitor.changing},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transformationStart",{get:function(){return this._transformationChangeMonitor.firstChange},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transformationChange",{get:function(){return this._transformationChangeMonitor.subsequentChange},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transformationEnd",{get:function(){return this._transformationChangeMonitor.changeEnd},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transformation",{get:function(){return this.viewBox.transformation},set:function(t){this._transformationChangeMonitor.setValue(t)},enumerable:!1,configurable:!0}),t.prototype.getGestureForOneMovable=function(t){return new Dn(t,this)},t.prototype.getGestureForTwoMovables=function(t,n){return this.config.rotationEnabled?new kn(t,n,this):new jn(t,n,this)},t.prototype.createAnchorForMovable=function(t){var n=this;return{moveTo:function(n,e){t.moveTo(n,e)},release:function(){n.gesture=n.gesture.withoutMovable(t)}}},t.prototype.createAnchorByExternalIdentifier=function(t,n,e){if(!this.anchorSet.getAnchorByExternalIdentifier(t)){var i=this.getAnchor(n,e);this.anchorSet.addAnchor(i,t)}},t.prototype.createAnchor=function(t,n){var e=this.getAnchor(t,n);return this.anchorSet.addAnchor(e)},t.prototype.createRotationAnchor=function(t,n){var e=this.getRotationAnchor(t,n);return this.anchorSet.addAnchor(e)},t.prototype.moveAnchorByExternalIdentifier=function(t,n,e){var i=this.anchorSet.getAnchorByExternalIdentifier(t);i&&i.moveTo(n,e)},t.prototype.moveAnchorByIdentifier=function(t,n,e){var i=this.anchorSet.getAnchorByIdentifier(t);i&&i.moveTo(n,e)},t.prototype.releaseAnchorByExternalIdentifier=function(t){var n=this.anchorSet.getAnchorByExternalIdentifier(t);n&&(n.release(),this.anchorSet.removeAnchorByExternalIdentifier(t))},t.prototype.releaseAnchorByIdentifier=function(t){var n=this.anchorSet.getAnchorByIdentifier(t);n&&(n.release(),this.anchorSet.removeAnchorByIdentifier(t))},t.prototype.zoom=function(t,n,e){var i=this;this._zoom&&this._zoom.cancel(),this._zoom=new An(this,t,n,e,(function(){i._zoom=void 0}))},t.prototype.getAnchor=function(t,n){var e=new On(new s(t,n));if(!this.gesture)return this.gesture=this.getGestureForOneMovable(e),this.createAnchorForMovable(e);var i=this.gesture.withMovable(e);return i?(this.gesture=i,this.createAnchorForMovable(e)):void 0},t.prototype.getRotationAnchor=function(t,n){var e=new On(new s(t,n)),i=new Bn(e,this);return{moveTo:function(t,n){e.moveTo(t,n)},release:function(){i.end()}}},t}();var Vn,qn=function(t,n,e,i){!function(t,n,e,i){t.addEventListener("wheel",(function(t){if(!i.greedyGestureHandling&&!t.ctrlKey)return!0;var o=e.getCSSPosition(t.clientX,t.clientY),r=o.x,s=o.y,a=t.deltaY,c=Math.pow(2,-a/300);return n.zoom(r,s,c),t.preventDefault(),!1}))}(t,n,i,e),function(t,n,e,i){var o;function r(){void 0!==o&&(n.releaseAnchorByIdentifier(o),o=void 0)}t.addEventListener("mousedown",(function(t){if(void 0===o){var r=e.getCSSPosition(t.clientX,t.clientY),s=r.x,a=r.y;if(1===t.button){if(!i.rotationEnabled)return!0;o=n.createRotationAnchor(s,a)}else o=n.createAnchor(s,a);return t.preventDefault(),!1}})),t.addEventListener("mousemove",(function(t){if(void 0!==o){var i=e.getCSSPosition(t.clientX,t.clientY),r=i.x,s=i.y;n.moveAnchorByIdentifier(o,r,s)}})),t.addEventListener("mouseup",(function(t){r()})),t.addEventListener("mouseleave",(function(t){r()}))}(t,n,i,e),function(t,n,e,i){t.addEventListener("touchstart",(function(t){var o=t.touches;if(1===o.length&&!i.greedyGestureHandling)return!0;if(!t.cancelable)return console.log("touchstart event was not cancelable"),!0;for(var r=0;r<o.length;r++){var s=o[r],a=s.identifier,c=e.getCSSPosition(s.clientX,s.clientY),u=c.x,h=c.y;n.createAnchorByExternalIdentifier(a,u,h)}return t.preventDefault(),!1})),t.addEventListener("touchmove",(function(t){for(var i=t.changedTouches,o=0;o<i.length;o++){var r=i[o],s=e.getCSSPosition(r.clientX,r.clientY),a=s.x,c=s.y;n.moveAnchorByExternalIdentifier(r.identifier,a,c)}})),t.addEventListener("touchend",(function(t){for(var e=t.changedTouches,i=0;i<e.length;i++){var o=e[i];n.releaseAnchorByExternalIdentifier(o.identifier)}}))}(t,n,i,e)},Hn=function(){function t(){this.animationFrameRequested=!1}return t.prototype.provideDrawingIteration=function(t){var n=this;this.animationFrameRequested||(this.animationFrameRequested=!0,requestAnimationFrame((function(){t(),n.animationFrameRequested=!1})))},t}(),Gn=function(){function t(t){this.drawingIterationProvider=t,this._drawCallback=function(){}}return t.prototype.provideDrawingIteration=function(t){var n=this;this.drawingIterationProvider.provideDrawingIteration((function(){t(),n._drawCallback&&n._drawCallback()}))},t.prototype.onDraw=function(t){this._drawCallback=t},t}(),Un=function(){function t(t){this.drawingIterationProvider=t,this._locks=[]}return t.prototype.removeLock=function(t){var n=this._locks.indexOf(t);this._locks.splice(n,1),0===this._locks.length&&this._draw&&this.drawingIterationProvider.provideDrawingIteration(this._draw)},t.prototype.provideDrawingIteration=function(t){this._locks.length?this._draw=t:this.drawingIterationProvider.provideDrawingIteration(t)},t.prototype.getLock=function(){var t,n=this;return t={release:function(){n.removeLock(t)}},this._locks.push(t),t},t}(),zn=function(){function t(t,n,e,i){this.rectangle=t,this.state=n,this.getLineDashPeriod=e,this.getDrawnLineWidth=i}return t.prototype.addPathAroundViewbox=function(t){this.rectangle.addPathAroundViewbox(t,this.getDrawnLineWidth())},t.prototype.getTransformedViewbox=function(){return this.rectangle.getViewboxFromState(this.state,this.getDrawnLineWidth())},t.prototype.clearRect=function(t,n,e,i,o,r){var a=this.getTransformedViewbox(),c=n.a,u=n.b,h=n.c,p=n.d,f=n.e,l=n.f;t.save(),t.transform(c,u,h,p,f,l);var y=Number.isFinite(e)?e:a.getPointInFrontInDirection(new s(0,0),e>0?yn.direction:ln.direction).x,d=Number.isFinite(o)?e+o:a.getPointInFrontInDirection(new s(0,0),o>0?yn.direction:ln.direction).x,v=Number.isFinite(i)?i:a.getPointInFrontInDirection(new s(0,0),i>0?pn.direction:fn.direction).y,g=Number.isFinite(r)?i+r:a.getPointInFrontInDirection(new s(0,0),r>0?pn.direction:fn.direction).y;t.clearRect(y,v,d-y,g-v),t.restore()},t.prototype.moveToInfinityFromPointInDirection=function(t,n,e,i){var o=this.getTransformedViewbox().getPointInFrontInDirection(e,i);this.moveToTransformed(t,o,n)},t.prototype.drawLineToInfinityFromInfinityFromPoint=function(t,n,e,i,o){var r=this.getTransformedViewbox(),s=r.getPointInFrontInDirection(e,i),a=r.getPointInFrontInDirection(e,o),c=r.expandToIncludePoint(e).expandToIncludePoint(s).expandToIncludePoint(a).vertices.map((function(t){return t.point})).filter((function(t){return!t.equals(s)&&!t.equals(a)&&!t.equals(e)&&t.minus(e).isInSmallerAngleBetweenPoints(i,o)}));c.sort((function(t,n){return t.minus(e).isInSmallerAngleBetweenPoints(n.minus(e),i)?-1:1}));for(var u=s,h=0,p=0,f=c;p<f.length;p++){var l=f[p];h+=l.minus(u).mod(),this.lineToTransformed(t,l,n),u=l}h+=a.minus(u).mod(),this.lineToTransformed(t,a,n),this.ensureDistanceCoveredIsMultipleOfLineDashPeriod(t,n,h,a,o)},t.prototype.drawLineFromInfinityFromPointToInfinityFromPoint=function(t,n,e,i,o){var r=this.getTransformedViewbox(),s=r.getPointInFrontInDirection(e,o),a=r.getPointInFrontInDirection(i,o);this.lineToTransformed(t,a,n);var c=a.minus(s).mod();this.ensureDistanceCoveredIsMultipleOfLineDashPeriod(t,n,c,a,o)},t.prototype.drawLineFromInfinityFromPointToPoint=function(t,n,e,i){var o=this.getTransformedViewbox().getPointInFrontInDirection(e,i),r=e.minus(o).mod();this.ensureDistanceCoveredIsMultipleOfLineDashPeriod(t,n,r,o,i),this.lineToTransformed(t,e,n)},t.prototype.drawLineToInfinityFromPointInDirection=function(t,n,e,i){var o=this.getTransformedViewbox().getPointInFrontInDirection(e,i);this.lineToTransformed(t,o,n);var r=o.minus(e).mod();this.ensureDistanceCoveredIsMultipleOfLineDashPeriod(t,n,r,o,i)},t.prototype.ensureDistanceCoveredIsMultipleOfLineDashPeriod=function(t,n,e,i,o){var r=this.getLineDashPeriod();if(0!==r){var s=this.getDistanceLeft(e,r);if(0!==s){var a=i.plus(o.scale(s/(2*o.mod())));this.lineToTransformed(t,a,n),this.lineToTransformed(t,i,n)}}},t.prototype.lineToTransformed=function(t,n,e){var i=e.apply(n),o=i.x,r=i.y;t.lineTo(o,r)},t.prototype.moveToTransformed=function(t,n,e){var i=e.apply(n),o=i.x,r=i.y;t.moveTo(o,r)},t.prototype.getDistanceLeft=function(t,n){if(0===n)return 0;var e=t/n|0;return t-n*e==0?0:(e+1)*n-t},t}(),Yn=function(){function t(t){this.canvasRectangle=t,this.drawnLineWidth=0,this.lineDashPeriod=0}return t.prototype.addDrawnLineWidth=function(t){this.drawnLineWidth=t},t.prototype.addLineDashPeriod=function(t){this.lineDashPeriod=t},t.prototype.getInfinity=function(t){var n=this;return new zn(this.canvasRectangle,t,(function(){return n.lineDashPeriod}),(function(){return n.drawnLineWidth}))},t}();!function(t){t[t.CSS=0]="CSS",t[t.CANVAS=1]="CANVAS"}(Vn||(Vn={}));var Xn=function(){function t(t,n){this.base=t,this.inverseBase=n}return t.prototype.representTransformation=function(t){return this.base.before(t).before(this.inverseBase)},t.prototype.inverseRepresentTransformation=function(t){return this.inverseBase.before(t).before(this.base)},t.identity=new t(a.identity,a.identity),t}(),Zn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Jn=function(t){function n(n,e,i){var o=t.call(this,n,e)||this;return o.infiniteCanvasContext=i,o}return Zn(n,t),Object.defineProperty(n.prototype,"userTransformation",{get:function(){return this.infiniteCanvasContext.base},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"infiniteCanvasContextBase",{get:function(){return this.infiniteCanvasContext.base},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inverseInfiniteCanvasContextBase",{get:function(){return this.infiniteCanvasContext.inverseBase},enumerable:!1,configurable:!0}),n.prototype.representInfiniteCanvasContextTransformation=function(t){return this.infiniteCanvasContext.inverseRepresentTransformation(t)},n.prototype.executeInTransformedInfiniteCanvasContext=function(t,n){var e=this.infiniteCanvasContextBase,i=e.a,o=e.b,r=e.c,s=e.d,a=e.e,c=e.f;n.save(),n.transform(i,o,r,s,a,c),t(n,this.userTransformation),n.restore()},n}(Xn),Qn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Kn=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Qn(n,t),n.prototype.withBase=function(t,e){return new n(t,e,this.infiniteCanvasContext)},n.prototype.withUserTransformation=function(t,e){return new n(this.base,this.inverseBase,new Xn(t,e))},n.create=function(t){return new n(t.inverseScreenTransformation,t.screenTransformation,Xn.identity)},n}(Jn),$n=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),te=function(t){function n(n,e,i){var o=t.call(this,n,e)||this;return o.canvasContextSystem=i,o.infiniteCanvasContextBase=i.infiniteCanvasContextBase.before(i.base),o.inverseInfiniteCanvasContextBase=i.inverseBase.before(i.inverseInfiniteCanvasContextBase),o}return $n(n,t),Object.defineProperty(n.prototype,"userTransformation",{get:function(){return this.canvasContextSystem.userTransformation},enumerable:!1,configurable:!0}),n.prototype.setTransformationToTransformInfiniteCanvasContext=function(t,n){var e=this.canvasContextSystem.representInfiniteCanvasContextTransformation(n).before(this.canvasContextSystem.base),i=e.a,o=e.b,r=e.c,s=e.d,a=e.e,c=e.f;t.setTransform(i,o,r,s,a,c)},n.prototype.setCanvasContextTransformation=function(t){if(!this.canvasContextSystem.base.equals(a.identity)){var n=this.canvasContextSystem.base,e=n.a,i=n.b,o=n.c,r=n.d,s=n.e,c=n.f;t.setTransform(e,i,o,r,s,c)}},n.prototype.rebaseToInfiniteCanvasContext=function(t,n){var e=t.before(this.infiniteCanvasContextBase);return n.transform(e.inverse())},n.prototype.executeInTransformedInfiniteCanvasContext=function(t,n){this.canvasContextSystem.executeInTransformedInfiniteCanvasContext(t,n)},n.prototype.executeInUntransformedInfiniteCanvasContext=function(t,n){var e=this.infiniteCanvasContextBase,i=e.a,o=e.b,r=e.c,s=e.d,a=e.e,c=e.f;n.save(),n.setTransform(i,o,r,s,a,c),t(n,this.userTransformation),n.restore()},n}(Xn),ne=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),ee=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return ne(n,t),n.prototype.withScreenTransformation=function(t,e){return new n(t,e,this.canvasContextSystem.withBase(e,t))},n.prototype.withUserTransformation=function(t,e){return new n(this.base,this.inverseBase,this.canvasContextSystem.withUserTransformation(t,e))},n.create=function(t){return new n(t.screenTransformation,t.inverseScreenTransformation,Kn.create(t))},n}(te),ie=function(){function t(t){this.screen=t,this.infiniteCanvasContextBase=t.infiniteCanvasContextBase.before(t.base),this.inverseInfiniteCanvasContextBase=t.inverseBase.before(t.inverseInfiniteCanvasContextBase)}return Object.defineProperty(t.prototype,"userTransformation",{get:function(){return this.screen.userTransformation},enumerable:!1,configurable:!0}),t.prototype.setTransformationToTransformInfiniteCanvasContext=function(t,n){this.screen.setTransformationToTransformInfiniteCanvasContext(t,n)},t.prototype.setCanvasContextTransformation=function(t){this.screen.setCanvasContextTransformation(t)},t.prototype.rebaseFromScreenContextToInfiniteCanvasContext=function(t,n){return this.screen.rebaseToInfiniteCanvasContext(t,n)},t.prototype.executeInTransformedInfiniteCanvasContext=function(t,n){this.screen.executeInTransformedInfiniteCanvasContext(t,n)},t.prototype.executeInUntransformedInfiniteCanvasContext=function(t,n){this.screen.executeInUntransformedInfiniteCanvasContext(t,n)},t}(),oe=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),re=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return oe(n,t),n.prototype.withUserTransformation=function(t){return new n(this.screen.withUserTransformation(t,t.inverse()))},n.prototype.withScreenTransformation=function(t,e){return new n(this.screen.withScreenTransformation(t,e))},n.create=function(t){return new n(ee.create(t))},n}(ie),se=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),ae=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return se(n,t),n.prototype.changeUserTransformation=function(t,e,i){var o=this.infiniteCanvasContext.base.before(this.base).before(t),r=i.before(o);return new n(r,r.inverse(),new Xn(e,i))},n.create=function(){return new n(a.identity,a.identity,Xn.identity)},n}(Jn),ce=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),ue=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return ce(n,t),n.prototype.withBase=function(t,e){return new n(t,e,this.canvasContextSystem)},n.prototype.withUserTransformation=function(t,e){var i=this.userTransformation.inverse().before(t),o=this.representTransformation(i);return new n(this.base,this.inverseBase,this.canvasContextSystem.changeUserTransformation(o,t,e))},n.create=function(t){return new n(t.screenTransformation,t.inverseScreenTransformation,ae.create())},n}(te),he=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),pe=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return he(n,t),n.prototype.withUserTransformation=function(t){return new n(this.screen.withUserTransformation(t,t.inverse()))},n.prototype.withScreenTransformation=function(t,e){return new n(this.screen.withBase(t,e))},n.create=function(t){return new n(ue.create(t))},n}(ie);function fe(t){var n=t.viewboxWidth,e=t.viewboxHeight,i=t.screenWidth,o=t.screenHeight,r=W.createRectangle(0,0,n,e),s=new a(i/n,0,0,o/e,0,0);return{screenWidth:i,screenHeight:o,viewboxWidth:n,viewboxHeight:e,polygon:r,screenTransformation:s,inverseScreenTransformation:s.inverse()}}var le=function(){function t(t,n){this.measurementProvider=t,this.config=n,this.unitsUsed=n.units===Vn.CSS?Vn.CSS:Vn.CANVAS;var e=fe(this.measurementProvider.measure());this.addMeasurement(e),this.coordinateSystems=n.units===Vn.CSS?re.create(e):pe.create(e)}return Object.defineProperty(t.prototype,"transformation",{get:function(){return this.coordinateSystems.userTransformation},set:function(t){this.coordinateSystems=this.coordinateSystems.withUserTransformation(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"infiniteCanvasContextBase",{get:function(){return this.coordinateSystems.infiniteCanvasContextBase},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inverseInfiniteCanvasContextBase",{get:function(){return this.coordinateSystems.inverseInfiniteCanvasContextBase},enumerable:!1,configurable:!0}),t.prototype.isChange=function(t){return t.viewboxWidth!==this.viewboxWidth||t.viewboxHeight!==this.viewboxHeight||t.screenWidth!==this.screenWidth||t.screenHeight!==this.screenHeight},t.prototype.addMeasurement=function(t){this.viewboxWidth=t.viewboxWidth,this.viewboxHeight=t.viewboxHeight,this.screenWidth=t.screenWidth,this.screenHeight=t.screenHeight,this.polygon=t.polygon},t.prototype.measure=function(){var t,n,e=this.config.units===Vn.CSS?Vn.CSS:Vn.CANVAS;e===Vn.CANVAS&&this.unitsUsed===Vn.CSS&&(this.coordinateSystems=(t=this.coordinateSystems,new pe(new ue(t.screen.base,t.screen.inverseBase,new ae(a.identity,a.identity,t.screen.canvasContextSystem.infiniteCanvasContext))))),e===Vn.CSS&&this.unitsUsed===Vn.CANVAS&&(this.coordinateSystems=(n=this.coordinateSystems,new re(new ee(n.screen.base,n.screen.inverseBase,new Kn(n.screen.inverseBase,n.screen.base,n.screen.canvasContextSystem.infiniteCanvasContext))))),this.unitsUsed=e;var i=this.measurementProvider.measure();if(this.isChange(i)){var o=fe(i);this.addMeasurement(o),this.coordinateSystems=this.coordinateSystems.withScreenTransformation(o.screenTransformation,o.inverseScreenTransformation)}},t.prototype.getTransformationInstruction=function(t){var n=this;return function(e){n.coordinateSystems.setTransformationToTransformInfiniteCanvasContext(e,t)}},t.prototype.getCSSPosition=function(t,n){var e=this.measurementProvider.measure(),i=e.left,o=e.top;return new s(t-i,n-o)},t.prototype.getForPath=function(){return new Yn(this)},t.prototype.getViewboxFromState=function(t,n){return this.coordinateSystems.rebaseFromScreenContextToInfiniteCanvasContext(t.current.transformation,this.polygon.expandByDistance(n*this.transformation.scale))},t.prototype.applyInitialTransformation=function(t){this.coordinateSystems.setCanvasContextTransformation(t)},t.prototype.transformRelatively=function(t){var n=this;return function(e){n.coordinateSystems.executeInTransformedInfiniteCanvasContext(t,e)}},t.prototype.transformAbsolutely=function(t){var n=this;return function(e){n.coordinateSystems.executeInUntransformedInfiniteCanvasContext(t,e)}},t.prototype.addPathAroundViewbox=function(t,n){var e=this.viewboxWidth+2*n,i=this.viewboxHeight+2*n;t.save(),t.setTransform(1,0,0,1,0,0),t.rect(-n,-n,e,i),t.restore()},t}(),ye=function(){function t(t){this.canvas=t}return t.prototype.measure=function(){var t=this.canvas.getBoundingClientRect();return{left:t.left,top:t.top,screenWidth:t.width,screenHeight:t.height,viewboxWidth:this.canvas.width,viewboxHeight:this.canvas.height}},t}(),de=function(){function t(t){this.canvas=t,this.listeners=[]}return t.prototype.notifyListeners=function(){for(var t=0,n=this.listeners;t<n.length;t++){(0,n[t])()}},t.prototype.createObserver=function(){var t=this;this.observer=new ResizeObserver((function(){return t.notifyListeners()})),this.observer.observe(this.canvas)},t.prototype.addListener=function(t){this.listeners.push(t),this.observer||this.createObserver()},t.prototype.removeListener=function(t){var n=this.listeners.indexOf(t);n>-1&&(this.listeners.splice(n,1),0===this.listeners.length&&(this.observer.disconnect(),this.observer=void 0))},t}(),ve=function(){function t(t){this.sourceEvent=t,this._wrappers=[]}return t.prototype.addListener=function(t,n){this.sourceEvent.addListener(this.wrapEventListener(t,n),n)},t.prototype.removeListener=function(t){var n=this._wrappers.findIndex((function(n){return n.original===t}));-1!==n&&(this.sourceEvent.removeListener(this._wrappers[n].wrapper),this._wrappers.splice(n,1))},t.prototype.removeWrapper=function(t){var n=this._wrappers.findIndex((function(n){return n.wrapper===t}));-1!==n&&this._wrappers.splice(n,1)},t.prototype.makeOnce=function(t){var n=this,e=function(i){n.removeWrapper(e),t(i)};return e},t.prototype.wrapEventListener=function(t,n){var e=this,i=function(n){t(e.transformEvent(n))};return n&&n.once&&(i=this.makeOnce(i)),this._wrappers.push({original:t,wrapper:i}),i},t}();function ge(t){return{a:t.a,b:t.b,c:t.c,d:t.d,e:t.e,f:t.f}}var Pe=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),me=function(t){function n(n,e){var i=t.call(this,n)||this;return i.rectangle=e,i}return Pe(n,t),n.prototype.transformEvent=function(){return{transformation:ge(this.rectangle.inverseInfiniteCanvasContextBase),inverseTransformation:ge(this.rectangle.infiniteCanvasContextBase)}},n}(ve),we=function(){function t(t,n,e,i,o){this.drawEvent=n,this.transformationStartEvent=new me(e,t),this.transformationChangeEvent=new me(i,t),this.transformationEndEvent=new me(o,t)}return t.prototype.addEventListener=function(t,n,e){switch(t){case"draw":this.drawEvent.addListener(n,e);break;case"transformationStart":this.transformationStartEvent.addListener(n,e);break;case"transformationChange":this.transformationChangeEvent.addListener(n,e);break;case"transformationEnd":this.transformationEndEvent.addListener(n,e)}},t.prototype.removeEventListener=function(t,n){switch(t){case"draw":this.drawEvent.removeListener(n);break;case"transformationStart":this.transformationStartEvent.removeListener(n);break;case"transformationChange":this.transformationChangeEvent.removeListener(n);break;case"transformationEnd":this.transformationEndEvent.removeListener(n)}},t}(),Ie=function(){function t(t,n){var e=this;this.canvas=t;var i=new En;this.config={rotationEnabled:!0,greedyGestureHandling:!1,units:Vn.CANVAS},n&&Object.assign(this.config,n),this.canvasResizeObserver=new de(t),this.canvasResizeListener=function(){null!==e.canvas.parentElement&&e.viewBox.draw()};var o=new Gn(new Hn);o.onDraw((function(){return i.dispatchEvent({transformation:ge(e.rectangle.inverseInfiniteCanvasContextBase),inverseTransformation:ge(e.rectangle.infiniteCanvasContextBase)})}));var r,s=new Un(o);this.rectangle=new le(new ye(t),this.config),this.viewBox=new Cn(this.rectangle,t.getContext("2d"),s,(function(){return s.getLock()}),(function(){return r.isTransforming})),r=new Mn(this.viewBox,this.config);new qn(t,r,this.config,this.rectangle);this.eventDispatchers=new we(this.rectangle,i,r.transformationStart,r.transformationChange,r.transformationEnd),r.transformationStart.addListener((function(){return e.rectangle.measure()})),n&&n.units===Vn.CSS&&this.canvasResizeObserver.addListener(this.canvasResizeListener)}return t.prototype.setUnits=function(t){t===Vn.CSS&&this.config.units!==Vn.CSS&&this.canvasResizeObserver.addListener(this.canvasResizeListener),t!==Vn.CSS&&this.config.units===Vn.CSS&&this.canvasResizeObserver.removeListener(this.canvasResizeListener),this.config.units=t,this.rectangle.measure(),this.viewBox.draw()},t.prototype.getContext=function(){return this.context||(this.context=new ot(this.canvas,this.viewBox)),this.context},Object.defineProperty(t.prototype,"rotationEnabled",{get:function(){return this.config.rotationEnabled},set:function(t){this.config.rotationEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"units",{get:function(){return this.config.units},set:function(t){this.setUnits(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"greedyGestureHandling",{get:function(){return this.config.greedyGestureHandling},set:function(t){this.config.greedyGestureHandling=t},enumerable:!1,configurable:!0}),t.prototype.addEventListener=function(t,n,e){this.eventDispatchers.addEventListener(t,n,e)},t.prototype.removeEventListener=function(t,n){this.eventDispatchers.removeEventListener(t,n)},t.CANVAS_UNITS=Vn.CANVAS,t.CSS_UNITS=Vn.CSS,t}()}])}));