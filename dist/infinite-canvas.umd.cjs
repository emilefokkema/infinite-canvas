(function(F,h){typeof exports=="object"&&typeof module<"u"?module.exports=h():typeof define=="function"&&define.amd?define(h):(F=typeof globalThis<"u"?globalThis:F||self,F.InfiniteCanvas=h())})(this,function(){"use strict";var co=Object.defineProperty;var ho=(F,h,W)=>h in F?co(F,h,{enumerable:!0,configurable:!0,writable:!0,value:W}):F[h]=W;var a=(F,h,W)=>ho(F,typeof h!="symbol"?h+"":h,W);let F=class{constructor(t){this.viewBox=t}restore(){this.viewBox.restoreState()}save(){this.viewBox.saveState()}reset(){this.viewBox.resetState()}};const j=class j{constructor(t,e){this.x=t,this.y=e}mod(){return Math.sqrt(this.modSq())}modSq(){return this.x*this.x+this.y*this.y}minus(t){return new j(this.x-t.x,this.y-t.y)}plus(t){return new j(this.x+t.x,this.y+t.y)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}equals(t){return this.x===t.x&&this.y===t.y}getPerpendicular(){return new j(-this.y,this.x)}scale(t){return new j(t*this.x,t*this.y)}projectOn(t){return t.scale(this.dot(t)/t.modSq())}matrix(t,e,n,i){return new j(t*this.x+e*this.y,n*this.x+i*this.y)}inSameDirectionAs(t){return this.cross(t)===0&&this.dot(t)>=0}isInOppositeDirectionAs(t){return this.cross(t)===0&&this.dot(t)<0}isOnSameSideOfOriginAs(t,e){return this.isInSmallerAngleBetweenPoints(t,e)||t.isInSmallerAngleBetweenPoints(this,e)||e.isInSmallerAngleBetweenPoints(this,t)}isInSmallerAngleBetweenPoints(t,e){const n=t.cross(e);return n>0?t.cross(this)>=0&&this.cross(e)>=0:n<0?t.cross(this)<=0&&this.cross(e)<=0:t.dot(e)>0?this.cross(t)===0&&this.dot(t)>0:!0}};a(j,"origin",new j(0,0));let h=j;function W(s){return s.toFixed(10).replace(/\.?0+$/,"")}const O=class O{constructor(t,e,n,i,r,o){a(this,"scale");this.a=t,this.b=e,this.c=n,this.d=i,this.e=r,this.f=o,this.scale=Math.sqrt(t*i-e*n)}getMaximumLineWidthScale(){const t=this.a+this.c,e=this.b+this.d,n=this.a-this.c,i=this.b-this.d;return Math.sqrt(Math.max(t*t+e*e,n*n+i*i))}getRotationAngle(){const t=this.a/this.scale,e=this.b/this.scale;if(t===0)return e>0?Math.PI/2:3*Math.PI/2;const n=Math.atan(e/t);return t>0?e>0?n:e===0?0:2*Math.PI+n:e>0?Math.PI+n:e===0?Math.PI:Math.PI+n}applyToPointAtInfinity(t){return{direction:this.untranslated().apply(t.direction)}}apply(t){return new h(this.a*t.x+this.c*t.y+this.e,this.b*t.x+this.d*t.y+this.f)}untranslated(){const{x:t,y:e}=this.apply(h.origin);return this.before(O.translation(-t,-e))}before(t){const e=t.a*this.a+t.c*this.b,n=t.b*this.a+t.d*this.b,i=t.a*this.c+t.c*this.d,r=t.b*this.c+t.d*this.d,o=t.a*this.e+t.c*this.f+t.e,c=t.b*this.e+t.d*this.f+t.f;return new O(e,n,i,r,o,c)}equals(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f}inverse(){var t=this.a*this.d-this.b*this.c;if(t==0)throw new Error("error calculating inverse: zero determinant");const e=this.d/t,n=-this.b/t,i=-this.c/t,r=this.a/t,o=(this.c*this.f-this.d*this.e)/t,c=(this.b*this.e-this.a*this.f)/t;return new O(e,n,i,r,o,c)}static translation(t,e){return new O(1,0,0,1,t,e)}static scale(t){return new O(t,0,0,t,0,0)}static zoom(t,e,n,i,r){const o=1-n;return i!==void 0?new O(n,0,0,n,t*o+i,e*o+r):new O(n,0,0,n,t*o,e*o)}static translateZoom(t,e,n,i,r,o,c,u){const l=n-t,f=i-e,d=l*l+f*f;if(d===0)throw new Error("divide by 0");const m=c-r,P=u-o,C=m*m+P*P,x=Math.sqrt(C/d);return O.zoom(t,e,x,r-t,o-e)}static rotation(t,e,n){const i=Math.cos(n),r=Math.sin(n),o=1-i;return new O(i,r,-r,i,t*o+e*r,-t*r+e*o)}static translateRotateZoom(t,e,n,i,r,o,c,u){const l=n-t,f=i-e,d=l*l+f*f;if(d===0)throw new Error("divide by 0");const m=c-r,P=u-o,C=t*i-e*n,x=n*l+i*f,B=t*l+e*f,G=(l*m+f*P)/d,et=(l*P-f*m)/d,nt=-et,Dt=G,Et=(r*x-c*B-C*P)/d,Rt=(o*x-u*B+C*m)/d;return new O(G,et,nt,Dt,Et,Rt)}static create(t){if(t instanceof O)return t;const{a:e,b:n,c:i,d:r,e:o,f:c}=t;return new O(e,n,i,r,o,c)}toString(){return`x: (${W(this.a)}, ${W(this.b)}), y: (${W(this.c)}, ${W(this.d)}), d: (${W(this.e)}, ${W(this.f)})`}};a(O,"identity",new O(1,0,0,1,0,0));let v=O;class S{constructor(t,e){this.propertyName=t,this.noopInstruction=e}changeInstanceValue(t,e){return this.valuesAreEqual(t[this.propertyName],e)?t:t.changeProperty(this.propertyName,e)}isEqualForInstances(t,e){return this.valuesAreEqual(t[this.propertyName],e[this.propertyName])}getInstructionToChange(t,e){return this.valuesAreEqual(t[this.propertyName],e[this.propertyName])?this.noopInstruction:this.changeToNewValue(e[this.propertyName])}valueIsTransformableForInstance(t){return!0}}const y=()=>{};class oi extends S{valuesAreEqual(t,e){return t.equals(e)}changeToNewValue(t){return(e,n)=>{const{a:i,b:r,c:o,d:c,e:u,f:l}=n.getTransformationForInstruction(t);e.setTransform(i,r,o,c,u,l)}}}const Ft=new oi("transformation",y);class ai{constructor(t){this.viewBox=t}getTransform(){if(DOMMatrix){const t=this.viewBox.state.current.transformation;return new DOMMatrix([t.a,t.b,t.c,t.d,t.e,t.f])}}resetTransform(){this.viewBox.changeState(t=>Ft.changeInstanceValue(t,v.identity))}rotate(t){this.addTransformation(v.rotation(0,0,t))}scale(t,e){this.addTransformation(new v(t,0,0,e,0,0))}setTransform(t,e,n,i,r,o){let c,u,l,f,d,m;typeof t=="number"?(c=t,u=e,l=n,f=i,d=r,m=o):t.a!==void 0?(c=t.a,u=t.b,l=t.c,f=t.d,d=t.e,m=t.f):(c=t.m11,u=t.m12,l=t.m21,f=t.m22,d=t.m41,m=t.m42),this.viewBox.changeState(P=>Ft.changeInstanceValue(P,new v(c,u,l,f,d,m)))}transform(t,e,n,i,r,o){this.addTransformation(new v(t,e,n,i,r,o))}translate(t,e){this.addTransformation(v.translation(t,e))}addTransformation(t){const e=this.viewBox.state.current.transformation,n=t.before(e);this.viewBox.changeState(i=>Ft.changeInstanceValue(i,n))}}class ci extends S{valuesAreEqual(t,e){return t===e}changeToNewValue(t){return e=>e.globalAlpha=t}}const Qe=new ci("globalAlpha",y);class hi extends S{valuesAreEqual(t,e){return t===e}changeToNewValue(t){return e=>e.globalCompositeOperation=t}}const Je=new hi("globalCompositeOperation",y);class li{constructor(t){this.viewBox=t}get globalAlpha(){return this.viewBox.state.current.globalAlpha}set globalAlpha(t){this.viewBox.changeState(e=>Qe.changeInstanceValue(e,t))}get globalCompositeOperation(){return this.viewBox.state.current.globalCompositeOperation}set globalCompositeOperation(t){this.viewBox.changeState(e=>Je.changeInstanceValue(e,t))}}class ui extends S{valuesAreEqual(t,e){return t===e}changeToNewValue(t){return e=>{e.imageSmoothingEnabled=t}}}const Ze=new ui("imageSmoothingEnabled",y);class di extends S{valuesAreEqual(t,e){return t===e}changeToNewValue(t){return e=>{e.imageSmoothingQuality=t}}}const _e=new di("imageSmoothingQuality",y);class fi{constructor(t){this.viewBox=t}get imageSmoothingEnabled(){return this.viewBox.state.current.imageSmoothingEnabled}set imageSmoothingEnabled(t){this.viewBox.changeState(e=>Ze.changeInstanceValue(e,t))}get imageSmoothingQuality(){return this.viewBox.state.current.imageSmoothingQuality}set imageSmoothingQuality(t){this.viewBox.changeState(e=>_e.changeInstanceValue(e,t))}}class Wt{}class tn extends Wt{constructor(t){super(),this.fillStrokeStyle=t}setTransform(t){this.fillStrokeStyle.setTransform(t)}getInstructionToSetUntransformed(t){return e=>{e[t]=this.fillStrokeStyle}}getInstructionToSetTransformed(t){return e=>{e[t]=this.fillStrokeStyle}}}class en{constructor(t){this.propName=t}changeInstanceValue(t,e){return t.changeProperty(this.propName,e)}isEqualForInstances(t,e){return t[this.propName]===e[this.propName]}getInstructionToChange(t,e){const n=e[this.propName];return this.isEqualForInstances(t,e)?!(n instanceof Wt)||t.fillAndStrokeStylesTransformed===e.fillAndStrokeStylesTransformed?()=>{}:e.fillAndStrokeStylesTransformed?n.getInstructionToSetTransformed(this.propName):n.getInstructionToSetUntransformed(this.propName):n instanceof Wt?e.fillAndStrokeStylesTransformed?n.getInstructionToSetTransformed(this.propName):n.getInstructionToSetUntransformed(this.propName):i=>{i[this.propName]=e[this.propName]}}valueIsTransformableForInstance(t){return!(t[this.propName]instanceof tn)}}const nn=new en("fillStyle"),rn=new en("strokeStyle");class gi{constructor(t){this.viewBox=t}set fillStyle(t){this.viewBox.changeState(e=>nn.changeInstanceValue(e,t))}set strokeStyle(t){this.viewBox.changeState(e=>rn.changeInstanceValue(e,t))}createLinearGradient(t,e,n,i){return this.viewBox.createLinearGradient(t,e,n,i)}createPattern(t,e){return this.viewBox.createPattern(t,e)}createRadialGradient(t,e,n,i,r,o){return this.viewBox.createRadialGradient(t,e,n,i,r,o)}createConicGradient(t,e,n){return this.viewBox.createConicGradient(t,e,n)}}class mi extends S{valuesAreEqual(t,e){return t===e}changeToNewValue(t){return e=>{e.shadowColor=t}}}const sn=new mi("shadowColor",y);class pi extends S{changeToNewValue(t){return(e,n)=>{const i=v.translation(t.x,t.y),r=n.translateInfiniteCanvasContextTransformationToBitmapTransformation(i),{x:o,y:c}=r.apply(h.origin);e.shadowOffsetX=o,e.shadowOffsetY=c}}valuesAreEqual(t,e){return t.x===e.x&&t.y==e.y}}const de=new pi("shadowOffset",y);class vi extends S{changeToNewValue(t){return(e,n)=>{const i=v.translation(t,0),o=n.translateInfiniteCanvasContextTransformationToBitmapTransformation(i).apply(h.origin).mod();e.shadowBlur=o}}valuesAreEqual(t,e){return t===e}}const on=new vi("shadowBlur",y);class wi{constructor(t){this.viewBox=t}get shadowBlur(){return this.viewBox.state.current.shadowBlur}set shadowBlur(t){this.viewBox.changeState(e=>on.changeInstanceValue(e,t))}get shadowOffsetX(){return this.viewBox.state.current.shadowOffset.x}set shadowOffsetX(t){const e=new h(t,this.viewBox.state.current.shadowOffset.y);this.viewBox.changeState(n=>de.changeInstanceValue(n,e))}get shadowOffsetY(){return this.viewBox.state.current.shadowOffset.y}set shadowOffsetY(t){const e=new h(this.viewBox.state.current.shadowOffset.x,t);this.viewBox.changeState(n=>de.changeInstanceValue(n,e))}get shadowColor(){return this.viewBox.state.current.shadowColor}set shadowColor(t){this.viewBox.changeState(e=>sn.changeInstanceValue(e,t))}}const an="[+-]?(?:\\d*\\.)?\\d+(?:e[+-]?\\d+)?",cn="[+-]?(?:0*\\.)?0+(?:e[+-]?\\d+)?",hn="(?:ch|em|ex|ic|rem|vh|vw|vmax|vmin|vb|vi|cqw|cqh|cqi|cqb|cqmin|cqmax|px|cm|mm|Q|in|pc|pt)",kt=`(?:${cn}|${an}${hn})`,ln=`blur\\((${kt})\\)`,un="[^())\\s]+(?:\\([^)]*?\\))?",dn=`drop-shadow\\((${kt})\\s+(${kt})\\s*?(?:(?:(${kt})\\s*?(${un})?)|(${un}))?\\)`,fn=`${ln}|${dn}`;function k(s,t){const e=s.match(new RegExp(`(?:(${cn})|(${an})(${hn}))`));return e[1]?0:t.getNumberOfPixels(Number.parseFloat(e[2]),e[3])}class gn{constructor(t){this.stringRepresentation=t}toTransformedString(){return this.stringRepresentation}getShadowOffset(){return null}}class fe{constructor(t,e){this.stringRepresentation=t,this.size=e}toTransformedString(t){return`blur(${t.translateInfiniteCanvasContextTransformationToBitmapTransformation(v.translation(this.size,0)).apply(h.origin).mod()}px)`}getShadowOffset(){return null}static tryCreate(t,e){const n=t.match(new RegExp(ln));return n===null?null:new fe(t,k(n[1],e))}}class lt{constructor(t,e,n,i,r){this.stringRepresentation=t,this.offsetX=e,this.offsetY=n,this.blurRadius=i,this.color=r}toTransformedString(t){const e=t.translateInfiniteCanvasContextTransformationToBitmapTransformation(v.translation(this.offsetX,this.offsetY)),{x:n,y:i}=e.apply(h.origin);if(this.blurRadius!==null){const o=t.translateInfiniteCanvasContextTransformationToBitmapTransformation(v.translation(this.blurRadius,0)).apply(h.origin).mod();return this.color?`drop-shadow(${n}px ${i}px ${o}px ${this.color})`:`drop-shadow(${n}px ${i}px ${o}px)`}return this.color?`drop-shadow(${n}px ${i}px ${this.color})`:`drop-shadow(${n}px ${i}px)`}getShadowOffset(){return new h(this.offsetX,this.offsetY)}static tryCreate(t,e){const n=t.match(new RegExp(dn));return n===null?null:n[5]?new lt(t,k(n[1],e),k(n[2],e),null,n[5]):n[4]?new lt(t,k(n[1],e),k(n[2],e),k(n[3],e),n[4]):n[3]?new lt(t,k(n[1],e),k(n[2],e),k(n[3],e),null):new lt(t,k(n[1],e),k(n[2],e),null,null)}}const At=class At{constructor(t,e){this.stringRepresentation=t,this.parts=e}toString(){return this.parts.map(t=>t.stringRepresentation).join(" ")}toTransformedString(t){return this.parts.map(e=>e.toTransformedString(t)).join(" ")}getShadowOffset(){for(const t of this.parts){const e=t.getShadowOffset();if(e!==null)return e}return null}static create(t,e){const i=t.match(new RegExp(`${fn}|((?!\\s|${fn}).)+`,"g")).map(r=>this.createPart(r,e));return new At(t,i)}static createPart(t,e){let n=fe.tryCreate(t,e);return n!==null||(n=lt.tryCreate(t,e),n!=null)?n:new gn(t)}};a(At,"none",new At("none",[new gn("none")]));let Ht=At;class Pi extends S{valuesAreEqual(t,e){return t.stringRepresentation===e.stringRepresentation}changeToNewValue(t){return(e,n)=>e.filter=t.toTransformedString(n)}}const mn=new Pi("filter",y);class Ci{constructor(t,e){this.viewBox=t,this.cssLengthConverterFactory=e}get filter(){return this.viewBox.state.current.filter.stringRepresentation}set filter(t){const e=Ht.create(t,this.cssLengthConverterFactory.create());this.viewBox.changeState(n=>mn.changeInstanceValue(n,e))}}class Ii{constructor(t){this.viewBox=t}clearRect(t,e,n,i){this.viewBox.clearArea(t,e,n,i)}fillRect(t,e,n,i){let r=o=>o.fill();this.viewBox.fillRect(t,e,n,i,r)}strokeRect(t,e,n,i){this.viewBox.strokeRect(t,e,n,i)}}class Ti{constructor(t){this.viewBox=t}isFillRule(t){return t==="evenodd"||t==="nonzero"}beginPath(){this.viewBox.beginPath()}clip(t,e){let n=this.isFillRule(t)?i=>{i.clip(t)}:i=>{i.clip()};this.viewBox.clipPath(n)}fill(t,e){if((!t||this.isFillRule(t))&&!this.viewBox.currentPathCanBeFilled())return;let n=this.isFillRule(t)?i=>{i.fill(t)}:i=>{i.fill()};this.viewBox.fillPath(n)}isPointInPath(t,e,n,i){return!0}isPointInStroke(t,e,n){return!0}stroke(t){this.viewBox.strokePath()}}class Si{drawFocusIfNeeded(t,e){}scrollPathIntoView(t){}}var N=(s=>(s[s.None=0]="None",s[s.Relative=1]="Relative",s[s.Absolute=2]="Absolute",s))(N||{}),T=(s=>(s[s.Positive=0]="Positive",s[s.Negative=1]="Negative",s))(T||{});const Vt={direction:new h(0,1)},Mt={direction:new h(0,-1)},Nt={direction:new h(-1,0)},zt={direction:new h(1,0)};function yi(s,t,e,n){const i=e.minus(s),r=n.cross(t),o=n.getPerpendicular().dot(i)/r;return s.plus(t.scale(o))}class rt{constructor(t,e,n){a(this,"leftNormal");a(this,"rightNormal");this.point=t,this.leftHalfPlane=e,this.rightHalfPlane=n,this.leftNormal=e.normalTowardInterior,this.rightNormal=n.normalTowardInterior}replaceLeftHalfPlane(t){return new rt(this.point,t,this.rightHalfPlane)}replaceRightHalfPlane(t){return new rt(this.point,this.leftHalfPlane,t)}isContainedByHalfPlaneWithNormal(t){return t.isInSmallerAngleBetweenPoints(this.leftNormal,this.rightNormal)}containsPoint(t){return this.leftHalfPlane.containsPoint(t)&&this.rightHalfPlane.containsPoint(t)}containsLineSegmentWithDirection(t){return this.containsPoint(this.point.plus(t))||this.containsPoint(this.point.minus(t))}isContainedByVertex(t){return this.isContainedByHalfPlaneWithNormal(t.leftNormal)&&this.isContainedByHalfPlaneWithNormal(t.rightNormal)}getContainingHalfPlaneThroughPoint(t){let e=t.minus(this.point).getPerpendicular();if(e.cross(this.leftHalfPlane.normalTowardInterior)===0)return this.leftHalfPlane;if(e.cross(this.rightHalfPlane.normalTowardInterior)===0)return this.rightHalfPlane;const n=this.leftNormal.plus(this.rightNormal);return e.dot(n)<=0&&(e=e.scale(-1)),new w(t,e)}static create(t,e,n){return e.normalTowardInterior.cross(n.normalTowardInterior)>=0?new rt(t,e,n):new rt(t,n,e)}}class w{constructor(t,e){a(this,"lengthOfNormal");this.base=t,this.normalTowardInterior=e,this.lengthOfNormal=e.mod()}getDistanceFromEdge(t){return t.minus(this.base).dot(this.normalTowardInterior)/this.lengthOfNormal}transform(t){const e=t.apply(this.base),n=t.apply(this.base.plus(this.normalTowardInterior.getPerpendicular())),i=t.apply(this.base.plus(this.normalTowardInterior));return w.throughPointsAndContainingPoint(e,n,i)}complement(){return new w(this.base,this.normalTowardInterior.scale(-1))}expandByDistance(t){const e=this.base.plus(this.normalTowardInterior.scale(-t/this.normalTowardInterior.mod()));return new w(e,this.normalTowardInterior)}expandToIncludePoint(t){return this.containsPoint(t)?this:new w(t,this.normalTowardInterior)}containsPoint(t){return this.getDistanceFromEdge(t)>=0}interiorContainsPoint(t){return this.getDistanceFromEdge(t)>0}containsInfinityInDirection(t){return t.dot(this.normalTowardInterior)>=0}isContainedByHalfPlane(t){return this.normalTowardInterior.inSameDirectionAs(t.normalTowardInterior)&&t.getDistanceFromEdge(this.base)>=0}intersectWithLine(t,e){return{point:yi(this.base,this.normalTowardInterior.getPerpendicular(),t,e),halfPlane:this}}isParallelToLine(t,e){return this.normalTowardInterior.getPerpendicular().cross(e)===0}getIntersectionWith(t){const e=this.intersectWithLine(t.base,t.normalTowardInterior.getPerpendicular());return rt.create(e.point,this,t)}static throughPointsAndContainingPoint(t,e,n){const i=w.withBorderPoints(t,e);for(let r of i)if(r.containsPoint(n))return r}static withBorderPointAndInfinityInDirection(t,e){return w.withBorderPoints(t,t.plus(e))}static withBorderPoints(t,e){const n=e.minus(t).getPerpendicular();return[new w(t,n),new w(t,n.scale(-1))]}}class xi{getVertices(){return[]}expandToIncludePoint(t){return this}expandToIncludePolygon(t){return this}expandToIncludeInfinityInDirection(t){return this}expandByDistance(t){return this}intersects(t){return!0}expandToInclude(t){return this}transform(t){return this}intersectWithLineSegment(t){return t}contains(t){return!0}intersectWith(t){return t}join(t){return this}intersectWithRay(t){return t}intersectWithLine(t){return t}intersectWithConvexPolygon(t){return t}isContainedByRay(t){return!1}isContainedByLineSegment(t){return!1}isContainedByLine(t){return!1}isContainedByConvexPolygon(t){return!1}intersectsRay(t){return!0}intersectsLineSegment(t){return!0}intersectsLine(t){return!0}intersectsConvexPolygon(t){return!0}}const ut=new xi;class bi{getVertices(){return[]}intersectWith(t){return this}join(t){return t}intersectWithConvexPolygon(t){return this}intersects(t){return!1}intersectWithLineSegment(t){return this}intersectWithRay(t){return this}intersectWithLine(t){return this}expandToInclude(t){return t}transform(t){return this}contains(t){return!1}isContainedByConvexPolygon(t){return!0}isContainedByRay(t){return!0}isContainedByLineSegment(t){return!0}isContainedByLine(t){return!0}intersectsRay(t){return!1}intersectsConvexPolygon(t){return!1}intersectsLineSegment(t){return!1}intersectsLine(t){return!1}expandByDistance(t){return this}expandToIncludePoint(t){return this}expandToIncludeInfinityInDirection(t){return this}expandToIncludePolygon(t){return t}}const L=new bi;class p{constructor(t,e){a(this,"halfPlanes");this.vertices=e,this.halfPlanes=t,this.vertices=this.vertices||p.getVertices(this.halfPlanes)}findVertex(t){for(let e of this.vertices)if(e.point.equals(t))return e}intersects(t){return t.intersectsConvexPolygon(this)}intersectWith(t){return t.intersectWithConvexPolygon(this)}join(t){if(this.contains(t))return this;if(t.contains(this))return t;let e=t;for(let n of this.vertices)e=e.expandToIncludePoint(n.point);for(let n of this.getPointsAtInfinityFromHalfPlanes())this.containsInfinityInDirection(n)&&(e=e.expandToIncludeInfinityInDirection(n));return e}intersectWithRay(t){return t.intersectWithConvexPolygon(this)}intersectWithLine(t){return t.intersectWithConvexPolygon(this)}intersectWithLineSegment(t){return t.intersectWithConvexPolygon(this)}contains(t){return t.isContainedByConvexPolygon(this)}containsHalfPlane(t){for(let e of this.halfPlanes)if(!t.isContainedByHalfPlane(e))return!1;return!0}isContainedByHalfPlane(t){for(let n of this.vertices)if(!t.containsPoint(n.point))return!1;const e=t.complement();for(let n of this.halfPlanes)if(n.isContainedByHalfPlane(t))return!0;for(let n of this.halfPlanes){const i=this.getVerticesOnHalfPlane(n);if(i.length<=1&&(n.isContainedByHalfPlane(e)||e.isContainedByHalfPlane(n)))return!1;const r=n.getIntersectionWith(t),o=i.find(c=>c.point.equals(r.point));if(o){if(!o.isContainedByHalfPlaneWithNormal(t.normalTowardInterior))return!1}else{if(i.length===0)return!1;if(this.containsPoint(r.point))return!1}}return!this.containsHalfPlane(t)}getVertices(){return this.vertices.map(t=>t.point)}expandToIncludePoint(t){if(this.vertices.length===0){const f=this.halfPlanes.map(d=>d.expandToIncludePoint(t));return new p(f)}const e=new Set,n=new Set;let i=null,r=null;const o=[],c=new Set;for(const f of this.vertices){const d=f.leftHalfPlane;n.has(d)?n.delete(d):e.add(d);const m=f.rightHalfPlane;if(e.has(m)?e.delete(m):n.add(m),d.containsPoint(t)){if(c.add(d),m.containsPoint(t)){c.add(m),o.push(f);continue}i=f;continue}m.containsPoint(t)&&(c.add(m),r=f)}if(o.length===this.vertices.length)return this;let u,l;if(i===null){const f=[...e][0];if(!f)return this;u=f.expandToIncludePoint(t)}else u=i.getContainingHalfPlaneThroughPoint(t),u!==i.leftHalfPlane&&o.push(i.replaceRightHalfPlane(u));if(r===null){const f=[...n][0];if(!f)return this;l=f.expandToIncludePoint(t)}else l=r.getContainingHalfPlaneThroughPoint(t),l!==r.rightHalfPlane&&o.push(r.replaceLeftHalfPlane(l));return c.add(u),c.add(l),o.push(new rt(t,u,l)),new p([...c],o)}expandToIncludeInfinityInDirection(t){if(this.containsInfinityInDirection(t))return this;let e=this.halfPlanes.filter(n=>n.containsInfinityInDirection(t)).concat(this.getTangentPlanesThroughInfinityInDirection(t));return e=p.getHalfPlanesNotContainingAnyOther(e),e.length===0?ut:new p(e)}getIntersectionsWithLine(t,e){const n=[];for(let i of this.halfPlanes){if(i.isParallelToLine(t,e))continue;const r=i.intersectWithLine(t,e),o=this.findVertex(r.point);o&&!o.containsLineSegmentWithDirection(e)||this.containsPoint(r.point)&&n.push(r)}return n}expandByDistance(t){return new p(this.halfPlanes.map(e=>e.expandByDistance(t)))}transform(t){return new p(this.halfPlanes.map(e=>e.transform(t)))}intersectWithConvexPolygon(t){if(t.isContainedByConvexPolygon(this))return t;if(this.isContainedByConvexPolygon(t))return this;if(this.isOutsideConvexPolygon(t))return L;const e=p.getHalfPlanesNotContainingAnyOther(this.halfPlanes.concat(t.halfPlanes)),r=p.groupVerticesByPoint(p.getVertices(e)).map(c=>p.getVerticesNotContainingAnyOther(c)).reduce((c,u)=>c.concat(u),[]);if(r.length===0)return new p(e);const o=p.getHalfPlanes(r);return new p(o)}containsInfinityInDirection(t){for(let e of this.halfPlanes)if(!e.containsInfinityInDirection(t))return!1;return!0}containsPoint(t){for(let e of this.halfPlanes)if(!e.containsPoint(t))return!1;return!0}intersectsRay(t){return t.intersectsConvexPolygon(this)}intersectsLineSegment(t){return t.intersectsConvexPolygon(this)}intersectsLine(t){return t.intersectsConvexPolygon(this)}intersectsConvexPolygon(t){return this.isContainedByConvexPolygon(t)||t.isContainedByConvexPolygon(this)?!0:!this.isOutsideConvexPolygon(t)}isOutsideConvexPolygon(t){for(let e of t.halfPlanes)if(this.isContainedByHalfPlane(e.complement()))return!0;for(let e of this.halfPlanes)if(t.isContainedByHalfPlane(e.complement()))return!0;return!1}getVerticesOnHalfPlane(t){const e=[];for(let n of this.vertices)(n.leftHalfPlane===t||n.rightHalfPlane===t)&&e.push(n);return e}hasAtMostOneVertex(t){let e=0;for(let n of this.vertices)if((n.leftHalfPlane===t||n.rightHalfPlane===t)&&(e++,e>1))return!1;return!0}getTangentPlanesThroughInfinityInDirection(t){const e=[];for(let n of this.vertices){const i=w.withBorderPointAndInfinityInDirection(n.point,t);for(let r of i)this.isContainedByHalfPlane(r)&&e.push(r)}return e}getPointsAtInfinityFromHalfPlanes(){const t=[];for(let e of this.halfPlanes){const n=e.normalTowardInterior,i=n.getPerpendicular();t.push(n),t.push(i),t.push(i.scale(-1))}return t}isContainedByRay(t){return!1}isContainedByLineSegment(t){return!1}isContainedByLine(t){return!1}isContainedByConvexPolygon(t){for(let e of t.halfPlanes)if(!this.isContainedByHalfPlane(e))return!1;return!0}static getHalfPlanes(t){const e=[];for(let n of t)e.indexOf(n.leftHalfPlane)===-1&&e.push(n.leftHalfPlane),e.indexOf(n.rightHalfPlane)===-1&&e.push(n.rightHalfPlane);return e}static getVerticesNotContainingAnyOther(t){const e=[];for(let n=0;n<t.length;n++){let i=!0;for(let r=0;r<t.length;r++)if(n!==r&&t[r].isContainedByVertex(t[n])){i=!1;break}i&&e.push(t[n])}return e}static getHalfPlanesNotContainingAnyOther(t){const e=[];for(let n of t){let i=!0;for(let r of e)if(r.isContainedByHalfPlane(n)){i=!1;break}i&&e.push(n)}return e}static groupVerticesByPoint(t){const e=[];for(let n of t){let i;for(let r of e)if(r[0].point.equals(n.point)){i=r;break}i?i.push(n):e.push([n])}return e}static getVertices(t){const e=[];for(let n=0;n<t.length;n++)for(let i=n+1;i<t.length;i++){const r=t[n],o=t[i];if(r.complement().isContainedByHalfPlane(o))continue;const c=r.getIntersectionWith(o);let u=!0;for(let l=0;l<t.length;l++){if(l===n||l===i)continue;if(!t[l].containsPoint(c.point)){u=!1;break}}u&&e.push(c)}return e}static createTriangleWithInfinityInTwoDirections(t,e,n){const i=e.getPerpendicular(),r=n.getPerpendicular();return e.cross(n)<0?new p([new w(t,i.scale(-1)),new w(t,r)]):new p([new w(t,i),new w(t,r.scale(-1))])}static createFromHalfPlane(t){return new p([t])}static createTriangleWithInfinityInDirection(t,e,n){const i=e.minus(t).projectOn(n.getPerpendicular());return new p([new w(t,i),new w(e,i.scale(-1)),w.throughPointsAndContainingPoint(t,e,t.plus(n))])}static createTriangle(t,e,n){return new p([w.throughPointsAndContainingPoint(t,e,n),w.throughPointsAndContainingPoint(t,n,e),w.throughPointsAndContainingPoint(e,n,t)])}}function Y(...s){return(...t)=>{for(const e of s)e&&e(...t)}}function Oi(s,t){return t?(e,n)=>{e.save(),t(e,n),s(e,n),e.restore()}:s}function Li(s){return s===N.Relative?(t,e)=>{const{a:n,b:i,c:r,d:o,e:c,f:u}=e.getBitmapTransformationToTransformedInfiniteCanvasContext();t.transform(n,i,r,o,c,u)}:s===N.Absolute?(t,e)=>{const{a:n,b:i,c:r,d:o,e:c,f:u}=e.getBitmapTransformationToInfiniteCanvasContext();t.setTransform(n,i,r,o,c,u)}:null}function Bi(s,t){let e=s.area;return e&&t.lineWidth>0&&(e=e.expandByDistance(t.lineWidth/2)),e}function Ai(s){return{lineWidth:s.current.getMaximumLineWidth(),lineDashPeriod:s.current.getLineDashPeriod(),shadowOffsets:s.current.getShadowOffsets()}}function Di(s){return{lineWidth:0,lineDashPeriod:0,shadowOffsets:s.current.getShadowOffsets()}}class z{constructor(t,e,n,i,r,o,c){this.instruction=t,this.area=e,this.build=n,this.takeClippingRegionIntoAccount=i,this.transformationKind=r,this.state=o,this.tempState=c}static forStrokingPath(t,e,n){return z.forPath(t,e,Ai,n)}static forFillingPath(t,e,n){return z.forPath(t,e,Di,n)}static forPath(t,e,n,i){const r=e.current.isTransformable(),o=r?N.None:N.Relative,c=e.currentlyTransformed(r),u=n(c),l=i(c),f=Bi(l,u);return new z(t,f,d=>l.drawPath(d,c,u),!0,o,c)}getDrawnArea(){let t=this.area;const e=this.state;if(e.current.shadowBlur!==0||!e.current.shadowOffset.equals(h.origin)){const n=t.expandByDistance(e.current.shadowBlur).transform(v.translation(e.current.shadowOffset.x,e.current.shadowOffset.y));t=t.join(n)}return e.current.clippingRegion&&this.takeClippingRegionIntoAccount&&(t=t.intersectWith(e.current.clippingRegion)),t}getModifiedInstruction(){let t=Li(this.transformationKind);if(this.tempState){const n=this.takeClippingRegionIntoAccount?this.state.getInstructionToConvertToStateWithClippedPath(this.tempState):this.state.getInstructionToConvertToState(this.tempState);t=Y(t,n)}return Oi(this.instruction,t)}}class ge{constructor(t){a(this,"added",[]);a(this,"addedLast");this.initiallyWithState=t}get length(){return this.added.length}get currentlyWithState(){return this.addedLast?this.addedLast:this.initiallyWithState}reconstructState(t,e){e.setInitialState(t)}get stateOfFirstInstruction(){return this.initiallyWithState.stateOfFirstInstruction}get state(){return this.currentlyWithState.state}get initialState(){return this.initiallyWithState.initialState}addClippedPath(t){this.currentlyWithState.addClippedPath(t)}add(t){this.added.push(t),this.addedLast=t}removeAll(t){let e;for(;(e=this.added.findIndex(t))>-1;)this.removeAtIndex(e)}contains(t){return!!this.added.find(t)}setInitialState(t){this.initiallyWithState.setInitialState(t)}setInitialStateWithClippedPaths(t){this.initiallyWithState.setInitialStateWithClippedPaths(t)}beforeIndex(t){return t===0?this.initiallyWithState.state:this.added[t-1].state}removeAtIndex(t){t===this.added.length-1?this.added.length===1?this.addedLast=void 0:this.addedLast=this.added[t-1]:this.reconstructState(this.beforeIndex(t),this.added[t+1]),this.added.splice(t,1)}}class me{constructor(t,e){a(this,"stateConversion");this.initialState=t,this.state=e,this.stateConversion=()=>{}}setInitialState(t){this.initialState=t;const e=this.initialState.getInstructionToConvertToState(this.state);this.stateConversion=e}get stateOfFirstInstruction(){return this.state}addClippedPath(t){this.state=this.state.withClippedPath(t)}setInitialStateWithClippedPaths(t){this.initialState=t;const e=this.initialState.getInstructionToConvertToStateWithClippedPath(this.state);this.stateConversion=e}}class X extends me{constructor(t,e,n,i){super(t,e),this.instruction=n,this.stateConversion=i}execute(t,e){this.stateConversion&&this.stateConversion(t,e),this.instruction(t,e)}static create(t,e){return new X(t,t,e,()=>{})}}class dt extends me{constructor(t,e,n,i){super(t,e),this.instruction=n,this.stateConversion=i}makeExecutable(){return new X(this.initialState,this.state,this.instruction,this.stateConversion)}static create(t,e){return new dt(t,t,e,()=>{})}}function I(s){return s.direction!==void 0}function J(s,t){return I(s)?t.applyToPointAtInfinity(s):t.apply(s)}class Ei{constructor(t,e){this.areaBuilder=t,this.transformation=e}addPosition(t){this.areaBuilder.addPosition(J(t,this.transformation))}}class pe{constructor(t,e){this.base=t,this.direction=e}pointIsOnSameLine(t){return t.minus(this.base).cross(this.direction)===0}comesBefore(t,e){return e.minus(t).dot(this.direction)>=0}lineSegmentIsOnSameLine(t){return this.direction.cross(t.direction)===0&&this.pointIsOnSameLine(t.point1)}expandLineByDistance(t){const e=this.direction.getPerpendicular(),n=new w(this.base,e).expandByDistance(t),i=new w(this.base,e.scale(-1)).expandByDistance(t);return new p([n,i])}getPointsInSameDirection(t,e){return this.comesBefore(e,t)?{point1:e,point2:t}:{point1:t,point2:e}}pointIsBetweenPoints(t,e,n){return t.minus(e).dot(this.direction)*t.minus(n).dot(this.direction)<=0}intersectsConvexPolygon(t){if(this.isContainedByConvexPolygon(t))return!0;const e=t.getIntersectionsWithLine(this.base,this.direction);for(let n of e)if(this.interiorContainsPoint(n.point))return!0;return!1}}class qt extends pe{getVertices(){return[]}intersectWith(t){return t.intersectWithLine(this)}join(t){return t.expandToIncludeInfinityInDirection(this.direction).expandToIncludeInfinityInDirection(this.direction.scale(-1))}intersectWithConvexPolygon(t){if(!this.intersectsConvexPolygon(t))return L;if(this.isContainedByConvexPolygon(t))return this;const e=t.getIntersectionsWithLine(this.base,this.direction);let n,i;for(let r of e)(!n&&!i||!n&&this.comesBefore(r.point,i)||!i&&this.comesBefore(n,r.point)||n&&i&&this.pointIsBetweenPoints(r.point,n,i))&&(r.halfPlane.normalTowardInterior.dot(this.direction)>0?n=r.point:i=r.point);return n&&i?new E(n,i):n?new q(n,this.direction):new q(i,this.direction.scale(-1))}intersectWithLine(t){return this.intersectsLine(t)?this:L}intersectWithLineSegment(t){return this.lineSegmentIsOnSameLine(t)?t:L}intersectWithRay(t){return this.intersectsRay(t)?t:L}isContainedByConvexPolygon(t){return t.containsPoint(this.base)&&t.containsInfinityInDirection(this.direction)&&t.containsInfinityInDirection(this.direction.scale(-1))}isContainedByLine(t){return this.intersectsSubsetOfLine(t)}isContainedByLineSegment(t){return!1}isContainedByRay(t){return!1}contains(t){return t.isContainedByLine(this)}intersectsLine(t){return this.intersectsSubsetOfLine(t)}intersectsSubsetOfLine(t){return this.pointIsOnSameLine(t.base)&&this.direction.cross(t.direction)===0}intersectsLineSegment(t){return this.lineSegmentIsOnSameLine(t)}intersectsRay(t){return this.intersectsSubsetOfLine(t)}intersects(t){return t.intersectsLine(this)}expandToIncludePoint(t){return this.pointIsOnSameLine(t)?this:p.createTriangleWithInfinityInDirection(this.base,t,this.direction).expandToIncludeInfinityInDirection(this.direction.scale(-1))}expandByDistance(t){return this.expandLineByDistance(t)}expandToIncludeInfinityInDirection(t){const e=t.cross(this.direction),n=this.direction.getPerpendicular();return e===0?this:e>0?p.createFromHalfPlane(new w(this.base,n.scale(-1))):p.createFromHalfPlane(new w(this.base,n))}transform(t){const e=t.apply(this.base);return new qt(e,t.apply(this.base.plus(this.direction)).minus(e))}interiorContainsPoint(t){return this.pointIsOnSameLine(t)}}class q extends pe{getVertices(){return[this.base]}intersectWith(t){return t.intersectWithRay(this)}join(t){return t.expandToIncludePoint(this.base).expandToIncludeInfinityInDirection(this.direction)}intersectWithConvexPolygon(t){if(!this.intersectsConvexPolygon(t))return L;if(this.isContainedByConvexPolygon(t))return this;const e=t.getIntersectionsWithLine(this.base,this.direction);let n=this.base,i;for(let r of e)(!i&&this.comesBefore(n,r.point)||i&&this.pointIsBetweenPoints(r.point,n,i))&&(r.halfPlane.normalTowardInterior.dot(this.direction)>0?n=r.point:i=r.point);return i?new E(n,i):new q(n,this.direction)}intersectWithRay(t){return this.isContainedByRay(t)?this:t.isContainedByRay(this)?t:this.interiorContainsPoint(t.base)?new E(this.base,t.base):L}intersectWithLine(t){return t.intersectWithRay(this)}intersectWithLineSegment(t){if(t.isContainedByRay(this))return t;if(!this.lineSegmentIsOnSameLine(t))return L;let{point2:e}=this.getPointsInSameDirection(t.point1,t.point2);return this.comesBefore(e,this.base)?L:new E(this.base,e)}isContainedByConvexPolygon(t){return t.containsPoint(this.base)&&t.containsInfinityInDirection(this.direction)}isContainedByRay(t){return t.containsPoint(this.base)&&t.containsInfinityInDirection(this.direction)}isContainedByLine(t){return t.intersectsSubsetOfLine(this)}isContainedByLineSegment(t){return!1}contains(t){return t.isContainedByRay(this)}intersectsRay(t){return this.isContainedByRay(t)||t.isContainedByRay(this)||this.interiorContainsPoint(t.base)}intersectsLine(t){return t.intersectsSubsetOfLine(this)}intersectsLineSegment(t){if(t.isContainedByRay(this))return!0;if(!this.lineSegmentIsOnSameLine(t))return!1;let{point2:e}=this.getPointsInSameDirection(t.point1,t.point2);return!this.comesBefore(e,this.base)}intersects(t){return t.intersectsRay(this)}expandToIncludePoint(t){return this.containsPoint(t)?this:this.pointIsOnSameLine(t)?new q(t,this.direction):p.createTriangleWithInfinityInDirection(this.base,t,this.direction)}expandByDistance(t){const e=this.expandLineByDistance(t),n=new w(this.base,this.direction).expandByDistance(t);return e.intersectWithConvexPolygon(new p([n]))}expandToIncludeInfinityInDirection(t){return t.inSameDirectionAs(this.direction)?this:this.direction.cross(t)===0?new qt(this.base,this.direction):p.createTriangleWithInfinityInTwoDirections(this.base,this.direction,t)}transform(t){const e=t.apply(this.base);return new q(e,t.apply(this.base.plus(this.direction)).minus(e))}interiorContainsPoint(t){return this.pointIsOnSameLine(t)&&!this.comesBefore(t,this.base)}containsInfinityInDirection(t){return this.direction.inSameDirectionAs(t)}containsPoint(t){return this.pointIsOnSameLine(t)&&this.comesBefore(this.base,t)}}class E extends pe{constructor(t,e){super(t,e.minus(t)),this.point1=t,this.point2=e}getVertices(){return[this.point1,this.point2]}join(t){return t.expandToIncludePoint(this.point1).expandToIncludePoint(this.point2)}intersectWith(t){return t.intersectWithLineSegment(this)}intersectWithLineSegment(t){if(this.isContainedByLineSegment(t))return this;if(t.isContainedByLineSegment(this))return t;if(!this.lineSegmentIsOnSameLine(t))return L;let{point1:e,point2:n}=this.getPointsInSameDirection(t.point1,t.point2);return this.comesBefore(n,this.point1)||this.comesBefore(this.point2,e)?L:this.comesBefore(this.point1,e)?new E(e,this.point2):new E(this.point1,n)}intersectWithRay(t){return t.intersectWithLineSegment(this)}intersectWithLine(t){return t.intersectWithLineSegment(this)}isContainedByRay(t){return t.containsPoint(this.point1)&&t.containsPoint(this.point2)}isContainedByLine(t){return t.intersectsSubsetOfLine(this)}isContainedByLineSegment(t){return t.containsPoint(this.point1)&&t.containsPoint(this.point2)}intersectWithConvexPolygon(t){if(!this.intersectsConvexPolygon(t))return L;if(this.isContainedByConvexPolygon(t))return this;const e=t.getIntersectionsWithLine(this.point1,this.direction);let n=this.point1,i=this.point2;for(let r of e)this.pointIsBetweenPoints(r.point,n,i)&&(r.halfPlane.normalTowardInterior.dot(this.direction)>0?n=r.point:i=r.point);return new E(n,i)}isContainedByConvexPolygon(t){return t.containsPoint(this.point1)&&t.containsPoint(this.point2)}contains(t){return t.isContainedByLineSegment(this)}pointIsStrictlyBetweenPoints(t,e,n){return t.minus(e).dot(this.direction)*t.minus(n).dot(this.direction)<0}containsPoint(t){return this.pointIsOnSameLine(t)&&this.pointIsBetweenPoints(t,this.point1,this.point2)}interiorContainsPoint(t){return this.pointIsOnSameLine(t)&&this.pointIsStrictlyBetweenPoints(t,this.point1,this.point2)}intersectsRay(t){return t.intersectsLineSegment(this)}intersectsLineSegment(t){if(this.isContainedByLineSegment(t)||t.isContainedByLineSegment(this))return!0;if(!this.lineSegmentIsOnSameLine(t))return!1;const{point1:e,point2:n}=this.getPointsInSameDirection(t.point1,t.point2);return!this.comesBefore(n,this.point1)&&!this.comesBefore(this.point2,e)}intersectsLine(t){return t.intersectsSubsetOfLine(this)}intersects(t){return t.intersectsLineSegment(this)}expandByDistance(t){const e=this.expandLineByDistance(t),n=new w(this.base,this.direction).expandByDistance(t),i=new w(this.point2,this.direction.scale(-1)).expandByDistance(t);return e.intersectWithConvexPolygon(new p([n,i]))}expandToIncludePoint(t){return this.containsPoint(t)?this:this.pointIsOnSameLine(t)?this.comesBefore(t,this.point1)?new E(t,this.point2):new E(this.point1,t):p.createTriangle(this.point1,t,this.point2)}expandToIncludeInfinityInDirection(t){return t.inSameDirectionAs(this.direction)?new q(this.point1,t):t.cross(this.direction)===0?new q(this.point2,t):p.createTriangleWithInfinityInDirection(this.point1,this.point2,t)}transform(t){return new E(t.apply(this.point1),t.apply(this.point2))}}class Ri{addPoint(t){return ut}addPointAtInfinity(t){return this}addArea(t){return ut}}const ve=new Ri;class we{constructor(t){this.towardsMiddle=t}addPoint(t){return p.createFromHalfPlane(new w(t,this.towardsMiddle))}addPointAtInfinity(t){return t.dot(this.towardsMiddle)>=0?this:ve}addArea(t){const e=this.towardsMiddle.getPerpendicular();return t.expandToIncludeInfinityInDirection(this.towardsMiddle).expandToIncludeInfinityInDirection(e).expandToIncludeInfinityInDirection(e.scale(-1))}}class Gt{constructor(t,e){this.direction1=t,this.direction2=e}addPoint(t){return p.createTriangleWithInfinityInTwoDirections(t,this.direction1,this.direction2)}addPointAtInfinity(t){return t.isInSmallerAngleBetweenPoints(this.direction1,this.direction2)?this:t.cross(this.direction1)===0?new we(this.direction2.projectOn(this.direction1.getPerpendicular())):t.cross(this.direction2)===0?new we(this.direction1.projectOn(this.direction2.getPerpendicular())):this.direction1.isInSmallerAngleBetweenPoints(t,this.direction2)?new Gt(t,this.direction2):this.direction2.isInSmallerAngleBetweenPoints(t,this.direction1)?new Gt(t,this.direction1):ve}addArea(t){return t.expandToIncludeInfinityInDirection(this.direction1).expandToIncludeInfinityInDirection(this.direction2)}}class Fi{constructor(t){this.direction=t}addPoint(t){return new qt(t,this.direction)}addPointAtInfinity(t){return t.cross(this.direction)===0?this:new we(t.projectOn(this.direction.getPerpendicular()))}addArea(t){return t.expandToIncludeInfinityInDirection(this.direction).expandToIncludeInfinityInDirection(this.direction.scale(-1))}}class Wi{constructor(t){this.direction=t}addPointAtInfinity(t){return t.inSameDirectionAs(this.direction)?this:t.cross(this.direction)===0?new Fi(this.direction):new Gt(this.direction,t)}addPoint(t){return new q(t,this.direction)}addArea(t){return t.expandToIncludeInfinityInDirection(this.direction)}}class ki{constructor(t,e,n){this._area=t,this.firstPoint=e,this.subsetOfLineAtInfinity=n}get area(){return this._area||L}addPoint(t){this._area?this._area=this._area.expandToIncludePoint(t):this.firstPoint?t.equals(this.firstPoint)||(this._area=new E(this.firstPoint,t)):this.subsetOfLineAtInfinity?this._area=this.subsetOfLineAtInfinity.addPoint(t):this.firstPoint=t}addPosition(t){I(t)?this.addInfinityInDirection(t.direction):this.addPoint(t)}addInfinityInDirection(t){this._area?this._area=this._area.expandToIncludeInfinityInDirection(t):this.firstPoint?this._area=new q(this.firstPoint,t):this.subsetOfLineAtInfinity?(this.subsetOfLineAtInfinity=this.subsetOfLineAtInfinity.addPointAtInfinity(t),this.subsetOfLineAtInfinity===ve&&(this._area=ut)):this.subsetOfLineAtInfinity=new Wi(t)}transformedWith(t){return new Ei(this,t)}}class Yt extends me{constructor(t,e,n,i){super(t,e),this.instruction=n,this.stateConversion=i}replaceInstruction(t){this.instruction=t}makeExecutable(t){const e=t.getInfinity(this.state),n=this.instruction,i=(r,o)=>n(r,o,e);return new X(this.initialState,this.state,i,this.stateConversion)}static create(t,e){return new Yt(t,t,e,()=>{})}}function Hi(s,t){return s?t?I(s)?I(t)&&s.direction.equals(t.direction):!I(t)&&s.equals(t):!s:!t}class Ct{constructor(t){this.shape=t}getInstructionToDrawLineTo(t,e){return this.getInstructionToExtendShapeWithLineTo(this.shape.transform(e.current.transformation.inverse()),t)}getInstructionToMoveToBeginning(t){return this.getInstructionToMoveToBeginningOfShape(this.shape.transform(t.current.transformation.inverse()))}get currentPosition(){return this.shape.currentPosition}moveToInfinityFromPointInDirection(t,e){return(n,i,r)=>{r.moveToInfinityFromPointInDirection(n,i,t,e)}}lineFromInfinityFromPointToInfinityFromPoint(t,e,n){return(i,r,o)=>{o.drawLineFromInfinityFromPointToInfinityFromPoint(i,r,t,e,n)}}lineFromInfinityFromPointToPoint(t,e){return(n,i,r)=>{r.drawLineFromInfinityFromPointToPoint(n,i,t,e)}}lineToInfinityFromPointInDirection(t,e){return(n,i,r)=>{r.drawLineToInfinityFromPointInDirection(n,i,t,e)}}lineToInfinityFromInfinityFromPoint(t,e,n){return(i,r,o)=>{o.drawLineToInfinityFromInfinityFromPoint(i,r,t,e,n)}}lineTo(t){return(e,n)=>{const{x:i,y:r}=n.userTransformation.apply(t);e.lineTo(i,r)}}moveTo(t){return(e,n)=>{const{x:i,y:r}=n.userTransformation.apply(t);e.moveTo(i,r)}}}class Xt{constructor(t,e,n,i){this.initialPosition=t,this.firstFinitePoint=e,this.lastFinitePoint=n,this.currentPosition=i}transform(t){return new Xt(t.applyToPointAtInfinity(this.initialPosition),t.apply(this.firstFinitePoint),t.apply(this.lastFinitePoint),t.applyToPointAtInfinity(this.currentPosition))}}class It{constructor(t,e,n){this.initialPosition=t,this.firstFinitePoint=e,this.currentPosition=n}transform(t){return new It(t.applyToPointAtInfinity(this.initialPosition),t.apply(this.firstFinitePoint),t.apply(this.currentPosition))}}class Vi extends Ct{constructor(t,e){super(e),this.pathBuilderProvider=t}getInstructionToMoveToBeginningOfShape(t){return t.initialPosition.direction.cross(t.currentPosition.direction)===0?this.moveToInfinityFromPointInDirection(t.firstFinitePoint,t.initialPosition.direction):Y(this.moveToInfinityFromPointInDirection(t.lastFinitePoint,t.currentPosition.direction),this.lineToInfinityFromInfinityFromPoint(t.lastFinitePoint,t.currentPosition.direction,t.initialPosition.direction),this.lineFromInfinityFromPointToInfinityFromPoint(t.lastFinitePoint,t.firstFinitePoint,t.initialPosition.direction))}getInstructionToExtendShapeWithLineTo(t,e){return I(e)?this.lineToInfinityFromInfinityFromPoint(t.lastFinitePoint,t.currentPosition.direction,e.direction):Y(this.lineFromInfinityFromPointToInfinityFromPoint(t.lastFinitePoint,e,t.currentPosition.direction),this.lineFromInfinityFromPointToPoint(e,t.currentPosition.direction))}containsFinitePoint(){return!0}surroundsFinitePoint(){return!0}isClosable(){return!this.shape.initialPosition.direction.isInOppositeDirectionAs(this.shape.currentPosition.direction)}canAddLineTo(t){return!I(t)||!t.direction.isInOppositeDirectionAs(this.shape.currentPosition.direction)}addPosition(t){return I(t)?this.pathBuilderProvider.fromPointAtInfinityToPointAtInfinity(new Xt(this.shape.initialPosition,this.shape.firstFinitePoint,this.shape.lastFinitePoint,t)):this.pathBuilderProvider.fromPointAtInfinityToPoint(new It(this.shape.initialPosition,this.shape.firstFinitePoint,t))}}class Mi extends Ct{constructor(t,e){super(e),this.pathBuilderProvider=t}getInstructionToMoveToBeginningOfShape(t){const e=this.moveToInfinityFromPointInDirection(t.currentPosition,t.initialPosition.direction);if(t.currentPosition.equals(t.firstFinitePoint))return e;const n=this.lineFromInfinityFromPointToInfinityFromPoint(t.currentPosition,t.firstFinitePoint,t.initialPosition.direction);return Y(e,n)}getInstructionToExtendShapeWithLineTo(t,e){return I(e)?this.lineToInfinityFromPointInDirection(t.currentPosition,e.direction):this.lineTo(e)}canAddLineTo(t){return!0}containsFinitePoint(){return!0}surroundsFinitePoint(){return!0}isClosable(){return!0}addPosition(t){return I(t)?this.pathBuilderProvider.fromPointAtInfinityToPointAtInfinity(new Xt(this.shape.initialPosition,this.shape.firstFinitePoint,this.shape.currentPosition,t)):this.pathBuilderProvider.fromPointAtInfinityToPoint(new It(this.shape.initialPosition,this.shape.firstFinitePoint,t))}}class Ut{constructor(t,e){this.initialPoint=t,this.currentPosition=e}transform(t){return new Ut(t.apply(this.initialPoint),t.applyToPointAtInfinity(this.currentPosition))}}class Tt{constructor(t,e){this.initialPoint=t,this.currentPosition=e}transform(t){return new Tt(t.apply(this.initialPoint),t.apply(this.currentPosition))}}class Ni extends Ct{constructor(t,e){super(e),this.pathBuilderProvider=t}getInstructionToMoveToBeginningOfShape(t){return this.moveTo(t.initialPoint)}getInstructionToExtendShapeWithLineTo(t,e){return I(e)?e.direction.inSameDirectionAs(t.currentPosition.direction)?()=>{}:this.lineToInfinityFromInfinityFromPoint(t.initialPoint,t.currentPosition.direction,e.direction):Y(this.lineFromInfinityFromPointToInfinityFromPoint(t.initialPoint,e,t.currentPosition.direction),this.lineFromInfinityFromPointToPoint(e,t.currentPosition.direction))}canAddLineTo(t){return!I(t)||!t.direction.isInOppositeDirectionAs(this.shape.currentPosition.direction)}containsFinitePoint(){return!0}surroundsFinitePoint(){return!0}isClosable(){return!0}addPosition(t){return I(t)?this.pathBuilderProvider.fromPointToPointAtInfinity(new Ut(this.shape.initialPoint,t)):this.pathBuilderProvider.fromPointToPoint(new Tt(this.shape.initialPoint,t))}}class pn extends Ct{constructor(t,e){super(e),this.pathBuilderProvider=t}getInstructionToMoveToBeginningOfShape(t){return this.moveTo(t.initialPoint)}getInstructionToExtendShapeWithLineTo(t,e){if(I(e)){const n=this.lineToInfinityFromPointInDirection(t.currentPosition,e.direction);if(t.currentPosition.minus(t.initialPoint).cross(e.direction)===0)return n;const i=this.lineFromInfinityFromPointToInfinityFromPoint(t.currentPosition,t.initialPoint,e.direction);return Y(n,i)}return this.lineTo(e)}canAddLineTo(t){return!0}containsFinitePoint(){return!0}surroundsFinitePoint(){return!0}isClosable(){return!0}addPosition(t){return I(t)?this.pathBuilderProvider.fromPointToPointAtInfinity(new Ut(this.shape.initialPoint,t)):this.pathBuilderProvider.fromPointToPoint(new Tt(this.shape.initialPoint,t))}}class vn extends Ct{constructor(t,e){super(e),this.pathBuilderProvider=t}getInstructionToMoveToBeginningOfShape(t){return t.surroundsFinitePoint?(e,n,i)=>i.addPathAroundViewbox(e,n,t.direction==="counterclockwise"):()=>{}}getInstructionToExtendShapeWithLineTo(t,e){if(I(e))return;if(t.positionsSoFar.length===1)return this.lineFromInfinityFromPointToPoint(e,t.positionsSoFar[0].direction);const n=t.positionsSoFar.slice(1);let i=t.initialPosition;const r=[];for(let o of n)r.push(this.lineToInfinityFromInfinityFromPoint(e,i.direction,o.direction)),i=o;return Y(Y(...r),this.lineFromInfinityFromPointToPoint(e,i.direction))}canAddLineTo(t){return!I(t)||!t.direction.isInOppositeDirectionAs(this.shape.currentPosition.direction)}containsFinitePoint(){return!1}surroundsFinitePoint(){return this.shape.surroundsFinitePoint}isClosable(){return!0}addPosition(t){return I(t)?this.pathBuilderProvider.atInfinity(this.shape.addPosition(t)):this.pathBuilderProvider.fromPointAtInfinityToPoint(new It(this.shape.initialPosition,t,t))}}class St{constructor(t,e,n,i){a(this,"direction");this.initialPosition=t,this.surroundsFinitePoint=e,this.positionsSoFar=n,this.currentPosition=i;const r=t.direction.cross(i.direction);this.direction=e?r>=0?"counterclockwise":"clockwise":r>=0?"clockwise":"counterclockwise"}transform(t){return new St(t.applyToPointAtInfinity(this.initialPosition),this.surroundsFinitePoint,this.positionsSoFar.map(e=>t.applyToPointAtInfinity(e)),t.applyToPointAtInfinity(this.currentPosition))}addPosition(t){const n=t.direction.isOnSameSideOfOriginAs(this.initialPosition.direction,this.currentPosition.direction)?this.surroundsFinitePoint:!this.surroundsFinitePoint;return new St(this.initialPosition,n,this.positionsSoFar.concat([t]),t)}static create(t){return new St(t,!1,[t],t)}}class zi{fromPointAtInfinityToPointAtInfinity(t){return new Vi(this,t)}fromPointAtInfinityToPoint(t){return new Mi(this,t)}fromPointToPointAtInfinity(t){return new Ni(this,t)}fromPointToPoint(t){return new pn(this,t)}atInfinity(t){return new vn(this,t)}getBuilderFromPosition(t){return I(t)?new vn(this,St.create(t)):new pn(this,new Tt(t,t))}}class Pe extends ge{constructor(t){super(t),this._initiallyWithState=t}execute(t,e){this._initiallyWithState.execute(t,e);for(const n of this.added)n.execute(t,e)}}class Ce extends ge{constructor(t,e){super(t),this._initiallyWithState=t,this.pathInstructionBuilder=e}get currentPosition(){return this.pathInstructionBuilder.currentPosition}addInstruction(t){t.setInitialState(this.state),this.add(t)}closePath(){const t=dt.create(this.state,e=>{e.closePath()});this.add(t)}makeExecutable(t){const e=new Pe(this._initiallyWithState.makeExecutable(t));for(const n of this.added)e.add(n.makeExecutable(t));return e}surroundsFinitePoint(){return this.pathInstructionBuilder.surroundsFinitePoint()}isClosable(){return this.pathInstructionBuilder.isClosable()}canAddLineTo(t){return this.pathInstructionBuilder.canAddLineTo(t)}lineTo(t,e){const n=J(t,e.current.transformation);(!I(t)||this.pathInstructionBuilder.containsFinitePoint())&&this.addInstructionToDrawLineTo(t,e),this.pathInstructionBuilder=this.pathInstructionBuilder.addPosition(n);const i=this.pathInstructionBuilder.getInstructionToMoveToBeginning(this._initiallyWithState.state);this._initiallyWithState.replaceInstruction((r,o,c)=>{i(r,o,c)})}addInstructionToDrawLineTo(t,e){const n=this.pathInstructionBuilder.getInstructionToDrawLineTo(t,e),i=Yt.create(e,n);i.setInitialState(this.state),this.add(i)}addPathInstruction(t,e,n){t.initialPoint&&!Hi(this.pathInstructionBuilder.currentPosition,t.initialPoint)&&this.lineTo(t.initialPoint,n),t.positionChange&&(this.pathInstructionBuilder=this.pathInstructionBuilder.addPosition(J(t.positionChange,n.current.transformation))),e.setInitialState(this.state),this.add(e)}static create(t,e){const n=J(e,t.current.transformation),i=new zi().getBuilderFromPosition(n),r=i.getInstructionToMoveToBeginning(t),o=Yt.create(t,r);return new Ce(o,i)}}function qi(s,t,e){let n=0,i;for(let r of s){const o=r.minus(t).dot(e);o>n&&(i=r,n=o)}return i?t.plus(i.minus(t).projectOn(e)):t}function H(s,t,e){return qi(s.getVertices(),t,e)}class Gi{constructor(t,e){this.state=t,this.drawnPathProperties=e}addPathAroundViewbox(t,e,n){e.addPathAroundViewbox(t,this.drawnPathProperties.lineWidth,n)}getTransformedViewbox(t){const e=this.state.current.transformation.before(t.getBitmapTransformationToInfiniteCanvasContext());let n=t.polygon;n=n.transform(e.inverse()).expandByDistance(this.drawnPathProperties.lineWidth);for(const i of this.drawnPathProperties.shadowOffsets){const r=n.transform(v.translation(-i.x,-i.y));n=n.join(r)}return n}clearRect(t,e,n,i,r,o){const c=this.getTransformedViewbox(e),{a:u,b:l,c:f,d,e:m,f:P}=e.userTransformation;t.save(),t.transform(u,l,f,d,m,P);const C=Number.isFinite(n)?n:H(c,new h(0,0),n>0?zt.direction:Nt.direction).x,x=Number.isFinite(r)?n+r:H(c,new h(0,0),r>0?zt.direction:Nt.direction).x,B=Number.isFinite(i)?i:H(c,new h(0,0),i>0?Vt.direction:Mt.direction).y,G=Number.isFinite(o)?i+o:H(c,new h(0,0),o>0?Vt.direction:Mt.direction).y;t.clearRect(C,B,x-C,G-B),t.restore()}moveToInfinityFromPointInDirection(t,e,n,i){const r=H(this.getTransformedViewbox(e),n,i);this.moveToTransformed(t,r,e.userTransformation)}drawLineToInfinityFromInfinityFromPoint(t,e,n,i,r){const o=this.getTransformedViewbox(e),c=H(o,n,i),u=H(o,n,r),l=e.userTransformation,d=o.expandToIncludePoint(n).expandToIncludePoint(c).expandToIncludePoint(u).getVertices().filter(C=>!C.equals(c)&&!C.equals(u)&&!C.equals(n)&&C.minus(n).isInSmallerAngleBetweenPoints(i,r));d.sort((C,x)=>C.minus(n).isInSmallerAngleBetweenPoints(x.minus(n),i)?-1:1);let m=c,P=0;for(let C of d)P+=C.minus(m).mod(),this.lineToTransformed(t,C,l),m=C;P+=u.minus(m).mod(),this.lineToTransformed(t,u,l),this.ensureDistanceCoveredIsMultipleOfLineDashPeriod(t,l,P,u,r)}drawLineFromInfinityFromPointToInfinityFromPoint(t,e,n,i,r){const o=this.getTransformedViewbox(e),c=H(o,n,r),u=e.userTransformation,l=H(o,i,r);this.lineToTransformed(t,l,u);const f=l.minus(c).mod();this.ensureDistanceCoveredIsMultipleOfLineDashPeriod(t,u,f,l,r)}drawLineFromInfinityFromPointToPoint(t,e,n,i){const r=H(this.getTransformedViewbox(e),n,i),o=n.minus(r).mod(),c=e.userTransformation;this.ensureDistanceCoveredIsMultipleOfLineDashPeriod(t,c,o,r,i),this.lineToTransformed(t,n,c)}drawLineToInfinityFromPointInDirection(t,e,n,i){const r=H(this.getTransformedViewbox(e),n,i),o=e.userTransformation;this.lineToTransformed(t,r,o);const c=r.minus(n).mod();this.ensureDistanceCoveredIsMultipleOfLineDashPeriod(t,o,c,r,i)}ensureDistanceCoveredIsMultipleOfLineDashPeriod(t,e,n,i,r){const o=this.drawnPathProperties.lineDashPeriod;if(o===0)return;const c=this.getDistanceLeft(n,o);if(c===0)return;const u=i.plus(r.scale(c/(2*r.mod())));this.lineToTransformed(t,u,e),this.lineToTransformed(t,i,e)}lineToTransformed(t,e,n){const{x:i,y:r}=n.apply(e);t.lineTo(i,r)}moveToTransformed(t,e,n){const{x:i,y:r}=n.apply(e);t.moveTo(i,r)}getDistanceLeft(t,e){if(e===0)return 0;const n=t/e|0;return t-e*n===0?0:(n+1)*e-t}}class Ie{constructor(t){this.drawnPathProperties=t}getInfinity(t){return new Gi(t,this.drawnPathProperties)}}class Yi{constructor(t,e){this.instructions=t,this.area=e}get state(){return this.instructions.state}get initialState(){return this.instructions.initialState}execute(t,e){this.instructions.execute(t,e)}}class yt extends ge{constructor(e){super(e);a(this,"areaBuilder",new ki);this._initiallyWithState=e}get area(){return this.areaBuilder.area}surroundsFinitePoint(){for(const e of this.added)if(e.surroundsFinitePoint())return!0;return!1}currentSubpathIsClosable(){return this.added.length===0?!0:this.added[this.added.length-1].isClosable()}allSubpathsAreClosable(){if(this.added.length===0)return!0;for(const e of this.added)if(!e.isClosable())return!1;return!0}drawPath(e,n,i){if(this.added.length===0)return;const r=X.create(n,e),o=this.makeExecutable(i);return r.setInitialState(o.state),o.add(r),o}makeExecutable(e){const n=new Pe(this._initiallyWithState.makeExecutable()),i=new Ie(e);for(const r of this.added)n.add(r.makeExecutable(i));return n}getInstructionsToClip(){const e=this.makeExecutable({lineWidth:0,lineDashPeriod:0,shadowOffsets:[]});return e.setInitialState(e.stateOfFirstInstruction),new Yi(e,this.area)}clipPath(e,n){if(this.added.length===0)return;const i=this.added[this.added.length-1],r=dt.create(n,e);i.addInstruction(r);const o=this.getInstructionsToClip();this.addClippedPath(o)}closePath(){if(this.added.length===0)return;this.added[this.added.length-1].closePath()}moveTo(e,n){const i=J(e,n.current.transformation);this.areaBuilder.addPosition(i);const r=Ce.create(n,e);r.setInitialState(this.state),this.add(r)}canAddLineTo(e,n){if(this.added.length===0)return!0;const i=J(e,n.current.transformation);return this.added[this.added.length-1].canAddLineTo(i)}lineTo(e,n){if(this.added.length===0){this.moveTo(e,n);return}const i=this.added[this.added.length-1],r=J(e,n.current.transformation);this.areaBuilder.addPosition(r),i.lineTo(e,n)}addPathInstruction(e,n){if(this.added.length===0)if(e.initialPoint)this.moveTo(e.initialPoint,n);else return;const i=this.added[this.added.length-1],r=i.currentPosition,o=J(r,n.current.transformation.inverse());e.changeArea(this.areaBuilder.transformedWith(n.current.transformation),o);const c=dt.create(n,e.instruction);i.addPathInstruction(e,c,n)}static create(e){return new yt(dt.create(e,n=>{n.beginPath()}))}}class R{constructor(t,...e){a(this,"corners");this.topLeftCorner=t,this.corners=e}addSubpaths(t,e){this.topLeftCorner.moveToEndingPoint(t,e);for(const n of this.corners)n.draw(t,e);this.topLeftCorner.finishRect(t,e)}stroke(t,e){return z.forStrokingPath(e,t,n=>{const i=yt.create(n);return this.addSubpaths(i,n),i})}fill(t,e){return z.forFillingPath(e,t,n=>{const i=yt.create(n);return this.addSubpaths(i,n),i})}}class Xi extends R{constructor(t,e,...n){super(e,...n),this.horizontal=t}getRoundRect(){return this}getArea(){return new p(this.horizontal.getHalfPlanesWithHorizontalCrossSection())}}class Ui extends R{constructor(t,e,...n){super(e,...n),this.vertical=t}getRoundRect(){return this}getArea(){return new p(this.vertical.getHalfPlanesWithVerticalCrossSection())}}class $i extends R{constructor(t,e,n,i,r){super(n,i,r),this.horizontal=t,this.vertical=e,this.topLeft=n,this.right=i,this.bottom=r}getRoundRect(t){const e=this.topLeft.round(t.upperLeft);return new R(e,this.right,this.bottom)}getArea(){return new p([...this.vertical.getHalfPlanesWithVerticalCrossSection(),...this.horizontal.getHalfPlanesWithHorizontalCrossSection()])}}class Ki extends R{constructor(t,e,...n){super(e,...n),this.horizontal=t}getRoundRect(){return this}getArea(){return new p(this.horizontal.getHalfPlanesWithHorizontalCrossSection())}}function ji(s){return s.x!==void 0}function wn(s){if(typeof s=="number"){if(Number.isNaN(s))return;if(s<0)throw new RangeError(`Radius value ${s} is negative.`);return{x:s,y:s,circular:!0}}const{x:t,y:e}=s;if(!(Number.isNaN(t)||Number.isNaN(e))){if(t<0)throw new RangeError(`X-radius value ${s} is negative.`);if(e<0)throw new RangeError(`Y-radius value ${s} is negative.`);return{x:t,y:e,circular:!1}}}function $t(s,t){const{x:e,y:n,circular:i}=s;return{x:e*t,y:n*t,circular:i}}function Te(s,t){const{upperLeft:e,upperRight:n,lowerLeft:i,lowerRight:r}=s;return{upperLeft:$t(e,t),upperRight:$t(n,t),lowerLeft:$t(i,t),lowerRight:$t(r,t)}}function Qi(s){if(typeof s=="number"||ji(s)){const n=wn(s);return n?{upperLeft:n,upperRight:n,lowerLeft:n,lowerRight:n}:void 0}const t=[...s],e=t.slice(0,4).map(wn);if(!e.includes(void 0)){if(e.length===4){const[n,i,r,o]=e;return{upperLeft:n,upperRight:i,lowerRight:r,lowerLeft:o}}if(e.length===3){const[n,i,r]=e;return{upperLeft:n,upperRight:i,lowerRight:r,lowerLeft:i}}if(e.length===2){const[n,i]=e;return{upperLeft:n,upperRight:i,lowerRight:n,lowerLeft:i}}if(e.length===1){const[n]=e;return{upperLeft:n,upperRight:n,lowerRight:n,lowerLeft:n}}throw new RangeError(`${t.length} radii provided. Between one and four radii are necessary.`)}}class Ji extends R{constructor(t,e,n,i,r){super(n,i,r),this.horizontal=t,this.vertical=e,this.topLeft=n,this.topRightCorner=i,this.bottom=r}getRoundRect(t){const e=this.horizontal.getLength(),n=t.upperLeft.x+t.upperRight.x,i=e/n;i<1&&(t=Te(t,i));const r=this.topRightCorner.round(t.upperRight),o=this.topLeft.round(t.upperLeft);return new R(o,r,this.bottom)}getArea(){return new p([...this.vertical.getHalfPlanesWithVerticalCrossSection(),...this.horizontal.getHalfPlanesWithHorizontalCrossSection()])}}class Zi extends R{constructor(t,e,...n){super(e,...n),this.vertical=t}getRoundRect(){return this}getArea(){return new p(this.vertical.getHalfPlanesWithVerticalCrossSection())}}class _i extends R{constructor(t,e,n,i,r){super(n,i,r),this.vertical=t,this.horizontal=e,this.topLeft=n,this.right=i,this.bottomLeftCorner=r}getRoundRect(t){const e=this.vertical.getLength(),n=t.upperLeft.y+t.lowerLeft.y,i=e/n;i<1&&(t=Te(t,i));const r=this.topLeft.round(t.upperLeft),o=this.bottomLeftCorner.round(t.lowerLeft);return new R(r,this.right,o)}getArea(){return new p([...this.vertical.getHalfPlanesWithVerticalCrossSection(),...this.horizontal.getHalfPlanesWithHorizontalCrossSection()])}}class tr extends R{constructor(t,e,n,i,r,o){super(n,i,r,o),this.vertical=t,this.horizontal=e,this.topLeft=n,this.topRight=i,this.bottomRight=r,this.bottomLeft=o}getRoundRect(t){const e=this.vertical.getLength(),n=this.horizontal.getLength(),i=Math.min(e/(t.upperLeft.y+t.lowerLeft.y),e/(t.upperRight.y+t.lowerRight.y),n/(t.upperLeft.x+t.upperRight.x),n/(t.lowerLeft.x+t.lowerRight.x));i<1&&(t=Te(t,i));const r=this.bottomRight.round(t.lowerRight),o=this.topLeft.round(t.upperLeft),c=this.topRight.round(t.upperRight),u=this.bottomLeft.round(t.lowerLeft);return new R(o,c,r,u)}getArea(){return new p([...this.horizontal.getHalfPlanesWithHorizontalCrossSection(),...this.vertical.getHalfPlanesWithVerticalCrossSection()])}}class Kt{constructor(t){this.topLeftPosition=t}addSubpaths(t,e){t.moveTo(this.topLeftPosition,e)}getRoundRect(){return this}getArea(){}stroke(){}fill(){}}class er{constructor(){a(this,"area",ut)}drawPath(t,e,n){const r=new Ie(n).getInfinity(e);return X.create(e,(o,c)=>{o.beginPath(),r.addPathAroundViewbox(o,c,!1),t(o,c)})}}const nr=new er;function Pn(s,t){throw new Error(`The starting coordinates provided (${s.start} and ${t.start}) do not determine a direction.`)}class ir{constructor(t,e){this.horizontal=t,this.vertical=e}addSubpaths(){Pn(this.horizontal,this.vertical)}getRoundRect(){return this}getArea(){return ut}stroke(){}fill(t,e){return z.forFillingPath(e,t,()=>nr)}}class Se{constructor(t,e){this.horizontal=t,this.vertical=e}addSubpaths(){Pn(this.horizontal,this.vertical)}getRoundRect(){return this}getArea(){}stroke(){}fill(){}}class st{static arc(t,e,n,i,r,o){return{instruction:(l,f)=>{const d=f.userTransformation,{x:m,y:P}=d.apply(new h(t,e)),{a:C,b:x,c:B,d:G,e:et,f:nt}=d.untranslated().before(v.translation(m,P));l.save(),l.transform(C,x,B,G,et,nt),l.arc(0,0,n,i,r,o),l.restore()},changeArea:l=>{l.addPosition(new h(t-n,e-n)),l.addPosition(new h(t-n,e+n)),l.addPosition(new h(t+n,e-n)),l.addPosition(new h(t+n,e+n))},positionChange:new h(t,e).plus(v.rotation(0,0,r).apply(new h(n,0))),initialPoint:new h(t,e).plus(v.rotation(0,0,i).apply(new h(n,0)))}}static arcTo(t,e,n,i,r){const o=new h(t,e),c=new h(n,i);return{instruction:(f,d)=>{const m=d.userTransformation,P=m.apply(o),C=m.apply(c);f.arcTo(P.x,P.y,C.x,C.y,r*m.scale)},changeArea:f=>{f.addPosition(o),f.addPosition(c)},positionChange:new h(n,i)}}static ellipse(t,e,n,i,r,o,c,u){return{instruction:(l,f)=>{const d=f.userTransformation,m=d.apply(new h(t,e)),P=d.getRotationAngle();l.ellipse(m.x,m.y,n*d.scale,i*d.scale,r+P,o,c,u)},changeArea:l=>{l.addPosition(new h(t-n,e-i)),l.addPosition(new h(t-n,e+i)),l.addPosition(new h(t+n,e-i)),l.addPosition(new h(t+n,e+i))},positionChange:new h(t,e).plus(v.rotation(0,0,c).before(new v(n,0,0,i,0,0)).before(v.rotation(0,0,r)).apply(new h(1,0))),initialPoint:new h(t,e).plus(v.rotation(0,0,o).before(new v(n,0,0,i,0,0)).before(v.rotation(0,0,r)).apply(new h(1,0)))}}static bezierCurveTo(t,e,n,i,r,o){return{instruction:(c,u)=>{const l=u.userTransformation,f=l.apply(new h(t,e)),d=l.apply(new h(n,i)),m=l.apply(new h(r,o));c.bezierCurveTo(f.x,f.y,d.x,d.y,m.x,m.y)},changeArea:(c,u)=>{I(u)||(c.addPosition(new h((u.x+t)/2,(u.y+e)/2)),c.addPosition(new h((t+n)/2,(e+i)/2)),c.addPosition(new h((n+r)/2,(i+o)/2)),c.addPosition(new h(r,o)))},positionChange:new h(r,o)}}static quadraticCurveTo(t,e,n,i){return{instruction:(r,o)=>{const c=o.userTransformation,u=c.apply(new h(t,e)),l=c.apply(new h(n,i));r.quadraticCurveTo(u.x,u.y,l.x,l.y)},changeArea:(r,o)=>{I(o)||(r.addPosition(new h((o.x+t)/2,(o.y+e)/2)),r.addPosition(new h((t+n)/2,(e+i)/2)),r.addPosition(new h(n,i)))},positionChange:new h(n,i)}}}var U=(s=>(s[s.TOPLEFT=0]="TOPLEFT",s[s.TOPRIGHT=1]="TOPRIGHT",s[s.BOTTOMLEFT=2]="BOTTOMLEFT",s[s.BOTTOMRIGHT=3]="BOTTOMRIGHT",s))(U||{});function rr(s){switch(s){case 0:return 2;case 1:return 3;case 3:return 1;case 2:return 0}}function sr(s){switch(s){case 0:return 1;case 1:return 0;case 3:return 2;case 2:return 3}}class Cn{constructor(t,e,n,i,r){a(this,"center");a(this,"start");a(this,"end");a(this,"radii");a(this,"clockwise");this.corner=e,n=ar(n,i,r);const o=r===i;let{center:c,start:u,end:l}=cr(n,e,t);o||({start:u,end:l}={start:l,end:u}),this.radii=t,this.clockwise=o,this.center=c,this.start=u,this.end=l}draw(t,e){t.lineTo(this.start.point,e),this.radii.circular?t.addPathInstruction(st.arc(this.center.x,this.center.y,this.radii.x,this.start.angle,this.end.angle,!this.clockwise),e):t.addPathInstruction(st.ellipse(this.center.x,this.center.y,this.radii.x,this.radii.y,0,this.start.angle,this.end.angle,!this.clockwise),e)}}class or extends Cn{moveToEndingPoint(t,e){t.moveTo(this.end.point,e)}finishRect(t,e){this.draw(t,e),t.moveTo(this.corner,e)}}function ar(s,t,e){return t===T.Negative&&(s=sr(s)),e===T.Negative&&(s=rr(s)),s}function cr(s,t,e){switch(s){case U.TOPLEFT:return{center:new h(t.x+e.x,t.y+e.y),start:{angle:Math.PI,point:new h(t.x,t.y+e.y)},end:{angle:3*Math.PI/2,point:new h(t.x+e.x,t.y)}};case U.TOPRIGHT:return{center:new h(t.x-e.x,t.y+e.y),start:{angle:3*Math.PI/2,point:new h(t.x-e.x,t.y)},end:{angle:0,point:new h(t.x,t.y+e.y)}};case U.BOTTOMRIGHT:return{center:new h(t.x-e.x,t.y-e.y),start:{angle:0,point:new h(t.x,t.y-e.y)},end:{angle:Math.PI/2,point:new h(t.x-e.x,t.y)}};case U.BOTTOMLEFT:return{center:new h(t.x+e.x,t.y-e.y),start:{angle:Math.PI/2,point:new h(t.x+e.x,t.y)},end:{angle:Math.PI,point:new h(t.x,t.y-e.y)}}}}class ye{constructor(t,e,n,i){this.corner=t,this.cornerOrientation=e,this.horizontalOrientation=n,this.verticalOrientation=i}draw(t,e){t.lineTo(this.corner,e)}round(t){return t.x===0||t.y===0?this:new Cn(t,this.corner,this.cornerOrientation,this.horizontalOrientation,this.verticalOrientation)}}class hr{constructor(t,e,n,i){this.corner=t,this.cornerOrientation=e,this.horizontalOrientation=n,this.verticalOrientation=i}moveToEndingPoint(t,e){t.moveTo(this.corner,e)}finishRect(t,e){t.closePath(),t.moveTo(this.corner,e)}round(t){return t.x===0||t.y===0?this:new or(t,this.corner,this.cornerOrientation,this.horizontalOrientation,this.verticalOrientation)}}class xe{constructor(t,e){this.point=t,this.direction=e}draw(t,e){t.lineTo(this.point,e),t.lineTo(this.direction,e)}}class lr{constructor(t,e){this.point=t,this.direction=e}moveToEndingPoint(t,e){t.moveTo(this.direction,e)}finishRect(t,e){t.lineTo(this.point,e),t.lineTo(this.direction,e),t.closePath(),t.moveTo(this.direction,e)}}class be{constructor(t){this.direction=t}draw(t,e){t.lineTo(this.direction,e)}}class ur{constructor(t){this.direction=t}moveToEndingPoint(t,e){t.moveTo(this.direction,e)}finishRect(t,e){t.closePath(),t.moveTo(this.direction,e)}}class Oe{constructor(t,e){a(this,"horizontalLineEnd");a(this,"horizontalLineStart");a(this,"verticalLineEnd");a(this,"verticalLineStart");this.start=t,this.orientation=e,this.horizontalLineStart=e===T.Positive?Nt:zt,this.horizontalLineEnd=e===T.Positive?zt:Nt,this.verticalLineStart=e===T.Positive?Mt:Vt,this.verticalLineEnd=e===T.Positive?Vt:Mt}createTopLeftAtVerticalInfinity(t){return new lr(new h(t.finiteStart,0),this.verticalLineStart)}createBottomRightAtInfinity(t){return new xe(new h(t.end,0),this.verticalLineEnd)}createRightAtInfinity(t){return new be(t.horizontalLineEnd)}createBottomAtInfinity(){return new be(this.verticalLineEnd)}addVerticalDimension(t){return t.addEntireHorizontalDimension(this)}addEntireHorizontalDimension(t){return new ir(t,this)}addHorizontalDimensionAtInfinity(t){return new Se(t,this)}addHorizontalDimensionWithStart(t){const e=this.createTopLeftAtVerticalInfinity(t),n=this.createRightAtInfinity(t),i=this.createBottomAtInfinity();return new Xi(t,e,n,i)}addHorizontalDimensionWithStartAndEnd(t){const e=this.createTopLeftAtVerticalInfinity(t),n=this.createBottomRightAtInfinity(t);return new Ki(t,e,n)}}class jt extends Oe{addVerticalDimension(t){return t.addHorizontalDimensionAtInfinity(this)}addEntireHorizontalDimension(t){return new Se(t,this)}addHorizontalDimensionAtInfinity(t){return new Se(t,this)}addHorizontalDimensionWithStart(){return new Kt(this.verticalLineEnd)}addHorizontalDimensionWithStartAndEnd(){return new Kt(this.verticalLineEnd)}}class In extends Oe{constructor(t,e){super(e,t),this.finiteStart=e}createBottomLeftAtInfinity(t){return new be(t.horizontalLineStart)}createLeftAtInfinity(t){return new ur(t.horizontalLineStart)}createTopRightAtHorizontalInfinity(t){return new xe(new h(0,this.finiteStart),t.horizontalLineEnd)}createTopLeft(t){return new hr(new h(t.finiteStart,this.finiteStart),U.TOPLEFT,t.orientation,this.orientation)}createTopRight(t){return new ye(new h(t.end,this.finiteStart),U.TOPRIGHT,t.orientation,this.orientation)}getStartingHalfPlaneWithHorizontalCrossSection(){const t=this.orientation===T.Positive?new h(1,0):new h(-1,0),e=new h(this.finiteStart,0);return new w(e,t)}getStartingHalfPlaneWithVerticalCrossSection(){const t=this.orientation===T.Positive?new h(0,1):new h(0,-1),e=new h(0,this.finiteStart);return new w(e,t)}addVerticalDimension(t){return t.addHorizontalDimensionWithStart(this)}addEntireHorizontalDimension(t){const e=this.createLeftAtInfinity(t),n=this.createTopRightAtHorizontalInfinity(t),i=this.createBottomAtInfinity(),r=this.createBottomLeftAtInfinity(t);return new Ui(this,e,n,i,r)}addHorizontalDimensionAtInfinity(t){return new Kt(t.horizontalLineEnd)}addHorizontalDimensionWithStart(t){const e=this.createRightAtInfinity(t),n=this.createBottomAtInfinity(),i=this.createTopLeft(t);return new $i(t,this,i,e,n)}addHorizontalDimensionWithStartAndEnd(t){const e=this.createBottomAtInfinity(),n=this.createTopLeft(t),i=this.createTopRight(t);return new Ji(t,this,n,i,e)}getHalfPlanesWithHorizontalCrossSection(){return[this.getStartingHalfPlaneWithHorizontalCrossSection()]}getHalfPlanesWithVerticalCrossSection(){return[this.getStartingHalfPlaneWithVerticalCrossSection()]}}class Tn extends In{constructor(t,e,n){super(t,e),this.end=n}createBottomLeftAtHorizontalInfinity(t){return new xe(new h(0,this.end),t.horizontalLineStart)}getEndingHalfPlaneWithHorizontalCrossSection(){const t=this.orientation===T.Positive?new h(-1,0):new h(1,0),e=new h(this.end,0);return new w(e,t)}getEndingHalfPlaneWithVerticalCrossSection(){const t=this.orientation===T.Positive?new h(0,-1):new h(0,1),e=new h(0,this.end);return new w(e,t)}createBottomLeft(t){return new ye(new h(t.finiteStart,this.end),U.BOTTOMLEFT,t.orientation,this.orientation)}createBottomRight(t){return new ye(new h(t.end,this.end),U.BOTTOMRIGHT,t.orientation,this.orientation)}getLength(){return Math.abs(this.end-this.finiteStart)}addEntireHorizontalDimension(t){const e=this.createLeftAtInfinity(t),n=this.createTopRightAtHorizontalInfinity(t),i=this.createBottomLeftAtHorizontalInfinity(t);return new Zi(this,e,n,i)}addHorizontalDimensionAtInfinity(t){return new Kt(t.horizontalLineEnd)}addVerticalDimension(t){return t.addHorizontalDimensionWithStartAndEnd(this)}addHorizontalDimensionWithStart(t){const e=this.createRightAtInfinity(t),n=this.createTopLeft(t),i=this.createBottomLeft(t);return new _i(this,t,n,e,i)}addHorizontalDimensionWithStartAndEnd(t){const e=this.createTopLeft(t),n=this.createTopRight(t),i=this.createBottomLeft(t),r=this.createBottomRight(t);return new tr(this,t,e,n,r,i)}getHalfPlanesWithHorizontalCrossSection(){return[this.getStartingHalfPlaneWithHorizontalCrossSection(),this.getEndingHalfPlaneWithHorizontalCrossSection()]}getHalfPlanesWithVerticalCrossSection(){return[this.getStartingHalfPlaneWithVerticalCrossSection(),this.getEndingHalfPlaneWithVerticalCrossSection()]}}function Sn(s,t){const e=t>0?T.Positive:T.Negative;return new Tn(e,s,s+t)}function yn(s,t){const e=t>0?T.Positive:T.Negative,n=new Oe(s,e);return Number.isFinite(s)?Number.isFinite(t)?new Tn(e,s,s+t):new In(e,s):Number.isFinite(t)?s<0?new jt(s,T.Negative):new jt(s,T.Positive):s>0?e===T.Positive?new jt(s,T.Positive):n:e===T.Positive?n:new jt(s,T.Negative)}function Z(s,t,e,n){const i=yn(s,e),r=yn(t,n);return i.addVerticalDimension(r)}function xn(s,t,e,n){const i=Sn(s,e);return Sn(t,n).addHorizontalDimensionWithStartAndEnd(i)}class dr{constructor(t){this.viewBox=t}fillText(t,e,n,i){let r=i===void 0?o=>{o.fillText(t,e,n)}:o=>{o.fillText(t,e,n,i)};this.viewBox.addDrawing(r,this.getDrawnRectangle(e,n,t),N.Relative,!0)}measureText(t){return this.viewBox.measureText(t)}strokeText(t,e,n,i){let r=i===void 0?o=>{o.strokeText(t,e,n)}:o=>{o.strokeText(t,e,n,i)};this.viewBox.addDrawing(r,this.getDrawnRectangle(e,n,t),N.Relative,!0)}getDrawnRectangle(t,e,n){const i=this.viewBox.measureText(n);let r;i.actualBoundingBoxRight!==void 0?r=Math.abs(i.actualBoundingBoxRight-i.actualBoundingBoxLeft):r=i.width;const o=i.actualBoundingBoxAscent!==void 0?i.actualBoundingBoxAscent+i.actualBoundingBoxDescent:1,c=i.actualBoundingBoxAscent!==void 0?i.actualBoundingBoxAscent:0;return Z(t,e-c,r,o).getArea()}}function fr(s){return typeof s.duration<"u"}function gr(s){return fr(s)?{width:s.displayWidth,height:s.displayHeight}:{width:s.width,height:s.height}}class mr{constructor(t){this.viewBox=t}drawImage(){const t=Array.prototype.slice.apply(arguments);let e,n,i,r,o,c,u,l,f;arguments.length<=5?[e,c,u,l,f]=t:[e,n,i,r,o,c,u,l,f]=t;const{width:d,height:m}=gr(e),P=this.getDrawnLength(d,n,r,l),C=this.getDrawnLength(m,i,o,f),x=Z(c,u,P,C).getArea(),B=this.getDrawImageInstruction(arguments.length,e,n,i,r,o,c,u,l,f);this.viewBox.addDrawing(B,x,N.Relative,!0)}getDrawImageInstruction(t,e,n,i,r,o,c,u,l,f){switch(t){case 3:return d=>{d.drawImage(e,c,u)};case 5:return d=>{d.drawImage(e,c,u,l,f)};case 9:return d=>{d.drawImage(e,n,i,r,o,c,u,l,f)};default:throw new TypeError(`Failed to execute 'drawImage' on 'CanvasRenderingContext2D': Valid arities are: [3, 5, 9], but ${t} arguments provided.`)}}getDrawnLength(t,e,n,i){const r=this.getLength(t);return i!==void 0?i:e!==void 0?n!==void 0?n:r-e:r}getLength(t){return typeof t=="number"?t:t.baseVal.value}}function pr(s,t,e,n,i){t=t===void 0?0:t,e=e===void 0?0:e,n=n===void 0?s.width:n,i=i===void 0?s.height:i;const r=s.data,o=new Uint8ClampedArray(4*n*i);for(let c=0;c<i;c++)for(let u=0;u<n;u++){const l=4*((e+c)*s.width+t+u),f=4*(c*n+u);o[f]=r[l],o[f+1]=r[l+1],o[f+2]=r[l+2],o[f+3]=r[l+3]}return new ImageData(o,n,i)}class Qt{constructor(t,e,n){this.area=t,this.latestClippedPath=e,this.previouslyClippedPaths=n}withClippedPath(t){const e=t.area.intersectWith(this.area);return new Qt(e,t,this)}get initialState(){return this.previouslyClippedPaths?this.previouslyClippedPaths.initialState:this.latestClippedPath.initialState}except(t){if(t!==this)return this.previouslyClippedPaths?new Qt(this.area,this.latestClippedPath,this.previouslyClippedPaths.except(t)):this}contains(t){return t?this===t?!0:this.previouslyClippedPaths?this.previouslyClippedPaths.contains(t):!1:!1}getInstructionToRecreate(){const t=(e,n)=>{this.latestClippedPath.execute(e,n)};if(this.previouslyClippedPaths){const e=this.previouslyClippedPaths.getInstructionToRecreate(),n=this.previouslyClippedPaths.latestClippedPath.state.getInstructionToConvertToState(this.latestClippedPath.initialState);return(i,r)=>{e(i,r),n(i,r),t(i,r)}}return t}}class vr extends S{valuesAreEqual(t,e){return t===e}changeToNewValue(t){return e=>{e.direction=t}}}const Le=new vr("direction",y);class wr extends S{valuesAreEqual(t,e){return t===e}changeToNewValue(t){return e=>{e.font=t}}}const Be=new wr("font",y);class bn{constructor(t){this.propertyName=t}changeInstanceValue(t,e){return this.valuesAreEqual(t[this.propertyName],e)?t:t.changeProperty(this.propertyName,e)}isEqualForInstances(t,e){return this.valuesAreEqual(t[this.propertyName],e[this.propertyName])}valueIsTransformableForInstance(t){return!0}changeToNewValue(t,e){return e?this.changeToNewValueTransformed(t):this.changeToNewValueUntransformed(t)}getInstructionToChange(t,e){const n=t[this.propertyName],i=e[this.propertyName];return this.valuesAreEqual(n,i)&&(t.fillAndStrokeStylesTransformed===e.fillAndStrokeStylesTransformed||this.valuesAreEqualWhenTransformed(n,i))?()=>{}:this.changeToNewValue(i,e.fillAndStrokeStylesTransformed)}}class On extends bn{constructor(t){super(t)}valuesAreEqual(t,e){return t===e}changeToNewValueTransformed(t){return(e,n)=>{const i=n.userTransformation;e[this.propertyName]=t*i.scale}}changeToNewValueUntransformed(t){return e=>{e[this.propertyName]=t}}valuesAreEqualWhenTransformed(t,e){return t===0&&e===0}}const Ln=new On("lineWidth"),Bn=new On("lineDashOffset");class Pr extends bn{valuesAreEqual(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}changeToNewValueTransformed(t){return(e,n)=>{const i=n.userTransformation;e.setLineDash(t.map(r=>r*i.scale))}}changeToNewValueUntransformed(t){return e=>{e.setLineDash(t)}}valuesAreEqualWhenTransformed(t,e){return t.length===0&&e.length===0}}const An=new Pr("lineDash");class Cr extends S{valuesAreEqual(t,e){return t===e}changeToNewValue(t){return e=>{e.textAlign=t}}}const Ae=new Cr("textAlign",y);class Ir extends S{valuesAreEqual(t,e){return t===e}changeToNewValue(t){return e=>{e.textBaseline=t}}}const De=new Ir("textBaseline",y);class Tr extends S{valuesAreEqual(t,e){return t===e}changeToNewValue(t){return e=>e.lineCap=t}}const Dn=new Tr("lineCap",y);class Sr extends S{valuesAreEqual(t,e){return t===e}changeToNewValue(t){return e=>e.lineJoin=t}}const En=new Sr("lineJoin",y);class yr extends S{valuesAreEqual(t,e){return t===e}changeToNewValue(t){return e=>e.miterLimit=t}}const Rn=new yr("miterLimit",y);class xr extends S{valuesAreEqual(t,e){return t===e}changeToNewValue(t){return e=>e.fontKerning=t}}const Fn=new xr("fontKerning",y),Ee=[Le,Ze,_e,nn,Bn,An,Dn,En,Rn,Qe,Je,mn,Ln,rn,Ae,De,Ft,Be,Fn,de,on,sn],br=[Be,Ae,De,Le],Pt=class Pt{constructor(t){a(this,"fillStyle");a(this,"fontKerning");a(this,"lineWidth");a(this,"lineDash");a(this,"lineCap");a(this,"lineJoin");a(this,"miterLimit");a(this,"globalAlpha");a(this,"globalCompositeOperation");a(this,"filter");a(this,"strokeStyle");a(this,"lineDashOffset");a(this,"transformation");a(this,"direction");a(this,"imageSmoothingEnabled");a(this,"imageSmoothingQuality");a(this,"font");a(this,"textAlign");a(this,"textBaseline");a(this,"clippedPaths");a(this,"fillAndStrokeStylesTransformed");a(this,"shadowOffset");a(this,"shadowColor");a(this,"shadowBlur");this.fillStyle=t.fillStyle,this.fontKerning=t.fontKerning,this.lineWidth=t.lineWidth,this.lineCap=t.lineCap,this.lineJoin=t.lineJoin,this.lineDash=t.lineDash,this.miterLimit=t.miterLimit,this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.filter=t.filter,this.strokeStyle=t.strokeStyle,this.lineDashOffset=t.lineDashOffset,this.transformation=t.transformation,this.direction=t.direction,this.imageSmoothingEnabled=t.imageSmoothingEnabled,this.imageSmoothingQuality=t.imageSmoothingQuality,this.font=t.font,this.textAlign=t.textAlign,this.textBaseline=t.textBaseline,this.clippedPaths=t.clippedPaths,this.fillAndStrokeStylesTransformed=t.fillAndStrokeStylesTransformed,this.shadowOffset=t.shadowOffset,this.shadowColor=t.shadowColor,this.shadowBlur=t.shadowBlur}changeProperty(t,e){const{fillStyle:n,fontKerning:i,lineWidth:r,lineDash:o,lineCap:c,lineJoin:u,miterLimit:l,globalAlpha:f,globalCompositeOperation:d,filter:m,strokeStyle:P,lineDashOffset:C,transformation:x,direction:B,imageSmoothingEnabled:G,imageSmoothingQuality:et,font:nt,textAlign:Dt,textBaseline:Et,clippedPaths:Rt,fillAndStrokeStylesTransformed:Xe,shadowOffset:Ue,shadowColor:$e,shadowBlur:Ke}=this,ue={fillStyle:n,fontKerning:i,lineWidth:r,lineDash:o,lineCap:c,lineJoin:u,miterLimit:l,globalAlpha:f,globalCompositeOperation:d,filter:m,strokeStyle:P,lineDashOffset:C,transformation:x,direction:B,imageSmoothingEnabled:G,imageSmoothingQuality:et,font:nt,textAlign:Dt,textBaseline:Et,clippedPaths:Rt,fillAndStrokeStylesTransformed:Xe,shadowOffset:Ue,shadowColor:$e,shadowBlur:Ke};return ue[t]=e,new Pt(ue)}get clippingRegion(){return this.clippedPaths?this.clippedPaths.area:void 0}equals(t){for(let e of Ee)if(!e.isEqualForInstances(this,t))return!1;return(!this.clippedPaths&&!t.clippedPaths||this.clippedPaths&&this.clippedPaths===t.clippedPaths)&&this.fillAndStrokeStylesTransformed===t.fillAndStrokeStylesTransformed}getMaximumLineWidth(){return this.lineWidth*this.transformation.getMaximumLineWidthScale()}getLineDashPeriod(){return this.lineDash.reduce((t,e)=>t+e,0)}isTransformable(){for(let t of Ee)if(!t.valueIsTransformableForInstance(this))return!1;return!0}getShadowOffsets(){const t=[],e=this.filter.getShadowOffset();return e!==null&&t.push(e),this.shadowOffset.equals(h.origin)||t.push(this.shadowOffset),t}getInstructionToConvertToState(t){return this.getInstructionToConvertToStateOnDimensions(t,Ee)}withClippedPath(t){const e=this.clippedPaths?this.clippedPaths.withClippedPath(t):new Qt(t.area,t);return this.changeProperty("clippedPaths",e)}getInstructionToConvertToStateOnDimensions(t,e){const n=e.map(i=>i.getInstructionToChange(this,t));return Y(...n)}};a(Pt,"default",new Pt({fillStyle:"#000",fontKerning:"auto",lineWidth:1,lineDash:[],lineCap:"butt",lineJoin:"miter",miterLimit:10,globalAlpha:1,globalCompositeOperation:"source-over",filter:Ht.none,strokeStyle:"#000",lineDashOffset:0,transformation:v.identity,direction:"inherit",imageSmoothingEnabled:!0,imageSmoothingQuality:"low",font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic",clippedPaths:void 0,fillAndStrokeStylesTransformed:!1,shadowOffset:h.origin,shadowColor:"rgba(0, 0, 0, 0)",shadowBlur:0})),a(Pt,"setDefault",()=>{});let V=Pt;class Or{constructor(t){this.viewBox=t}createImageData(t,e){}getImageData(t,e,n,i){}putImageData(t,e,n,i,r,o,c){t=pr(t,i,r,o,c);let u,l=this.viewBox.getDrawingLock();this.viewBox.createPatternFromImageData(t).then(d=>{u=d,l.release()}),this.viewBox.addDrawing(d=>{d.translate(e,n),d.fillStyle=u,d.fillRect(0,0,t.width,t.height)},Z(e,n,t.width,t.height).getArea(),N.Absolute,!1,d=>d.changeProperty("shadowColor",V.default.shadowColor).changeProperty("shadowOffset",V.default.shadowOffset).changeProperty("shadowBlur",V.default.shadowBlur).changeProperty("globalAlpha",V.default.globalAlpha).changeProperty("globalCompositeOperation",V.default.globalCompositeOperation).changeProperty("imageSmoothingEnabled",!1).changeProperty("filter",V.default.filter))}}class Lr{constructor(t){this.viewBox=t}get lineCap(){return this.viewBox.state.current.lineCap}set lineCap(t){this.viewBox.changeState(e=>Dn.changeInstanceValue(e,t))}get lineDashOffset(){return this.viewBox.state.current.lineDashOffset}set lineDashOffset(t){this.viewBox.changeState(e=>Bn.changeInstanceValue(e,t))}get lineJoin(){return this.viewBox.state.current.lineJoin}set lineJoin(t){this.viewBox.changeState(e=>En.changeInstanceValue(e,t))}get lineWidth(){return this.viewBox.state.current.lineWidth}set lineWidth(t){this.viewBox.changeState(e=>Ln.changeInstanceValue(e,t))}get miterLimit(){return this.viewBox.state.current.miterLimit}set miterLimit(t){this.viewBox.changeState(e=>Rn.changeInstanceValue(e,t))}getLineDash(){return this.viewBox.state.current.lineDash}setLineDash(t){t.length%2===1&&(t=t.concat(t)),this.viewBox.changeState(e=>An.changeInstanceValue(e,t))}}class Br{constructor(t){this.viewBox=t}set direction(t){this.viewBox.changeState(e=>Le.changeInstanceValue(e,t))}set font(t){this.viewBox.changeState(e=>Be.changeInstanceValue(e,t))}set textAlign(t){this.viewBox.changeState(e=>Ae.changeInstanceValue(e,t))}set textBaseline(t){this.viewBox.changeState(e=>De.changeInstanceValue(e,t))}set fontKerning(t){this.viewBox.changeState(e=>Fn.changeInstanceValue(e,t))}}class Ar{constructor(t){this.viewBox=t}arc(t,e,n,i,r,o){this.viewBox.addPathInstruction(st.arc(t,e,n,i,r,o))}arcTo(t,e,n,i,r){this.viewBox.addPathInstruction(st.arcTo(t,e,n,i,r))}closePath(){this.viewBox.closePath()}ellipse(t,e,n,i,r,o,c,u){this.viewBox.addPathInstruction(st.ellipse(t,e,n,i,r,o,c,u))}lineTo(t,e){this.viewBox.lineTo(new h(t,e))}lineToInfinityInDirection(t,e){this.viewBox.lineTo({direction:new h(t,e)})}moveTo(t,e){this.viewBox.moveTo(new h(t,e))}moveToInfinityInDirection(t,e){this.viewBox.moveTo({direction:new h(t,e)})}quadraticCurveTo(t,e,n,i){this.viewBox.addPathInstruction(st.quadraticCurveTo(t,e,n,i))}bezierCurveTo(t,e,n,i,r,o){this.viewBox.addPathInstruction(st.bezierCurveTo(t,e,n,i,r,o))}rect(t,e,n,i){this.viewBox.rect(t,e,n,i)}roundRect(t,e,n,i,r){this.viewBox.roundRect(t,e,n,i,r)}}class Dr{constructor(t,e,n){a(this,"canvasState");a(this,"canvasTransform");a(this,"canvasCompositing");a(this,"canvasImageSmoothing");a(this,"canvasStrokeStyles");a(this,"canvasShadowStyles");a(this,"canvasFilters");a(this,"canvasRect");a(this,"canvasDrawPath");a(this,"canvasUserInterface");a(this,"canvasText");a(this,"canvasDrawImage");a(this,"canvasImageData");a(this,"canvasPathDrawingStyles");a(this,"canvasTextDrawingStyles");a(this,"canvasPath");this.canvas=t,this.canvasState=new F(e),this.canvasTransform=new ai(e),this.canvasCompositing=new li(e),this.canvasImageSmoothing=new fi(e),this.canvasStrokeStyles=new gi(e),this.canvasShadowStyles=new wi(e),this.canvasFilters=new Ci(e,n),this.canvasRect=new Ii(e),this.canvasDrawPath=new Ti(e),this.canvasUserInterface=new Si,this.canvasText=new dr(e),this.canvasDrawImage=new mr(e),this.canvasImageData=new Or(e),this.canvasPathDrawingStyles=new Lr(e),this.canvasTextDrawingStyles=new Br(e),this.canvasPath=new Ar(e)}getContextAttributes(){return this.canvas.getContext("2d").getContextAttributes()}save(){this.canvasState.save()}restore(){this.canvasState.restore()}reset(){this.canvasState.reset()}getTransform(){return this.canvasTransform.getTransform()}resetTransform(){this.canvasTransform.resetTransform()}rotate(t){this.canvasTransform.rotate(t)}scale(t,e){this.canvasTransform.scale(t,e)}setTransform(t,e,n,i,r,o){this.canvasTransform.setTransform(t,e,n,i,r,o)}transform(t,e,n,i,r,o){this.canvasTransform.transform(t,e,n,i,r,o)}translate(t,e){this.canvasTransform.translate(t,e)}set globalAlpha(t){this.canvasCompositing.globalAlpha=t}set globalCompositeOperation(t){this.canvasCompositing.globalCompositeOperation=t}set imageSmoothingEnabled(t){this.canvasImageSmoothing.imageSmoothingEnabled=t}set imageSmoothingQuality(t){this.canvasImageSmoothing.imageSmoothingQuality=t}set fillStyle(t){this.canvasStrokeStyles.fillStyle=t}set strokeStyle(t){this.canvasStrokeStyles.strokeStyle=t}createLinearGradient(t,e,n,i){return this.canvasStrokeStyles.createLinearGradient(t,e,n,i)}createPattern(t,e){return this.canvasStrokeStyles.createPattern(t,e)}createRadialGradient(t,e,n,i,r,o){return this.canvasStrokeStyles.createRadialGradient(t,e,n,i,r,o)}createConicGradient(t,e,n){return this.canvasStrokeStyles.createConicGradient(t,e,n)}set shadowBlur(t){this.canvasShadowStyles.shadowBlur=t}set shadowColor(t){this.canvasShadowStyles.shadowColor=t}set shadowOffsetX(t){this.canvasShadowStyles.shadowOffsetX=t}set shadowOffsetY(t){this.canvasShadowStyles.shadowOffsetY=t}set filter(t){this.canvasFilters.filter=t}clearRect(t,e,n,i){this.canvasRect.clearRect(t,e,n,i)}fillRect(t,e,n,i){this.canvasRect.fillRect(t,e,n,i)}strokeRect(t,e,n,i){this.canvasRect.strokeRect(t,e,n,i)}beginPath(){this.canvasDrawPath.beginPath()}clip(t,e){this.canvasDrawPath.clip(t,e)}fill(t,e){this.canvasDrawPath.fill(t,e)}isPointInPath(t,e,n,i){return this.canvasDrawPath.isPointInPath(t,e,n,i)}isPointInStroke(t,e,n){return this.canvasDrawPath.isPointInStroke(t,e,n)}stroke(t){this.canvasDrawPath.stroke(t)}drawFocusIfNeeded(t,e){this.canvasUserInterface.drawFocusIfNeeded(t,e)}scrollPathIntoView(t){this.canvasUserInterface.scrollPathIntoView(t)}fillText(t,e,n,i){this.canvasText.fillText(t,e,n,i)}measureText(t){return this.canvasText.measureText(t)}strokeText(t,e,n,i){this.canvasText.strokeText(t,e,n,i)}drawImage(){this.canvasDrawImage.drawImage.apply(this.canvasDrawImage,arguments)}createImageData(t,e){return this.canvasImageData.createImageData(t,e)}getImageData(t,e,n,i){return this.canvasImageData.getImageData(t,e,n,i)}putImageData(t,e,n,i,r,o,c){this.canvasImageData.putImageData(t,e,n,i,r,o,c)}set lineCap(t){this.canvasPathDrawingStyles.lineCap=t}set lineDashOffset(t){this.canvasPathDrawingStyles.lineDashOffset=t}set lineJoin(t){this.canvasPathDrawingStyles.lineJoin=t}set lineWidth(t){this.canvasPathDrawingStyles.lineWidth=t}set miterLimit(t){this.canvasPathDrawingStyles.miterLimit=t}getLineDash(){return this.canvasPathDrawingStyles.getLineDash()}setLineDash(t){this.canvasPathDrawingStyles.setLineDash(t)}set direction(t){this.canvasTextDrawingStyles.direction=t}set font(t){this.canvasTextDrawingStyles.font=t}set textAlign(t){this.canvasTextDrawingStyles.textAlign=t}set textBaseline(t){this.canvasTextDrawingStyles.textBaseline=t}set fontKerning(t){this.canvasTextDrawingStyles.fontKerning=t}arc(t,e,n,i,r,o){this.canvasPath.arc(t,e,n,i,r,o)}arcTo(t,e,n,i,r){this.canvasPath.arcTo(t,e,n,i,r)}bezierCurveTo(t,e,n,i,r,o){this.canvasPath.bezierCurveTo(t,e,n,i,r,o)}closePath(){this.canvasPath.closePath()}ellipse(t,e,n,i,r,o,c,u){this.canvasPath.ellipse(t,e,n,i,r,o,c)}lineTo(t,e){this.canvasPath.lineTo(t,e)}lineToInfinityInDirection(t,e){this.canvasPath.lineToInfinityInDirection(t,e)}moveTo(t,e){this.canvasPath.moveTo(t,e)}moveToInfinityInDirection(t,e){this.canvasPath.moveToInfinityInDirection(t,e)}quadraticCurveTo(t,e,n,i){this.canvasPath.quadraticCurveTo(t,e,n,i)}rect(t,e,n,i){this.canvasPath.rect(t,e,n,i)}roundRect(t,e,n,i,r){this.canvasPath.roundRect(t,e,n,i,r)}}class Re extends Wt{constructor(){super(...arguments);a(this,"colorStops",[])}addColorStopsToGradient(e){for(const n of this.colorStops)e.addColorStop(n.offset,n.color)}addColorStop(e,n){this.colorStops.push({offset:e,color:n})}getInstructionToSetTransformed(e){return(n,i)=>{const r=i.userTransformation;n[e]=this.createTransformedGradient(r)}}getInstructionToSetUntransformed(e){return n=>{n[e]=this.createGradient()}}}class Er extends Re{constructor(t,e,n,i,r){super(),this.context=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}createTransformedGradient(t){const{x:e,y:n}=t.apply(new h(this.x0,this.y0)),{x:i,y:r}=t.apply(new h(this.x1,this.y1)),o=this.context.createLinearGradient(e,n,i,r);return this.addColorStopsToGradient(o),o}createGradient(){const t=this.context.createLinearGradient(this.x0,this.y0,this.x1,this.y1);return this.addColorStopsToGradient(t),t}}class Rr extends Re{constructor(t,e,n,i,r,o,c){super(),this.context=t,this.x0=e,this.y0=n,this.r0=i,this.x1=r,this.y1=o,this.r1=c}createTransformedGradient(t){const{x:e,y:n}=t.apply(new h(this.x0,this.y0)),{x:i,y:r}=t.apply(new h(this.x1,this.y1)),o=this.r0*t.scale,c=this.r1*t.scale,u=this.context.createRadialGradient(e,n,o,i,r,c);return this.addColorStopsToGradient(u),u}createGradient(){const t=this.context.createRadialGradient(this.x0,this.y0,this.r0,this.x1,this.y1,this.r1);return this.addColorStopsToGradient(t),t}}class Wn{constructor(t){a(this,"instructions",[]);this.currentState=t}restore(){this.addChangeToState(this.currentState.restored(),t=>{t.restore()})}save(){this.addChangeToState(this.currentState.saved(),t=>{t.save()})}changeCurrentInstanceTo(t){if(this.currentState.current.equals(t))return;const e=this.currentState.current.getInstructionToConvertToState(t),n=this.currentState.withCurrentState(t);this.addChangeToState(n,e)}addChangeToState(t,e){this.currentState=t,e&&this.instructions.push(e)}get instruction(){if(this.instructions.length!==0)return(t,e)=>{for(const n of this.instructions)n(t,e)}}}class Fe extends Wn{changeCurrentInstanceTo(t){if(!this.currentState.current.equals(t)){if(!Fe.canConvert(this.currentState.current,t))if(this.currentState.stack.length>0)this.restore(),this.save();else{super.changeCurrentInstanceTo(t);return}if(t.clippedPaths){const e=this.currentState,i=e.current.clippedPaths;if(t.clippedPaths===i)super.changeCurrentInstanceTo(t);else{const o=t.clippedPaths.except(i);this.convertToState(o.initialState),this.addChangeToState(o.latestClippedPath.state,o.getInstructionToRecreate()),this.convertToState(e.replaceCurrent(t))}}else super.changeCurrentInstanceTo(t)}}convertToState(t){const e=this.currentState.getInstructionToConvertToState(t);this.addChangeToState(t,e)}static canConvert(t,e){return t.clippedPaths?e.clippedPaths?e.clippedPaths.contains(t.clippedPaths):!1:!0}}class _{constructor(t,e=[]){this.current=t,this.stack=e}replaceCurrent(t){return new _(t,this.stack)}withCurrentState(t){return new _(t,this.stack)}currentlyTransformed(t){return this.withCurrentState(this.current.changeProperty("fillAndStrokeStylesTransformed",t))}withClippedPath(t){return new _(this.current.withClippedPath(t),this.stack)}saved(){return new _(this.current,(this.stack||[]).concat([this.current]))}restored(){if(!this.stack||this.stack.length===0)return this;const t=this.stack[this.stack.length-1];return new _(t,this.stack.slice(0,this.stack.length-1))}convertToLastSavedInstance(t,e){for(let n=this.stack.length-1;n>e;n--)t.restore()}convertFromLastSavedInstance(t,e){for(let n=e+1;n<this.stack.length;n++)t.changeCurrentInstanceTo(this.stack[n]),t.save();t.changeCurrentInstanceTo(this.current)}getInstructionToConvertToStateUsingConversion(t,e){const n=_.findIndexOfHighestCommon(this.stack,e.stack);return this.convertToLastSavedInstance(t,n),e.convertFromLastSavedInstance(t,n),t.instruction}getInstructionToConvertToState(t){return this.getInstructionToConvertToStateUsingConversion(new Wn(this),t)}getInstructionToConvertToStateWithClippedPath(t){return this.getInstructionToConvertToStateUsingConversion(new Fe(this),t)}static findIndexOfHighestCommon(t,e){let n=0,i=Math.min(t.length-1,e.length-1);for(;n<=i;){if(!t[n].equals(e[n]))return n-1;n++}return n-1}}const kn=new _(V.default,[]);class Fr{constructor(t){this.area=t}hasDrawingAcrossBorderOf(t){return!1}intersects(t){return this.area.intersects(t)}isContainedBy(t){return t.contains(this.area)}}class We extends X{constructor(e,n,i,r,o){super(e,n,i,r);a(this,"drawingArea");this.drawingArea=new Fr(o)}static createClearRect(e,n,i,r,o,c,u){return new We(e,e,(l,f)=>{i.clearRect(l,f,r,o,c,u)},()=>{},n)}}class Jt extends Pe{reconstructState(t,e){e.setInitialStateWithClippedPaths(t)}hasDrawingAcrossBorderOf(t){return this.contains(e=>e.drawingArea.hasDrawingAcrossBorderOf(t))}intersects(t){return this.contains(e=>e.drawingArea.intersects(t))}addClearRect(t,e,n,i,r,o){const u=new Ie({lineWidth:0,lineDashPeriod:0,shadowOffsets:[]}).getInfinity(e),l=We.createClearRect(e,t,u,n,i,r,o);l.setInitialState(this.state),this.add(l)}clearContentsInsideArea(t){this.removeAll(e=>e.drawingArea.isContainedBy(t))}static create(){return new Jt(new X(kn,kn,V.setDefault,()=>{}))}}class Wr{constructor(t){this.area=t}hasDrawingAcrossBorderOf(t){return this.isContainedBy(t)?!1:this.intersects(t)}isContainedBy(t){return t.contains(this.area)}intersects(t){return this.area.intersects(t)}}class kr{constructor(t,e){a(this,"drawingArea");this.instructions=t,this.drawingArea=new Wr(e)}get state(){return this.instructions.state}get initialState(){return this.instructions.initialState}get stateOfFirstInstruction(){return this.instructions.stateOfFirstInstruction}setInitialState(t){this.instructions.setInitialState(t)}setInitialStateWithClippedPaths(t){this.instructions.setInitialStateWithClippedPaths(t)}addClippedPath(t){this.instructions.addClippedPath(t)}execute(t,e){this.instructions.execute(t,e)}}function Hr(s,t,e,n){if(e===void 0){t.addSubpaths(s,n);return}let i=Qi(e);if(!i)return;t.getRoundRect(i).addSubpaths(s,n)}class Vr{constructor(t){a(this,"currentInstructionsWithPath");a(this,"previousInstructionsWithPath");a(this,"state");this.onChange=t,this.previousInstructionsWithPath=Jt.create(),this.state=this.previousInstructionsWithPath.state}beginPath(){const t=yt.create(this.state);t.setInitialStateWithClippedPaths(this.previousInstructionsWithPath.state),this.currentInstructionsWithPath=t}changeState(t){this.state=this.state.withCurrentState(t(this.state.current))}saveState(){this.state=this.state.saved()}restoreState(){this.state=this.state.restored()}resetState(){this.previousInstructionsWithPath=Jt.create(),this.state=this.previousInstructionsWithPath.state,this.currentInstructionsWithPath=void 0,this.onChange()}allSubpathsAreClosable(){return!this.currentInstructionsWithPath||this.currentInstructionsWithPath.allSubpathsAreClosable()}currentPathSurroundsFinitePoint(){return this.currentInstructionsWithPath&&this.currentInstructionsWithPath.surroundsFinitePoint()}currentSubpathIsClosable(){return!this.currentInstructionsWithPath||this.currentInstructionsWithPath.currentSubpathIsClosable()}fillPath(t){if(!this.currentInstructionsWithPath)return;const e=z.forFillingPath(t,this.state,()=>this.currentInstructionsWithPath);this.state=e.state,this.incorporateDrawingInstruction(e)}strokePath(){if(!this.currentInstructionsWithPath)return;const t=z.forStrokingPath(e=>{e.stroke()},this.state,()=>this.currentInstructionsWithPath);this.state=t.state,this.incorporateDrawingInstruction(t)}fillRect(t,e){const n=t.fill(this.state,e);n&&this.incorporateDrawingInstruction(n)}strokeRect(t){const e=t.stroke(this.state,n=>{n.stroke()});e&&this.incorporateDrawingInstruction(e)}addDrawing(t,e,n,i,r){const o=this.state.currentlyTransformed(!1);n===N.Relative&&(e=e.transform(this.state.current.transformation));let c;r&&(c=o.withCurrentState(r(o.current))),this.incorporateDrawingInstruction(new z(t,e,u=>X.create(o,u),i,n,o,c))}clipPath(t){this.clipCurrentPath(t)}incorporateDrawingInstruction(t){const e=t.getDrawnArea();if(e===L)return;const n=t.getModifiedInstruction();this.addToPreviousInstructions(n,e,t.build),this.currentInstructionsWithPath||(this.state=this.previousInstructionsWithPath.state),this.onChange()}addToPreviousInstructions(t,e,n){const i=new kr(n(t),e);i.setInitialStateWithClippedPaths(this.previousInstructionsWithPath.state),this.previousInstructionsWithPath.add(i)}clipCurrentPath(t){this.currentInstructionsWithPath&&(this.currentInstructionsWithPath.clipPath(t,this.state),this.state=this.currentInstructionsWithPath.state)}addPathInstruction(t){this.currentInstructionsWithPath&&this.currentInstructionsWithPath.addPathInstruction(t,this.state)}closePath(){this.currentInstructionsWithPath&&this.currentInstructionsWithPath.closePath()}moveTo(t){this.currentInstructionsWithPath&&this.currentInstructionsWithPath.moveTo(t,this.state)}canAddLineTo(t){return!this.currentInstructionsWithPath||this.currentInstructionsWithPath.canAddLineTo(t,this.state)}lineTo(t){this.currentInstructionsWithPath&&this.currentInstructionsWithPath.lineTo(t,this.state)}rect(t){this.currentInstructionsWithPath&&t.addSubpaths(this.currentInstructionsWithPath,this.state)}roundRect(t,e){this.currentInstructionsWithPath&&Hr(this.currentInstructionsWithPath,t,e,this.state)}intersects(t){return this.previousInstructionsWithPath.intersects(t)}clearContentsInsideArea(t){this.previousInstructionsWithPath.clearContentsInsideArea(t),this.currentInstructionsWithPath&&this.currentInstructionsWithPath.setInitialStateWithClippedPaths(this.previousInstructionsWithPath.state)}clearArea(t,e,n,i){const o=Z(t,e,n,i).getArea();if(!o)return;const c=o.transform(this.state.current.transformation);this.intersects(c)&&(this.clearContentsInsideArea(c),this.previousInstructionsWithPath.hasDrawingAcrossBorderOf(c)&&(this.previousInstructionsWithPath.addClearRect(o,this.state,t,e,n,i),this.currentInstructionsWithPath&&this.currentInstructionsWithPath.setInitialStateWithClippedPaths(this.state)),this.onChange())}execute(t,e){this.previousInstructionsWithPath.length&&this.previousInstructionsWithPath.execute(t,e);const i=this.previousInstructionsWithPath.state.stack.length;for(let r=0;r<i;r++)t.restore()}}class Mr extends Re{constructor(t,e,n,i){super(),this.context=t,this.startAngle=e,this.x=n,this.y=i}createTransformedGradient(t){const{x:e,y:n}=t.apply(new h(this.x,this.y)),i=t.getRotationAngle(),r=this.context.createConicGradient(this.startAngle+i,e,n);return this.addColorStopsToGradient(r),r}createGradient(){const t=this.context.createConicGradient(this.startAngle,this.x,this.y);return this.addColorStopsToGradient(t),t}}class Nr{constructor(t,e,n,i,r){a(this,"instructionSet");this.rectangleManager=t,this.context=e,this.drawingIterationProvider=n,this.drawLockProvider=i,this.isTransforming=r,this.instructionSet=new Vr(()=>this.draw())}get width(){return this.rectangleManager.rectangle.viewboxWidth}get height(){return this.rectangleManager.rectangle.viewboxHeight}get state(){return this.instructionSet.state}get transformation(){return this.rectangleManager.rectangle.userTransformation}set transformation(t){this.rectangleManager.setTransformation(t),this.draw()}getDrawingLock(){return this.drawLockProvider()}changeState(t){this.instructionSet.changeState(t)}measureText(t){this.context.save(),V.default.getInstructionToConvertToStateOnDimensions(this.state.currentlyTransformed(!1).current,br)(this.context);const n=this.context.measureText(t);return this.context.restore(),n}saveState(){this.instructionSet.saveState()}restoreState(){this.instructionSet.restoreState()}resetState(){this.instructionSet.resetState()}beginPath(){this.instructionSet.beginPath()}async createPatternFromImageData(t){const e=await createImageBitmap(t);return this.context.createPattern(e,"no-repeat")}addDrawing(t,e,n,i,r){this.instructionSet.addDrawing(t,e,n,i,r)}addPathInstruction(t){this.instructionSet.addPathInstruction(t)}closePath(){this.instructionSet.currentSubpathIsClosable()&&this.instructionSet.closePath()}moveTo(t){this.instructionSet.moveTo(t)}lineTo(t){this.instructionSet.canAddLineTo(t)&&this.instructionSet.lineTo(t)}rect(t,e,n,i){const r=Z(t,e,n,i);this.instructionSet.rect(r)}roundRect(t,e,n,i,r){const o=Z(t,e,n,i);this.instructionSet.roundRect(o,r)}currentPathCanBeFilled(){return this.instructionSet.allSubpathsAreClosable()&&this.instructionSet.currentPathSurroundsFinitePoint()}fillPath(t){this.instructionSet.fillPath(t)}strokePath(){this.instructionSet.strokePath()}fillRect(t,e,n,i,r){const o=Z(t,e,n,i);this.instructionSet.fillRect(o,r)}strokeRect(t,e,n,i){const r=Z(t,e,n,i);this.instructionSet.strokeRect(r)}clipPath(t){this.instructionSet.clipPath(t)}clearArea(t,e,n,i){this.instructionSet.clearArea(t,e,n,i)}createLinearGradient(t,e,n,i){return new Er(this.context,t,e,n,i)}createRadialGradient(t,e,n,i,r,o){return new Rr(this.context,t,e,n,i,r,o)}createConicGradient(t,e,n){return new Mr(this.context,t,e,n)}createPattern(t,e){let n;return n=new tn(this.context.createPattern(t,e)),n}draw(){this.drawingIterationProvider.provideDrawingIteration(()=>(this.isTransforming()||this.rectangleManager.measure(),this.rectangleManager.rectangle?(this.context.restore(),this.context.save(),this.context.clearRect(0,0,this.width,this.height),this.setInitialTransformation(),this.instructionSet.execute(this.context,this.rectangleManager.rectangle),!0):!1))}setInitialTransformation(){const t=this.rectangleManager.rectangle.initialBitmapTransformation;if(t.equals(v.identity))return;const{a:e,b:n,c:i,d:r,e:o,f:c}=t;this.context.setTransform(e,n,i,r,o,c)}}class zr{constructor(t,e){a(this,"point");a(this,"angularVelocity");a(this,"initialTransformation");this.context=e,this.initialTransformation=e.transformation,this.angularVelocity=Math.PI/100,this.point=t.onMoved(()=>{this.setTransformation()},!1)}setTransformation(){this.context.transformation=this.initialTransformation.before(v.rotation(this.point.initial.x,this.point.initial.y,(this.point.initial.x-this.point.current.x)*this.angularVelocity))}withAnchor(t){return this}withoutAnchor(t){this.point.cancel()}end(){this.point.cancel()}}class qr{constructor(t,e,n,i,r){a(this,"maxScaleLogStep");a(this,"currentScaleLog");a(this,"targetScaleLog");a(this,"stepTimeout");a(this,"initialTransformation");this.transformable=t,this.centerX=e,this.centerY=n,this.onFinish=r,this.initialTransformation=t.transformation,this.maxScaleLogStep=.1,this.currentScaleLog=0,this.targetScaleLog=Math.log(i),this.makeStep()}makeStep(){const t=this.targetScaleLog-this.currentScaleLog;Math.abs(t)<=this.maxScaleLogStep?(this.currentScaleLog+=t,this.setTransformToCurrentScaleLog(),this.onFinish()):(this.currentScaleLog+=t<0?-this.maxScaleLogStep:this.maxScaleLogStep,this.setTransformToCurrentScaleLog(),this.stepTimeout=setTimeout(()=>this.makeStep(),20))}setTransformToCurrentScaleLog(){this.transformable.transformation=this.initialTransformation.before(v.zoom(this.centerX,this.centerY,Math.exp(this.currentScaleLog)))}cancel(){this.stepTimeout!==void 0&&clearTimeout(this.stepTimeout)}}class Gr{constructor(t,e){a(this,"point");a(this,"initialTransformation");this.anchor=t,this.context=e,this.initialTransformation=e.transformation,this.point=t.onMoved(()=>{this.setTransformation()},!0)}setTransformation(){this.context.transformation=this.initialTransformation.before(this.getTranslation())}getTranslation(){return v.translation(this.point.current.x-this.point.initial.x,this.point.current.y-this.point.initial.y)}withAnchor(t){return t===this.anchor?this:this.context.getGestureForTwoAnchors(this.point.cancel(),t)}withoutAnchor(t){this.point.cancel()}}class Hn{constructor(t,e,n){a(this,"point1");a(this,"point2");a(this,"initialTransformation");this.context=n,this.initialTransformation=n.transformation,this.point1=t.onMoved(()=>this.setTransformation(),this.fixesFirstAnchorOnInfiniteCanvas()),this.point2=e.onMoved(()=>this.setTransformation(),this.fixesSecondAnchorOnInfiniteCanvas())}withAnchor(t){return this}withoutAnchor(t){const e=this.point1.cancel(),n=this.point2.cancel();if(t===e)return this.context.getGestureForOneAnchor(n);if(t===n)return this.context.getGestureForOneAnchor(e)}}class Yr extends Hn{constructor(t,e,n){super(t,e,n)}fixesFirstAnchorOnInfiniteCanvas(){return!0}fixesSecondAnchorOnInfiniteCanvas(){return!1}setTransformation(){this.context.transformation=this.initialTransformation.before(v.translateZoom(this.point1.initial.x,this.point1.initial.y,this.point2.initial.x,this.point2.initial.y,this.point1.current.x,this.point1.current.y,this.point2.current.x,this.point2.current.y))}}class Xr extends Hn{constructor(t,e,n){super(t,e,n)}fixesFirstAnchorOnInfiniteCanvas(){return!0}fixesSecondAnchorOnInfiniteCanvas(){return!0}setTransformation(){this.context.transformation=this.initialTransformation.before(v.translateRotateZoom(this.point1.initial.x,this.point1.initial.y,this.point2.initial.x,this.point2.initial.y,this.point1.current.x,this.point1.current.y,this.point2.current.x,this.point2.current.y))}}class xt{constructor(){a(this,"mapped",[])}onRemoved(t){}add(t){this.mapped.some(e=>this.mapsTo(e,t))||this.mapped.push(this.map(t))}remove(t){const e=this.mapped.findIndex(i=>this.mapsTo(i,t));if(e===-1)return;const[n]=this.mapped.splice(e,1);this.onRemoved(n)}}class tt extends xt{map(t){return t}mapsTo(t,e){return t.listener===e.listener}onRemoved(t){t.removedCallback&&t.removedCallback()}addListener(t,e){this.add({listener:t,removedCallback:e})}removeListener(t){this.remove({listener:t})}dispatch(t){const e=this.mapped.map(n=>n.listener);for(let n of e)n(t)}}class Ur{constructor(t,e){a(this,"currentTimeout");a(this,"_changing");a(this,"_firstChange");a(this,"_subsequentChange");a(this,"_changeEnd");this.setNewValue=t,this.timeoutInMs=e,this._changing=!1,this._firstChange=new tt,this._subsequentChange=new tt,this._changeEnd=new tt}get firstChange(){return this._firstChange}get subsequentChange(){return this._subsequentChange}get changeEnd(){return this._changeEnd}get changing(){return this._changing}refreshTimeout(){this.currentTimeout!==void 0&&clearTimeout(this.currentTimeout),this.currentTimeout=setTimeout(()=>{this._changing=!1,this.currentTimeout=void 0,this._changeEnd.dispatch()},this.timeoutInMs)}setValue(t){this.setNewValue(t),this._changing||(this._changing=!0,this._firstChange.dispatch()),this._subsequentChange.dispatch(),this.refreshTimeout()}}class $r{constructor(t,e){a(this,"gesture");a(this,"_zoom");a(this,"_transformationChangeMonitor");this.viewBox=t,this.config=e,this._transformationChangeMonitor=new Ur(n=>this.viewBox.transformation=n,100)}get isTransforming(){return this._transformationChangeMonitor.changing}get transformationStart(){return this._transformationChangeMonitor.firstChange}get transformationChange(){return this._transformationChangeMonitor.subsequentChange}get transformationEnd(){return this._transformationChangeMonitor.changeEnd}get transformation(){return this.viewBox.transformation}set transformation(t){this._transformationChangeMonitor.setValue(t)}getGestureForOneAnchor(t){return new Gr(t,this)}getGestureForTwoAnchors(t,e){return this.config.rotationEnabled?new Xr(t,e,this):new Yr(t,e,this)}releaseAnchor(t){this.gesture&&(this.gesture=this.gesture.withoutAnchor(t))}zoom(t,e,n){this._zoom&&this._zoom.cancel(),this._zoom=new qr(this,t,e,n,()=>{this._zoom=void 0})}addRotationAnchor(t){this.gesture=new zr(t,this)}addAnchor(t){if(!this.gesture){this.gesture=this.getGestureForOneAnchor(t);return}const e=this.gesture.withAnchor(t);e&&(this.gesture=e)}}class Kr{constructor(){a(this,"animationFrameRequested",!1)}provideDrawingIteration(t){this.animationFrameRequested||(this.animationFrameRequested=!0,requestAnimationFrame(()=>{t(),this.animationFrameRequested=!1}))}}class jr{constructor(t){a(this,"_drawHappened",new tt);this.drawingIterationProvider=t}get drawHappened(){return this._drawHappened}provideDrawingIteration(t){this.drawingIterationProvider.provideDrawingIteration(()=>{const e=t();return e&&this._drawHappened.dispatch(),e})}}class Qr{constructor(t){a(this,"_draw");a(this,"_locks",[]);this.drawingIterationProvider=t}removeLock(t){const e=this._locks.indexOf(t);this._locks.splice(e,1),this._locks.length===0&&this._draw&&this.drawingIterationProvider.provideDrawingIteration(this._draw)}provideDrawingIteration(t){this._locks.length?this._draw=t:this.drawingIterationProvider.provideDrawingIteration(t)}getLock(){let t;return t={release:()=>{this.removeLock(t)}},this._locks.push(t),t}}var b=(s=>(s[s.CSS=0]="CSS",s[s.CANVAS=1]="CANVAS",s))(b||{});class D{constructor(t){a(this,"inverseBase");this.base=t,this.inverseBase=t.inverse()}getSimilarTransformation(t){return this.inverseBase.before(t).before(this.base)}representSimilarTransformation(t){return this.base.before(t).before(this.inverseBase)}representBase(t){return t.before(this.inverseBase)}}class bt{constructor(t,e,n){a(this,"userCoordinatesInsideCanvasBitmap");a(this,"icContextFromCanvasBitmap");a(this,"infiniteCanvasContext");a(this,"initialBitmapTransformation");this.userCoordinates=t,this.canvasBitmap=e,this.virtualBitmapBase=n,this.setDerivedProperties()}withCanvasBitmapDistortion(t){const e=this.canvasBitmap.representBase(t),n=this.userCoordinates.representSimilarTransformation(e),i=this.virtualBitmapBase.before(n),r=new D(t);return new bt(this.userCoordinates,r,i)}withUserTransformation(t){return new bt(new D(t),this.canvasBitmap,this.virtualBitmapBase)}setDerivedProperties(){this.infiniteCanvasContext=new D(this.virtualBitmapBase.before(this.userCoordinates.base)),this.userCoordinatesInsideCanvasBitmap=new D(this.userCoordinates.base.before(this.canvasBitmap.base)),this.initialBitmapTransformation=this.canvasBitmap.representBase(this.userCoordinates.getSimilarTransformation(this.virtualBitmapBase)),this.icContextFromCanvasBitmap=new D(this.infiniteCanvasContext.base.before(this.canvasBitmap.inverseBase))}}class Ot{constructor(t,e){a(this,"userCoordinatesInsideCanvasBitmap");a(this,"icContextFromCanvasBitmap");a(this,"initialBitmapTransformation");this.userCoordinates=t,this.canvasBitmap=e,this.setDerivedProperties()}get infiniteCanvasContext(){return this.userCoordinates}withUserTransformation(t){return new Ot(new D(t),this.canvasBitmap)}withCanvasBitmapDistortion(t){return new Ot(this.userCoordinates,new D(t))}setDerivedProperties(){this.userCoordinatesInsideCanvasBitmap=new D(this.userCoordinates.base.before(this.canvasBitmap.base)),this.initialBitmapTransformation=this.canvasBitmap.inverseBase,this.icContextFromCanvasBitmap=new D(this.userCoordinates.base.before(this.canvasBitmap.inverseBase))}}function Vn(s){const{screenWidth:t,screenHeight:e,viewboxWidth:n,viewboxHeight:i}=s;return new v(t/n,0,0,e/i,0,0)}class ft{constructor(t,e){this.units=t,this.coordinates=e}get userTransformation(){return this.coordinates.userCoordinates.base}get infiniteCanvasContext(){return this.coordinates.infiniteCanvasContext}get initialBitmapTransformation(){return this.coordinates.initialBitmapTransformation}getBitmapTransformationToTransformedInfiniteCanvasContext(){return this.coordinates.userCoordinates.base}getBitmapTransformationToInfiniteCanvasContext(){return this.coordinates.icContextFromCanvasBitmap.base}translateInfiniteCanvasContextTransformationToBitmapTransformation(t){return this.coordinates.icContextFromCanvasBitmap.getSimilarTransformation(v.create(t))}getTransformationForInstruction(t){const e=v.create(t).before(this.coordinates.infiniteCanvasContext.base),n=this.coordinates.userCoordinatesInsideCanvasBitmap.representBase(e);return this.coordinates.userCoordinates.getSimilarTransformation(n)}withUserTransformation(t){const e=this.coordinates.withUserTransformation(t);return new ft(this.units,e)}withCanvasMeasurement(t){const e=Vn(t),n=this.coordinates.withCanvasBitmapDistortion(e);return new ft(this.units,n)}withUnits(t){if(t===this.units)return this;let e;return t===b.CANVAS?e=new bt(this.coordinates.userCoordinates,this.coordinates.canvasBitmap,this.coordinates.canvasBitmap.base):e=new Ot(this.coordinates.userCoordinates,this.coordinates.canvasBitmap),new ft(t,e)}static create(t,e){const n=Vn(e),i=t===b.CANVAS?new bt(new D(v.identity),new D(n),n):new Ot(new D(v.identity),new D(n));return new ft(t,i)}}function Jr(s,t){return s?t?s.viewboxWidth===t.viewboxWidth&&s.viewboxHeight===t.viewboxHeight&&s.screenWidth===t.screenWidth&&s.screenHeight===t.screenHeight:!1:!t}class gt{constructor(t,e,n){this.coordinates=t,this.measurement=e,this.polygon=n}get viewboxWidth(){return this.measurement.viewboxWidth}get viewboxHeight(){return this.measurement.viewboxHeight}get userTransformation(){return this.coordinates.userTransformation}get infiniteCanvasContext(){return this.coordinates.infiniteCanvasContext}get initialBitmapTransformation(){return this.coordinates.initialBitmapTransformation}withUnits(t){const e=this.coordinates.withUnits(t);return new gt(e,this.measurement,this.polygon)}withTransformation(t){const e=this.coordinates.withUserTransformation(v.create(t));return new gt(e,this.measurement,this.polygon)}withMeasurement(t){if(Jr(this.measurement,t))return this;const{viewboxWidth:n,viewboxHeight:i}=t,r=xn(0,0,n,i).getArea(),o=this.coordinates.withCanvasMeasurement(t);return new gt(o,t,r)}getCSSPosition(t,e){const{left:n,top:i}=this.measurement;return new h(t-n,e-i)}getTransformationForInstruction(t){return this.coordinates.getTransformationForInstruction(t)}translateInfiniteCanvasContextTransformationToBitmapTransformation(t){return this.coordinates.translateInfiniteCanvasContextTransformationToBitmapTransformation(t)}getBitmapTransformationToTransformedInfiniteCanvasContext(){return this.coordinates.getBitmapTransformationToTransformedInfiniteCanvasContext()}getBitmapTransformationToInfiniteCanvasContext(){return this.coordinates.getBitmapTransformationToInfiniteCanvasContext()}addPathAroundViewbox(t,e,n){const i=this.viewboxWidth+2*e,r=this.viewboxHeight+2*e;t.save(),t.setTransform(1,0,0,1,0,0),n?t.rect(i-e,-e,-i,r):t.rect(-e,-e,i,r),t.restore()}static create(t,e){const{viewboxWidth:n,viewboxHeight:i}=t,r=xn(0,0,n,i).getArea(),o=ft.create(e,t);return new gt(o,t,r)}}class Zr{constructor(t,e){a(this,"rectangle");a(this,"transformation");this.measurementProvider=t,this.config=e,this.transformation=v.identity}setTransformation(t){this.rectangle?this.rectangle=this.rectangle.withTransformation(t):this.transformation=t}measure(){const t=this.config.units===b.CSS?b.CSS:b.CANVAS,e=this.measurementProvider.measure();e.screenWidth===0||e.screenHeight===0?this.rectangle=void 0:this.rectangle?this.rectangle=this.rectangle.withUnits(t).withMeasurement(e):this.rectangle=gt.create(e,t).withTransformation(this.transformation)}}class _r{constructor(t){this.canvas=t}measure(){const t=this.canvas.getBoundingClientRect();return{left:t.left,top:t.top,screenWidth:t.width,screenHeight:t.height,viewboxWidth:this.canvas.width,viewboxHeight:this.canvas.height}}}function mt(s){const{a:t,b:e,c:n,d:i,e:r,f:o}=s;return{a:t,b:e,c:n,d:i,e:r,f:o}}const ts={transformationstart:null,transformationchange:null,transformationend:null},Mn={auxclick:null,click:null,contextmenu:null,dblclick:null,mouseenter:null,mouseleave:null,mouseout:null,mouseover:null,mouseup:null},Nn={gotpointercapture:null,lostpointercapture:null,pointerenter:null,pointerout:null,pointerover:null},zn={drag:null,dragend:null,dragenter:null,dragleave:null,dragover:null,dragstart:null,drop:null},qn={touchcancel:null,touchend:null},es={...Mn,...Nn,...zn,...qn},Gn={mousedown:null,mousemove:null,pointerdown:null,pointermove:null,pointerleave:null,pointercancel:null,pointerup:null,wheel:null,touchstart:null,touchmove:null,wheelignored:null,touchignored:null};function Zt(s){return ts.hasOwnProperty(s)}function _t(s){return es.hasOwnProperty(s)||Gn.hasOwnProperty(s)}function te(s){return Gn.hasOwnProperty(s)}function ee(s){return Mn.hasOwnProperty(s)}function ne(s){return Nn.hasOwnProperty(s)}function ie(s){return zn.hasOwnProperty(s)}function re(s){return qn.hasOwnProperty(s)}class ns extends xt{constructor(t){super(),this.source=t}map(t){const e=()=>{this.remove(t),t.removedCallback&&t.removedCallback()};return this.source.addListener(t.listener,e),{listener:t.listener,removedCallback:e}}mapsTo(t,e){return t.listener===e.listener}onRemoved(t){t.removedCallback(),this.source.removeListener(t.listener)}addListener(t,e){this.add({listener:t,removedCallback:e})}removeListener(t){this.remove({listener:t})}}class is extends xt{constructor(e,n){super();a(this,"old");this.transform=n,this.old=new ns(e)}map(e){const n={oldListener:void 0,newListener:e.listener,removedCallback:()=>{e.removedCallback&&e.removedCallback()}};return n.oldListener=this.transform(e.listener,i=>n.removedCallback=()=>{e.removedCallback&&e.removedCallback(),i()}),this.old.addListener(n.oldListener,()=>this.removeListener(e.listener)),n}mapsTo(e,n){return e.newListener===n.listener}onRemoved(e){this.old.removeListener(e.oldListener),e.removedCallback()}addListener(e,n){this.add({listener:e,removedCallback:n})}removeListener(e){this.remove({listener:e})}}function ot(s,t){return new is(s,t)}function $(s,t){return ot(s,e=>n=>{e(t(n))})}function se(s){return!!s&&typeof s.handleEvent=="function"}class rs extends xt{constructor(t){super(),this.source=t}mapsTo(t,e){return t.listenerObject===e.listenerObject}map(t){const{listenerObject:e,removedCallback:n}=t,i=o=>{e.handleEvent(o)},r=()=>{this.remove(t),n&&n()};return this.source.addListener(i,r),{listener:i,listenerObject:e,removedCallback:r}}onRemoved(t){this.source.removeListener(t.listener),t.removedCallback()}}class ss{constructor(t){a(this,"listenerObjectCollection");this.source=t,this.listenerObjectCollection=new rs(t)}addListener(t,e){se(t)?this.listenerObjectCollection.add({listenerObject:t,removedCallback:e}):this.source.addListener(t,e)}removeListener(t){se(t)?this.listenerObjectCollection.remove({listenerObject:t}):this.source.removeListener(t)}}function Yn(s){return new ss(s)}function os(s,t,e){se(t),s.addListener(t,e)}function as(s,t,e){se(t),s.removeListener(t,e)}function cs(s){const t=ot(s,e=>n=>{e(n),t.removeListener(e)});return t}function hs(s,t){return ot(s,e=>n=>{e.apply(t,[n])})}class ls{constructor(t){a(this,"firstDispatcher",new tt);a(this,"secondDispatcher",new tt);a(this,"sourceListener");a(this,"numberOfListeners",0);this.source=t,this.sourceListener=e=>this.dispatchEvent(e)}add(){this.numberOfListeners===0&&this.source.addListener(this.sourceListener),this.numberOfListeners++}remove(){this.numberOfListeners--,this.numberOfListeners===0&&this.source.removeListener(this.sourceListener)}dispatchEvent(t){this.firstDispatcher.dispatch(t),this.secondDispatcher.dispatch(t)}build(){return{first:ot(this.firstDispatcher,(t,e)=>(this.add(),e(()=>this.remove()),t)),second:ot(this.secondDispatcher,(t,e)=>(this.add(),e(()=>this.remove()),t))}}}function Xn(s){return new ls(s).build()}function K(s,t){return ot(s,e=>n=>{t(n)&&e(n)})}class Un{constructor(t,e){a(this,"_onceSource");a(this,"source");t=hs(t,e),this._onceSource=Yn(cs(t)),this.source=Yn(t)}addListener(t,e){e&&e.once?this._onceSource.addListener(t):this.source.addListener(t)}removeListener(t){this.source.removeListener(t),this._onceSource.removeListener(t)}}class us{constructor(t,e){a(this,"wrappedOnEventHandler");a(this,"onEventHandler");this.captureSource=t,this.bubbleSource=e}get on(){return this.onEventHandler}set on(t){t?(this.wrappedOnEventHandler=function(e){return t.apply(this,[e])},this.onEventHandler=t,this.bubbleSource.addListener(this.wrappedOnEventHandler)):(this.bubbleSource.removeListener(this.wrappedOnEventHandler),this.wrappedOnEventHandler=null,this.onEventHandler=null)}addListener(t,e){const n=e&&(typeof e=="boolean"?void 0:e);(typeof e=="boolean"?e:e&&e.capture)?this.captureSource.addListener(t,n):this.bubbleSource.addListener(t,n)}removeListener(t,e){(typeof e=="boolean"?e:e&&e.capture)?this.captureSource.removeListener(t):this.bubbleSource.removeListener(t)}}function ds(s,t,e){return new us(new Un(s,e),new Un(t,e))}function at(s,t,e,n){const i=$(K(s,o=>!o.immediatePropagationStopped),o=>o.getResultEvent(e.rectangle)),r=$(K(t,o=>!o.propagationStopped&&!o.immediatePropagationStopped),o=>o.getResultEvent(e.rectangle));return ds(i,r,n)}function ct(s){const{first:t,second:e}=Xn(s),{first:n,second:i}=Xn(e);return{captureSource:t,bubbleSource:n,afterBubble:i}}function fs(s,t,e){const{captureSource:n,bubbleSource:i}=ct(s);return at(n,i,t,e)}class ke{constructor(t,e){a(this,"cache");this.rectangleManager=t,this.infiniteCanvas=e,this.cache={}}map(t,e){return fs($(t,e),this.rectangleManager,this.infiniteCanvas)}setOn(t,e){if(e)this.cache[t]||(this.cache[t]=this.getEventSource(t)),this.cache[t].on=e;else{if(!this.cache[t])return;this.cache[t].on=null}}getOn(t){return this.cache[t]?this.cache[t].on:null}addEventListener(t,e,n){this.cache[t]||(this.cache[t]=this.getEventSource(t)),os(this.cache[t],e,n)}removeEventListener(t,e,n){this.cache[t]&&as(this.cache[t],e,n)}}class $n extends ke{getEventSource(t){return(!this.cache||!this.cache[t])&&(this.cache=this.createEvents()),this.cache[t]}}class Kn{constructor(t,e){a(this,"AT_TARGET",2);a(this,"BUBBLING_PHASE",3);a(this,"CAPTURING_PHASE",1);a(this,"NONE",0);this.canvasEvent=t,this.preventableDefault=e}get bubbles(){return!1}get isTrusted(){return!1}get eventPhase(){return Event.AT_TARGET}get cancelable(){return this.preventableDefault.cancelable}get defaultPrevented(){return this.preventableDefault.defaultPrevented}initEvent(t,e,n){}preventDefault(){this.preventableDefault.preventDefault()}stopImmediatePropagation(){this.canvasEvent.stopImmediatePropagation()}stopPropagation(){this.canvasEvent.stopPropagation()}}class He extends Kn{constructor(t,e,n){super(t,e),this.type=n}get cancelBubble(){return!1}get composed(){return!1}get currentTarget(){return null}get returnValue(){return!0}get srcElement(){return null}get target(){return null}get timeStamp(){return 0}composedPath(){return[]}}class jn{constructor(t){a(this,"resultEvent");a(this,"propagationStopped",!1);a(this,"immediatePropagationStopped",!1);this.preventableDefault=t}get infiniteCanvasDefaultPrevented(){return this.preventableDefault.infiniteCanvasDefaultPrevented}stopPropagation(){this.propagationStopped=!0}stopImmediatePropagation(){this.immediatePropagationStopped=!0}getResultEvent(t){return this.resultEvent||(this.resultEvent=this.createResultEvent(t)),this.resultEvent}}class gs{constructor(){a(this,"_defaultPrevented")}get defaultPrevented(){return this._defaultPrevented}get infiniteCanvasDefaultPrevented(){return this._defaultPrevented}get cancelable(){return!0}preventDefault(){this._defaultPrevented=!0}}class ms{get infiniteCanvasDefaultPrevented(){return!1}get defaultPrevented(){return!1}get cancelable(){return!1}preventDefault(){}}class Ve extends jn{constructor(t){super(t?new gs:new ms)}}class ps extends He{constructor(e,n){super(e,n,"draw");a(this,"transformation");a(this,"inverseTransformation");this.transformation=e.transformation,this.inverseTransformation=e.inverseTransformation}}class vs extends Ve{constructor(){super(!1);a(this,"transformation");a(this,"inverseTransformation")}createResultEvent(e){return this.transformation=mt(e.infiniteCanvasContext.inverseBase),this.inverseTransformation=mt(e.infiniteCanvasContext.base),new ps(this,this.preventableDefault)}}class ws extends $n{constructor(t,e,n){super(e,n),this.drawingIterationProvider=t}createEvents(){return{draw:this.map(this.drawingIterationProvider.drawHappened,()=>new vs)}}}class Ps extends He{constructor(e,n,i){super(e,n,i);a(this,"transformation");a(this,"inverseTransformation");this.transformation=e.transformation,this.inverseTransformation=e.inverseTransformation}}class Me extends Ve{constructor(e){super(!1);a(this,"transformation");a(this,"inverseTransformation");this.type=e}createResultEvent(e){return this.transformation=mt(e.infiniteCanvasContext.inverseBase),this.inverseTransformation=mt(e.infiniteCanvasContext.base),new Ps(this,this.preventableDefault,this.type)}}class Cs extends $n{constructor(t,e,n){super(e,n),this.transformer=t}createEvents(){return{transformationstart:this.map(this.transformer.transformationStart,()=>new Me("transformationstart")),transformationchange:this.map(this.transformer.transformationChange,()=>new Me("transformationchange")),transformationend:this.map(this.transformer.transformationEnd,()=>new Me("transformationend"))}}}function M(s,t){return{addListener(e){s.addEventListener(t,e)},removeListener(e){s.removeEventListener(t,e)}}}class Is{constructor(t){this.event=t}get infiniteCanvasDefaultPrevented(){return!1}get nativeDefaultPrevented(){return this.event.defaultPrevented}get nativeCancelable(){return this.event.cancelable}get defaultPrevented(){return this.event.defaultPrevented}get cancelable(){return this.event.cancelable}preventDefault(){this.event.preventDefault()}}class Ts{constructor(t){a(this,"_defaultPrevented");this.event=t}get infiniteCanvasDefaultPrevented(){return this._defaultPrevented}get nativeDefaultPrevented(){return this.event.defaultPrevented}get nativeCancelable(){return this.event.cancelable}get defaultPrevented(){return this._defaultPrevented}get cancelable(){return!0}preventDefault(t){this._defaultPrevented=!0,t&&this.event.preventDefault()}}class pt extends jn{constructor(t,e){super(e?new Ts(t):new Is(t)),this.event=t}stopPropagation(){super.stopPropagation(),this.event&&this.event.stopPropagation()}stopImmediatePropagation(){super.stopImmediatePropagation(),this.event&&this.event.stopImmediatePropagation()}}class ht{constructor(t,e,n,i){this.offsetX=t,this.offsetY=e,this.movementX=n,this.movementY=i}toInfiniteCanvasCoordinates(t){const{x:e,y:n}=t.infiniteCanvasContext.inverseBase.apply(new h(this.offsetX,this.offsetY)),{x:i,y:r}=t.infiniteCanvasContext.inverseBase.untranslated().apply(new h(this.movementX,this.movementY));return new ht(e,n,i,r)}static create(t){return new ht(t.offsetX,t.offsetY,t.movementX,t.movementY)}}class Ss extends Kn{constructor(t,e,n){super(t,e),this.event=n}get nativeDefaultPrevented(){return this.preventableDefault.nativeDefaultPrevented}get nativeCancelable(){return this.preventableDefault.nativeCancelable}get cancelBubble(){return this.event.cancelBubble}get composed(){return this.event.composed}get currentTarget(){return this.event.currentTarget}get returnValue(){return this.event.returnValue}get srcElement(){return this.event.srcElement}get target(){return this.event.target}get timeStamp(){return this.event.timeStamp}get type(){return this.event.type}preventDefault(t){this.preventableDefault.preventDefault(t)}composedPath(){return this.event.composedPath()}}class Qn extends Ss{get detail(){return this.event.detail}get view(){return this.event.view}get which(){return this.event.which}initUIEvent(t,e,n,i,r){}}class oe extends Qn{constructor(e,n,i,r){super(e,n,i);a(this,"offsetX");a(this,"offsetY");a(this,"movementX");a(this,"movementY");this.offsetX=r.offsetX,this.offsetY=r.offsetY,this.movementX=r.movementX,this.movementY=r.movementY}get altKey(){return this.event.altKey}get button(){return this.event.button}get buttons(){return this.event.buttons}get clientX(){return this.event.clientX}get clientY(){return this.event.clientY}get ctrlKey(){return this.event.ctrlKey}get metaKey(){return this.event.metaKey}get pageX(){return this.event.pageX}get pageY(){return this.event.pageY}get relatedTarget(){return this.event.relatedTarget}get screenX(){return this.event.screenX}get screenY(){return this.event.screenY}get shiftKey(){return this.event.shiftKey}get x(){return this.event.x}get y(){return this.event.y}getModifierState(e){return this.event.getModifierState(e)}initMouseEvent(e,n,i,r,o,c,u,l,f,d,m,P,C,x,B){}}class Ne extends pt{constructor(e,n){super(e,n);a(this,"props");this.props=ht.create(e)}createResultEvent(e){return new oe(this,this.preventableDefault,this.event,this.props.toInfiniteCanvasCoordinates(e))}}class ae extends ht{constructor(t,e,n,i,r,o){super(t,e,n,i),this.width=r,this.height=o}toInfiniteCanvasCoordinates(t){const{offsetX:e,offsetY:n,movementX:i,movementY:r}=super.toInfiniteCanvasCoordinates(t),{x:o,y:c}=t.infiniteCanvasContext.inverseBase.untranslated().apply(new h(this.width,this.height));return new ae(e,n,i,r,o,c)}static create(t){const{offsetX:e,offsetY:n,movementX:i,movementY:r}=super.create(t);return new ae(e,n,i,r,t.width,t.height)}}class ys extends oe{constructor(e,n,i,r){super(e,n,i,r);a(this,"width");a(this,"height")}get isPrimary(){return this.event.isPrimary}get pointerId(){return this.event.pointerId}get pointerType(){return this.event.pointerType}get pressure(){return this.event.pressure}get tangentialPressure(){return this.event.tangentialPressure}get tiltX(){return this.event.tiltX}get tiltY(){return this.event.tiltY}get twist(){return this.event.twist}getCoalescedEvents(){return console.warn("`PointerEvent.getCoalescedEvents()` is currently not supported by InfiniteCanvas"),[]}getPredictedEvents(){return console.warn("`PointerEvent.getPredictedEvents()` is currently not supported by InfiniteCanvas"),[]}}class vt extends pt{constructor(e,n){super(e,n);a(this,"props");this.props=ae.create(e)}createResultEvent(e){return new ys(this,this.preventableDefault,this.event,this.props.toInfiniteCanvasCoordinates(e))}}class xs{constructor(t,e){a(this,"current");this.initial=t,this.cancel=e,this.current=t}}class bs{constructor(t){a(this,"moveEventDispatcher",new tt);a(this,"_fixedOnInfiniteCanvas",!1);this.point=t}get fixedOnInfiniteCanvas(){return this._fixedOnInfiniteCanvas}removeHandler(t){this.moveEventDispatcher.removeListener(t)}moveTo(t,e){const n=new h(t,e);this.point=n,this.moveEventDispatcher.dispatch(n)}onMoved(t,e){let n;this._fixedOnInfiniteCanvas=e;const i=r=>{n.current=r,t()};return this.moveEventDispatcher.addListener(i),n=new xs(this.point,()=>(this.removeHandler(i),this._fixedOnInfiniteCanvas=!1,this)),n}}class Os{constructor(t){a(this,"_touchId");a(this,"_defaultPrevented",!1);a(this,"anchor");this.pointerEvent=t,this.anchor=new bs(new h(t.offsetX,t.offsetY))}get defaultPrevented(){return this._defaultPrevented}get touchId(){return this._touchId}get pointerId(){return this.pointerEvent.pointerId}preventDefault(){this._defaultPrevented=!0}setTouchId(t){this._touchId=t}updatePointerEvent(t){this.pointerEvent=t,this.anchor.moveTo(t.offsetX,t.offsetY)}}class Ls{constructor(){a(this,"anchors",[])}find(t){return this.anchors.find(t)}getAll(t){return this.anchors.filter(t)}getAnchorForTouch(t){return this.anchors.find(e=>e.touchId===t)}addAnchorForPointerEvent(t){const e=new Os(t);this.anchors.push(e)}updateAnchorForPointerEvent(t){const e=this.getAnchorForPointerEvent(t);if(!e){this.addAnchorForPointerEvent(t);return}e.updatePointerEvent(t)}getAnchorForPointerEvent(t){return this.anchors.find(e=>e.pointerId===t.pointerId)}removeAnchor(t){const e=this.anchors.findIndex(n=>n===t);e>-1&&this.anchors.splice(e,1)}}class ce extends ht{constructor(t,e,n,i,r,o){super(t,e,n,i),this.deltaX=r,this.deltaY=o}toInfiniteCanvasCoordinates(t){const{offsetX:e,offsetY:n,movementX:i,movementY:r}=super.toInfiniteCanvasCoordinates(t),{x:o,y:c}=t.infiniteCanvasContext.inverseBase.untranslated().apply(new h(this.deltaX,this.deltaY));return new ce(e,n,i,r,o,c)}static create(t){const{offsetX:e,offsetY:n,movementX:i,movementY:r}=super.create(t);return new ce(e,n,i,r,t.deltaX,t.deltaY)}}class Bs extends oe{constructor(e,n,i,r){super(e,n,i,r);a(this,"deltaX");a(this,"deltaY");a(this,"DOM_DELTA_LINE",1);a(this,"DOM_DELTA_PAGE",2);a(this,"DOM_DELTA_PIXEL",0);this.deltaX=r.deltaX,this.deltaY=r.deltaY}get deltaMode(){return this.event.deltaMode}get deltaZ(){return this.event.deltaZ}}class As extends pt{constructor(e,n){super(e,n);a(this,"props");this.props=ce.create(e)}createResultEvent(e){return new Bs(this,this.preventableDefault,this.event,this.props.toInfiniteCanvasCoordinates(e))}}function wt(s,t){const e=[];for(let n=0;n<s.length;n++){const i=s[n];(!t||t(i))&&e.push(i)}return e}class he{constructor(t,e,n,i,r,o){this.x=t,this.y=e,this.radiusX=n,this.radiusY=i,this.rotationAngle=r,this.identifier=o}toInfiniteCanvasCoordinates(t){const e=t.infiniteCanvasContext.inverseBase,{x:n,y:i}=e.apply(new h(this.x,this.y)),r=this.radiusX*e.scale,o=this.radiusY*e.scale,c=this.rotationAngle+e.getRotationAngle();return new he(n,i,r,o,c,this.identifier)}static create(t,e){const{x:n,y:i}=e.getCSSPosition(t.clientX,t.clientY);return new he(n,i,t.radiusX,t.radiusY,t.rotationAngle,t.identifier)}}class Jn{constructor(){a(this,"translatedProps",[]);a(this,"createdProps",[])}toInfiniteCanvasCoordinates(t,e){let n=this.translatedProps.find(i=>i.identifier===t.identifier);return n||(n=t.toInfiniteCanvasCoordinates(e),this.translatedProps.push(n),n)}createProps(t,e){let n=this.createdProps.find(i=>i.identifier===t.identifier);return n||(n=he.create(t,e),this.createdProps.push(n),n)}dispose(){this.translatedProps.splice(0,this.translatedProps.length),this.createdProps.splice(0,this.createdProps.length)}}class le{constructor(t,e,n){this.targetTouches=t,this.changedTouches=e,this.touches=n}toInfiniteCanvasCoordinates(t){const e=new Jn,n=new le(this.targetTouches.map(i=>e.toInfiniteCanvasCoordinates(i,t)),this.changedTouches.map(i=>e.toInfiniteCanvasCoordinates(i,t)),this.touches.map(i=>e.toInfiniteCanvasCoordinates(i,t)));return e.dispose(),n}static create(t,e,n){const i=new Jn,r=e.map(c=>i.createProps(c,t)),o=n.map(c=>i.createProps(c,t));return i.dispose(),new le(r,o,r)}}class Ds{constructor(t,e){a(this,"infiniteCanvasX");a(this,"infiniteCanvasY");a(this,"radiusX");a(this,"radiusY");a(this,"rotationAngle");this.touch=t,this.infiniteCanvasX=e.x,this.infiniteCanvasY=e.y,this.radiusX=e.radiusX,this.radiusY=e.radiusY,this.rotationAngle=e.rotationAngle}get clientX(){return this.touch.clientX}get clientY(){return this.touch.clientY}get force(){return this.touch.force}get identifier(){return this.touch.identifier}get pageX(){return this.touch.pageX}get pageY(){return this.touch.pageY}get screenX(){return this.touch.screenX}get screenY(){return this.touch.screenY}get target(){return this.touch.target}}class Es extends Array{item(t){return this[t]}}function Rs(s,t){const e=s.length;for(let n=0;n<e;n++){const i=s[n];if(i.identifier===t)return i}}function Fs(s,t){for(let e of s){const n=Rs(e,t);if(n)return n}}function ze(s,t){const e=[];for(const n of t){const i=Fs(s,n.identifier);i&&e.push(new Ds(i,n))}return new Es(...e)}class Ws extends Qn{constructor(e,n,i,r){super(e,n,i);a(this,"touches");a(this,"targetTouches");a(this,"changedTouches");this.touches=ze([i.touches],r.touches),this.targetTouches=ze([i.touches],r.targetTouches),this.changedTouches=ze([i.touches,i.changedTouches],r.changedTouches)}get altKey(){return this.event.altKey}get ctrlKey(){return this.event.ctrlKey}get metaKey(){return this.event.metaKey}get shiftKey(){return this.event.shiftKey}}class Lt extends pt{constructor(t,e,n){super(t,n),this.props=e}createResultEvent(t){return new Ws(this,this.preventableDefault,this.event,this.props.toInfiniteCanvasCoordinates(t))}static create(t,e,n,i,r){const o=le.create(t,n,i);return new Lt(e,o,r)}}class Zn{constructor(t,e){this.source=t,this.listener=e,t.addListener(e)}remove(){this.source.removeListener(this.listener)}}class ks{constructor(t,e,n,i){a(this,"subscription");a(this,"otherSubscription");this.listener=n,this.onRemoved=i;let r;this.otherSubscription=new Zn(e,o=>{r=o}),this.subscription=new Zn(t,o=>{n([o,r])})}remove(){this.subscription.remove(),this.otherSubscription.remove(),this.onRemoved&&this.onRemoved()}}class Hs extends xt{constructor(t,e){super(),this.source=t,this.otherSource=e}map(t){return new ks(this.source,this.otherSource,t.listener,t.onRemoved)}mapsTo(t,e){return t.listener===e.listener}onRemoved(t){t.remove()}addListener(t,e){this.add({listener:t,onRemoved:e})}removeListener(t){this.remove({listener:t})}}function qe(s,t){return new Hs(s,t)}function Vs(s,t){for(let e=0;e<s.length;e++){const n=s[e];if(t(n))return!0}return!1}function Ms(s,t){return ot(s,e=>{let n=!1;const i=[];function r(){n||i.length===0||(n=!0,t(i.shift()).addListener(e,()=>{n=!1,r()}))}return o=>{i.push(o),r()}})}class Ns{constructor(t){this.sequence=t}addListener(t,e){for(const n of this.sequence)t(n);e&&e()}removeListener(t){}}function zs(s){return new Ns(s)}class _n extends Ve{constructor(t){super(!0),this.type=t}createResultEvent(){return new He(this,this.preventableDefault,this.type)}}class qs extends ke{constructor(e,n,i,r,o){super(i,r);a(this,"anchorSet");this.transformer=n,this.config=o,this.anchorSet=new Ls;const c=M(e,"pointerdown"),u=M(e,"pointerleave"),l=M(e,"pointermove"),f=M(e,"pointerup"),d=M(e,"pointercancel"),m=K(M(e,"touchmove"),g=>Vs(g.targetTouches,A=>!this.hasFixedAnchorForTouch(A.identifier)));c.addListener(g=>this.anchorSet.updateAnchorForPointerEvent(g)),l.addListener(g=>this.anchorSet.updateAnchorForPointerEvent(g)),f.addListener(g=>this.removePointer(g)),u.addListener(g=>this.removePointer(g));const P=$(M(e,"mousedown"),g=>new Ne(g,!0)),C=$(M(e,"wheel"),g=>new As(g,!0)),x=$(M(e,"touchstart"),g=>{const A=wt(g.targetTouches),Q=wt(g.changedTouches);return Lt.create(this.rectangleManager.rectangle,g,A,Q,!0)}),B=$(c,g=>new vt(g,!0)),{captureSource:G,bubbleSource:et,afterBubble:nt}=ct(B),{captureSource:Dt,bubbleSource:Et,afterBubble:Rt}=ct(P),{captureSource:Xe,bubbleSource:Ue,afterBubble:$e}=ct(x),{captureSource:Ke,bubbleSource:ue,afterBubble:ni}=ct(C),_s=$(K(ni,g=>!this.config.greedyGestureHandling&&!g.event.ctrlKey&&!g.infiniteCanvasDefaultPrevented),()=>new _n("wheelignored")),{captureSource:to,bubbleSource:eo,afterBubble:no}=ct(_s);ni.addListener(g=>{g.infiniteCanvasDefaultPrevented||this.zoom(g.event)}),no.addListener(g=>{g.infiniteCanvasDefaultPrevented||console.warn("use ctrl + scroll to zoom")}),qe(Rt,nt).addListener(([g,A])=>{!g.infiniteCanvasDefaultPrevented&&!A.infiniteCanvasDefaultPrevented&&this.transformUsingPointer(g.event,A.event)});const io=K($e,g=>g.event.changedTouches.length===1),ii=qe(io,nt);ii.addListener(([g,A])=>{const Q=g.event.changedTouches[0],it=this.anchorSet.getAnchorForPointerEvent(A.event);if(it)if(it.setTouchId(Q.identifier),!g.infiniteCanvasDefaultPrevented&&!A.infiniteCanvasDefaultPrevented)if(this.config.greedyGestureHandling)this.rectangleManager.measure(),this.transformer.addAnchor(it.anchor),g.event.preventDefault();else{const si=this.anchorSet.find(je=>je.touchId!==void 0&&je!==it&&!je.defaultPrevented);if(!si)return;this.rectangleManager.measure(),this.transformer.addAnchor(si.anchor),this.transformer.addAnchor(it.anchor),g.event.preventDefault()}else it.preventDefault()});const ri=K(qe(d,ii),([g,[A,Q]])=>g.pointerId===Q.event.pointerId);ri.addListener(([g])=>{this.removePointer(g)});const ro=$(K(ri,([g,[A,Q]])=>!this.config.greedyGestureHandling&&!A.infiniteCanvasDefaultPrevented&&!Q.infiniteCanvasDefaultPrevented),()=>new _n("touchignored")),{captureSource:so,bubbleSource:oo,afterBubble:ao}=ct(ro);ao.addListener(g=>{g.infiniteCanvasDefaultPrevented||console.warn("use two fingers to move")}),this.cache={mousemove:this.map(K(M(e,"mousemove"),()=>!this.mouseAnchorIsFixed()),g=>new Ne(g)),mousedown:at(Dt,Et,i,r),pointerdown:at(G,et,i,r),pointermove:this.map(Ms(K(l,()=>this.hasNonFixedAnchorForSomePointer()),()=>zs(this.anchorSet.getAll(g=>!g.anchor.fixedOnInfiniteCanvas).map(g=>g.pointerEvent))),g=>new vt(g)),pointerleave:this.map(u,g=>new vt(g)),pointerup:this.map(f,g=>new vt(g)),pointercancel:this.map(d,g=>new vt(g)),wheel:at(Ke,ue,i,r),wheelignored:at(to,eo,i,r),touchstart:at(Xe,Ue,i,r),touchignored:at(so,oo,i,r),touchmove:this.map(m,g=>{const A=wt(g.targetTouches),Q=wt(g.targetTouches,it=>!this.hasFixedAnchorForTouch(it.identifier));return Lt.create(this.rectangleManager.rectangle,g,A,Q)})}}getEventSource(e){return this.cache[e]}mouseAnchorIsFixed(){const e=this.anchorSet.find(n=>n.pointerEvent.pointerType==="mouse");return e?e.anchor.fixedOnInfiniteCanvas:!1}hasFixedAnchorForTouch(e){const n=this.anchorSet.getAnchorForTouch(e);return!!n&&n.anchor.fixedOnInfiniteCanvas}hasNonFixedAnchorForSomePointer(){return!!this.anchorSet.find(e=>!e.anchor.fixedOnInfiniteCanvas)}transformUsingPointer(e,n){this.rectangleManager.measure();const i=this.anchorSet.getAnchorForPointerEvent(n);i&&(n.button===1&&this.config.rotationEnabled?(e.preventDefault(),this.transformer.addRotationAnchor(i.anchor)):n.button===0&&this.transformer.addAnchor(i.anchor))}removePointer(e){const n=this.anchorSet.getAnchorForPointerEvent(e);n&&(this.transformer.releaseAnchor(n.anchor),this.anchorSet.removeAnchor(n))}zoom(e){if(!this.config.greedyGestureHandling&&!e.ctrlKey)return;const{offsetX:n,offsetY:i}=e;let r=e.deltaY;const o=Math.pow(2,-r/300);this.rectangleManager.measure(),this.transformer.zoom(n,i,o),e.preventDefault()}}class Gs{constructor(t,e){this.handledOrFilteredEventCollection=t,this.mappingCollection=e}setOn(t,e){te(t)?this.handledOrFilteredEventCollection.setOn(t,e):this.mappingCollection.setOn(t,e)}getOn(t){return te(t)?this.handledOrFilteredEventCollection.getOn(t):this.mappingCollection.getOn(t)}addEventListener(t,e,n){te(t)?this.handledOrFilteredEventCollection.addEventListener(t,e,n):this.mappingCollection.addEventListener(t,e,n)}removeEventListener(t,e,n){te(t)?this.handledOrFilteredEventCollection.removeEventListener(t,e,n):this.mappingCollection.removeEventListener(t,e,n)}}class Ys{constructor(t,e,n,i){this.mappedMouseEventCollection=t,this.mappedTouchEventCollection=e,this.mappedOnlyPointerEventCollection=n,this.mappedDragEventCollection=i}setOn(t,e){ee(t)?this.mappedMouseEventCollection.setOn(t,e):re(t)?this.mappedTouchEventCollection.setOn(t,e):ne(t)?this.mappedOnlyPointerEventCollection.setOn(t,e):ie(t)&&this.mappedDragEventCollection.setOn(t,e)}getOn(t){if(ee(t))return this.mappedMouseEventCollection.getOn(t);if(re(t))return this.mappedTouchEventCollection.getOn(t);if(ne(t))return this.mappedOnlyPointerEventCollection.getOn(t);if(ie(t))return this.mappedDragEventCollection.getOn(t)}addEventListener(t,e,n){ee(t)?this.mappedMouseEventCollection.addEventListener(t,e,n):re(t)?this.mappedTouchEventCollection.addEventListener(t,e,n):ne(t)?this.mappedOnlyPointerEventCollection.addEventListener(t,e,n):ie(t)&&this.mappedDragEventCollection.addEventListener(t,e,n)}removeEventListener(t,e,n){ee(t)?this.mappedMouseEventCollection.removeEventListener(t,e,n):re(t)?this.mappedTouchEventCollection.removeEventListener(t,e,n):ne(t)?this.mappedOnlyPointerEventCollection.removeEventListener(t,e,n):ie(t)&&this.mappedDragEventCollection.removeEventListener(t,e,n)}}class Bt extends ke{constructor(t,e,n,i){super(n,i),this.canvasEl=t,this.createInternalEvent=e,this.cache={}}getEventSource(t){return this.cache[t]||(this.cache[t]=this.createEventSource(t)),this.cache[t]}createEventSource(t){return this.map(M(this.canvasEl,t),e=>this.createInternalEvent(e))}}class Xs extends oe{get dataTransfer(){return this.event.dataTransfer}}class Us extends pt{constructor(e,n){super(e,n);a(this,"props");this.props=ht.create(e)}createResultEvent(e){return new Xs(this,this.preventableDefault,this.event,this.props.toInfiniteCanvasCoordinates(e))}}class $s extends pt{createResultEvent(){return this.event}}class Ge{constructor(t,e,n,i){this.drawEventCollection=t,this.transformationEventCollection=e,this.pointerEventCollection=n,this.unmappedEventCollection=i}setOn(t,e){t==="draw"?this.drawEventCollection.setOn("draw",e):Zt(t)?this.transformationEventCollection.setOn(t,e):_t(t)?this.pointerEventCollection.setOn(t,e):this.unmappedEventCollection.setOn(t,e)}getOn(t){return t==="draw"?this.drawEventCollection.getOn("draw"):Zt(t)?this.transformationEventCollection.getOn(t):_t(t)?this.pointerEventCollection.getOn(t):this.unmappedEventCollection.getOn(t)}addEventListener(t,e,n){t==="draw"?this.drawEventCollection.addEventListener("draw",e,n):Zt(t)?this.transformationEventCollection.addEventListener(t,e,n):_t(t)?this.pointerEventCollection.addEventListener(t,e,n):this.unmappedEventCollection.addEventListener(t,e,n)}removeEventListener(t,e,n){t==="draw"?this.drawEventCollection.removeEventListener("draw",e,n):Zt(t)?this.transformationEventCollection.removeEventListener(t,e,n):_t(t)?this.pointerEventCollection.removeEventListener(t,e,n):this.unmappedEventCollection.removeEventListener(t,e,n)}static create(t,e,n,i,r,o){const c=new ws(o,n,i),u=new Cs(e,n,i),l=new qs(t,e,n,i,r),f=new Gs(l,new Ys(new Bt(t,d=>new Ne(d),n,i),new Bt(t,d=>{const m=wt(d.targetTouches),P=wt(d.changedTouches);return Lt.create(n.rectangle,d,m,P)},n,i),new Bt(t,d=>new vt(d),n,i),new Bt(t,d=>new Us(d),n,i)));return new Ge(c,u,f,new Bt(t,d=>new $s(d),n,i))}}function Ks(s,t){let e=-1;const n=s.canvas.width;s.save(),s.fillStyle="#fff",s.fillRect(0,0,n,5),s.filter=`drop-shadow(${t} 0)`,s.fillRect(0,0,1,5);const r=s.getImageData(0,0,n,3).data;for(let o=0;o<n;o++){const c=4*(2*n+o);if(r[c]!==255){e=o;break}}return s.restore(),e}function js(s,t){const e=s.canvas.width;let n=1,i=1,r=-1;return f(),u(),o(),{numerator:n,denominator:i,pixels:r};function o(){let d=0;do{const m=r;if(c(),r===m)break;d++}while(d<10)}function c(){const d=e/(r+1);let m=r===0?d:Math.min((e-1)/r,d),P;for(;(P=Math.floor(m))<2;)m*=10,i*=10;n*=P,f(),l()}function u(){let d=0;for(;r===-1&&d<10;)i*=10,f(),d++;l()}function l(){if(r===-1)throw new Error(`something went wrong while getting measurement for unit '${t}' on canvas with width ${e}`)}function f(){r=Ks(s,`${n/i}${t}`)}}class Qs{constructor(t){a(this,"cache",{});this.ctx=t}getNumberOfPixels(t,e){if(t===0)return 0;if(e==="px")return t;let n=this.cache[e];return n||(n=js(this.ctx,e),this.cache[e]=n),t*n.pixels*n.denominator/n.numerator}}class Js{constructor(t){a(this,"dispatcher",new tt);a(this,"observer");a(this,"numberOfListeners",0);this.canvas=t}addListener(t,e){this.dispatcher.addListener(t,()=>{e==null||e(),this.numberOfListeners=Math.max(this.numberOfListeners-1,0),this.numberOfListeners===0&&this.disconnect()}),this.numberOfListeners++,this.connectIfNeeded()}removeListener(t){this.dispatcher.removeListener(t)}connectIfNeeded(){this.observer||(this.observer=new ResizeObserver(t=>this.dispatcher.dispatch(this.createCanvasMeasurement(t))),this.observer.observe(this.canvas))}createCanvasMeasurement([{contentRect:t}]){return{left:t.left,top:t.top,screenWidth:t.width,screenHeight:t.height,viewboxWidth:this.canvas.width,viewboxHeight:this.canvas.height}}disconnect(){this.observer&&(this.observer.disconnect(),this.observer=void 0)}}function ti(s){const{screenWidth:t,screenHeight:e}=s;return t>0&&e>0}class Zs{constructor(t,e,n){a(this,"currentlyVisible",!1);a(this,"listener");this.measurementProvider=t,this.resizes=e,this.viewBox=n}observe(){const t=this.measurementProvider.measure();this.currentlyVisible=ti(t);const e=n=>{const i=ti(n);i&&!this.currentlyVisible&&this.viewBox.draw(),this.currentlyVisible=i};this.resizes.addListener(e),this.listener=e}disconnect(){this.listener&&(this.resizes.removeListener(this.listener),this.listener=void 0)}}class Ye{constructor(t,e){a(this,"context");a(this,"viewBox");a(this,"config");a(this,"rectangleManager");a(this,"canvasResizes");a(this,"cssUnitsCanvasResizeListener");a(this,"canvasUnitsCanvasResizeObserver");a(this,"eventCollection");a(this,"cssLengthConverterFactory");this.canvas=t,this.config={rotationEnabled:!0,greedyGestureHandling:!1,units:b.CANVAS},e&&Object.assign(this.config,e);const n=new Js(t);this.canvasResizes=n,this.cssUnitsCanvasResizeListener=()=>{this.canvas.parentElement!==null&&this.viewBox.draw()};const i=new jr(new Kr),r=new Qr(i),o=new _r(t);this.rectangleManager=new Zr(o,this.config);let c;const u=t.getContext("2d");this.cssLengthConverterFactory={create:()=>new Qs(u)};const l=new Nr(this.rectangleManager,u,r,()=>r.getLock(),()=>c.isTransforming);this.viewBox=l,this.canvasUnitsCanvasResizeObserver=new Zs(o,n,l),c=new $r(this.viewBox,this.config),this.eventCollection=Ge.create(t,c,this.rectangleManager,this,this.config,i),this.config.units===b.CSS?this.canvasResizes.addListener(this.cssUnitsCanvasResizeListener):this.config.units===b.CANVAS&&this.canvasUnitsCanvasResizeObserver.observe()}setUnits(t){t===b.CSS&&this.config.units!==b.CSS&&(this.canvasUnitsCanvasResizeObserver.disconnect(),this.canvasResizes.addListener(this.cssUnitsCanvasResizeListener)),t===b.CANVAS&&this.config.units!==b.CANVAS&&(this.canvasResizes.removeListener(this.cssUnitsCanvasResizeListener),this.canvasUnitsCanvasResizeObserver.observe()),this.config.units=t,this.rectangleManager.measure(),this.viewBox.draw()}getContext(){return this.context||(this.context=new Dr(this.canvas,this.viewBox,this.cssLengthConverterFactory)),this.context}get transformation(){return mt(this.rectangleManager.rectangle.infiniteCanvasContext.inverseBase)}get inverseTransformation(){return mt(this.rectangleManager.rectangle.infiniteCanvasContext.base)}get rotationEnabled(){return this.config.rotationEnabled}set rotationEnabled(t){this.config.rotationEnabled=t}get units(){return this.config.units}set units(t){this.setUnits(t)}get greedyGestureHandling(){return this.config.greedyGestureHandling}set greedyGestureHandling(t){this.config.greedyGestureHandling=t}set ontransformationstart(t){this.eventCollection.setOn("transformationstart",t)}get ontransformationstart(){return this.eventCollection.getOn("transformationstart")}set ontransformationchange(t){this.eventCollection.setOn("transformationchange",t)}get ontransformationchange(){return this.eventCollection.getOn("transformationchange")}set ontransformationend(t){this.eventCollection.setOn("transformationend",t)}get ontransformationend(){return this.eventCollection.getOn("transformationend")}set ondraw(t){this.eventCollection.setOn("draw",t)}get ondraw(){return this.eventCollection.getOn("draw")}set onwheelignored(t){this.eventCollection.setOn("wheelignored",t)}get onwheelignored(){return this.eventCollection.getOn("wheelignored")}set ontouchignored(t){this.eventCollection.setOn("touchignored",t)}get ontouchignored(){return this.eventCollection.getOn("touchignored")}set onbeforeinput(t){this.eventCollection.setOn("beforeinput",t)}get onbeforeinput(){return this.eventCollection.getOn("beforeinput")}set oncancel(t){this.eventCollection.setOn("cancel",t)}get oncancel(){return this.eventCollection.getOn("cancel")}set oncopy(t){this.eventCollection.setOn("copy",t)}get oncopy(){return this.eventCollection.getOn("copy")}set oncut(t){this.eventCollection.setOn("cut",t)}get oncut(){return this.eventCollection.getOn("cut")}set onpaste(t){this.eventCollection.setOn("paste",t)}get onpaste(){return this.eventCollection.getOn("paste")}set onabort(t){this.eventCollection.setOn("abort",t)}get onabort(){return this.eventCollection.getOn("abort")}set onanimationcancel(t){this.eventCollection.setOn("animationcancel",t)}get onanimationcancel(){return this.eventCollection.getOn("animationcancel")}set onanimationend(t){this.eventCollection.setOn("animationend",t)}get onanimationend(){return this.eventCollection.getOn("animationend")}set onanimationiteration(t){this.eventCollection.setOn("animationiteration",t)}get onanimationiteration(){return this.eventCollection.getOn("animationiteration")}set onanimationstart(t){this.eventCollection.setOn("animationstart",t)}get onanimationstart(){return this.eventCollection.getOn("animationstart")}set onauxclick(t){this.eventCollection.setOn("auxclick",t)}get onauxclick(){return this.eventCollection.getOn("auxclick")}set onblur(t){this.eventCollection.setOn("blur",t)}get onblur(){return this.eventCollection.getOn("blur")}get oncanplay(){return this.eventCollection.getOn("canplay")}set oncanplay(t){this.eventCollection.setOn("canplay",t)}get oncanplaythrough(){return this.eventCollection.getOn("canplaythrough")}set oncanplaythrough(t){this.eventCollection.setOn("canplaythrough",t)}get onchange(){return this.eventCollection.getOn("change")}set onchange(t){this.eventCollection.setOn("change",t)}get onclick(){return this.eventCollection.getOn("click")}set onclick(t){this.eventCollection.setOn("click",t)}get onclose(){return this.eventCollection.getOn("close")}set onclose(t){this.eventCollection.setOn("close",t)}get oncontextmenu(){return this.eventCollection.getOn("contextmenu")}set oncontextmenu(t){this.eventCollection.setOn("contextmenu",t)}get oncuechange(){return this.eventCollection.getOn("cuechange")}set oncuechange(t){this.eventCollection.setOn("cuechange",t)}get ondblclick(){return this.eventCollection.getOn("dblclick")}set ondblclick(t){this.eventCollection.setOn("dblclick",t)}get onscrollend(){return this.eventCollection.getOn("scrollend")}set onscrollend(t){this.eventCollection.setOn("scrollend",t)}get ondrag(){return this.eventCollection.getOn("drag")}set ondrag(t){this.eventCollection.setOn("drag",t)}get ondragend(){return this.eventCollection.getOn("dragend")}set ondragend(t){this.eventCollection.setOn("dragend",t)}get ondragenter(){return this.eventCollection.getOn("dragenter")}set ondragenter(t){this.eventCollection.setOn("dragenter",t)}get onformdata(){return this.eventCollection.getOn("formdata")}set onformdata(t){this.eventCollection.setOn("formdata",t)}get onwebkitanimationend(){return this.eventCollection.getOn("webkitanimationend")}set onwebkitanimationend(t){this.eventCollection.setOn("webkitanimationend",t)}get onwebkitanimationstart(){return this.eventCollection.getOn("webkitanimationstart")}set onwebkitanimationstart(t){this.eventCollection.setOn("webkitanimationstart",t)}get onwebkitanimationiteration(){return this.eventCollection.getOn("webkitanimationiteration")}set onwebkitanimationiteration(t){this.eventCollection.setOn("webkitanimationiteration",t)}get onwebkittransitionend(){return this.eventCollection.getOn("webkittransitionend")}set onwebkittransitionend(t){this.eventCollection.setOn("webkittransitionend",t)}get onslotchange(){return this.eventCollection.getOn("slotchange")}set onslotchange(t){this.eventCollection.setOn("slotchange",t)}get ondragleave(){return this.eventCollection.getOn("dragleave")}set ondragleave(t){this.eventCollection.setOn("dragleave",t)}get ondragover(){return this.eventCollection.getOn("dragover")}set ondragover(t){this.eventCollection.setOn("dragover",t)}get ondragstart(){return this.eventCollection.getOn("dragstart")}set ondragstart(t){this.eventCollection.setOn("dragstart",t)}get ondrop(){return this.eventCollection.getOn("drop")}set ondrop(t){this.eventCollection.setOn("drop",t)}get ondurationchange(){return this.eventCollection.getOn("durationchange")}set ondurationchange(t){this.eventCollection.setOn("durationchange",t)}get onemptied(){return this.eventCollection.getOn("emptied")}set onemptied(t){this.eventCollection.setOn("emptied",t)}get onended(){return this.eventCollection.getOn("ended")}set onended(t){this.eventCollection.setOn("ended",t)}get onerror(){return this.eventCollection.getOn("error")}set onerror(t){this.eventCollection.setOn("error",t)}get onfocus(){return this.eventCollection.getOn("focus")}set onfocus(t){this.eventCollection.setOn("focus",t)}get ongotpointercapture(){return this.eventCollection.getOn("gotpointercapture")}set ongotpointercapture(t){this.eventCollection.setOn("gotpointercapture",t)}get oninput(){return this.eventCollection.getOn("input")}set oninput(t){this.eventCollection.setOn("input",t)}get oninvalid(){return this.eventCollection.getOn("invalid")}set oninvalid(t){this.eventCollection.setOn("invalid",t)}get onkeydown(){return this.eventCollection.getOn("keydown")}set onkeydown(t){this.eventCollection.setOn("keydown",t)}get onkeypress(){return this.eventCollection.getOn("keypress")}set onkeypress(t){this.eventCollection.setOn("keypress",t)}get onkeyup(){return this.eventCollection.getOn("keyup")}set onkeyup(t){this.eventCollection.setOn("keyup",t)}get onload(){return this.eventCollection.getOn("load")}set onload(t){this.eventCollection.setOn("load",t)}get onloadeddata(){return this.eventCollection.getOn("loadeddata")}set onloadeddata(t){this.eventCollection.setOn("loadeddata",t)}get onloadedmetadata(){return this.eventCollection.getOn("loadedmetadata")}set onloadedmetadata(t){this.eventCollection.setOn("loadedmetadata",t)}get onloadstart(){return this.eventCollection.getOn("loadstart")}set onloadstart(t){this.eventCollection.setOn("loadstart",t)}get onlostpointercapture(){return this.eventCollection.getOn("lostpointercapture")}set onlostpointercapture(t){this.eventCollection.setOn("lostpointercapture",t)}get onmousedown(){return this.eventCollection.getOn("mousedown")}set onmousedown(t){this.eventCollection.setOn("mousedown",t)}get onmouseenter(){return this.eventCollection.getOn("mouseenter")}set onmouseenter(t){this.eventCollection.setOn("mouseenter",t)}get onmouseleave(){return this.eventCollection.getOn("mouseleave")}set onmouseleave(t){this.eventCollection.setOn("mouseleave",t)}get onmousemove(){return this.eventCollection.getOn("mousemove")}set onmousemove(t){this.eventCollection.setOn("mousemove",t)}get onmouseout(){return this.eventCollection.getOn("mouseout")}set onmouseout(t){this.eventCollection.setOn("mouseout",t)}get onmouseover(){return this.eventCollection.getOn("mouseover")}set onmouseover(t){this.eventCollection.setOn("mouseover",t)}get onmouseup(){return this.eventCollection.getOn("mouseup")}set onmouseup(t){this.eventCollection.setOn("mouseup",t)}get onpause(){return this.eventCollection.getOn("pause")}set onpause(t){this.eventCollection.setOn("pause",t)}get onplay(){return this.eventCollection.getOn("play")}set onplay(t){this.eventCollection.setOn("play",t)}get onplaying(){return this.eventCollection.getOn("playing")}set onplaying(t){this.eventCollection.setOn("playing",t)}get onpointercancel(){return this.eventCollection.getOn("pointercancel")}set onpointercancel(t){this.eventCollection.setOn("pointercancel",t)}get onpointerdown(){return this.eventCollection.getOn("pointerdown")}set onpointerdown(t){this.eventCollection.setOn("pointerdown",t)}get onpointerenter(){return this.eventCollection.getOn("pointerenter")}set onpointerenter(t){this.eventCollection.setOn("pointerenter",t)}get onpointerleave(){return this.eventCollection.getOn("pointerleave")}set onpointerleave(t){this.eventCollection.setOn("pointerleave",t)}get onpointermove(){return this.eventCollection.getOn("pointermove")}set onpointermove(t){this.eventCollection.setOn("pointermove",t)}get onpointerout(){return this.eventCollection.getOn("pointerout")}set onpointerout(t){this.eventCollection.setOn("pointerout",t)}get onpointerover(){return this.eventCollection.getOn("pointerover")}set onpointerover(t){this.eventCollection.setOn("pointerover",t)}get onpointerup(){return this.eventCollection.getOn("pointerup")}set onpointerup(t){this.eventCollection.setOn("pointerup",t)}get onprogress(){return this.eventCollection.getOn("progress")}set onprogress(t){this.eventCollection.setOn("progress",t)}get onratechange(){return this.eventCollection.getOn("ratechange")}set onratechange(t){this.eventCollection.setOn("ratechange",t)}get onreset(){return this.eventCollection.getOn("reset")}set onreset(t){this.eventCollection.setOn("reset",t)}get onresize(){return this.eventCollection.getOn("resize")}set onresize(t){this.eventCollection.setOn("resize",t)}get onscroll(){return this.eventCollection.getOn("scroll")}set onscroll(t){this.eventCollection.setOn("scroll",t)}get onsecuritypolicyviolation(){return this.eventCollection.getOn("securitypolicyviolation")}set onsecuritypolicyviolation(t){this.eventCollection.setOn("securitypolicyviolation",t)}get onseeked(){return this.eventCollection.getOn("seeked")}set onseeked(t){this.eventCollection.setOn("seeked",t)}get onseeking(){return this.eventCollection.getOn("seeking")}set onseeking(t){this.eventCollection.setOn("seeking",t)}get onselect(){return this.eventCollection.getOn("select")}set onselect(t){this.eventCollection.setOn("select",t)}get onselectionchange(){return this.eventCollection.getOn("selectionchange")}set onselectionchange(t){this.eventCollection.setOn("selectionchange",t)}get onselectstart(){return this.eventCollection.getOn("selectstart")}set onselectstart(t){this.eventCollection.setOn("selectstart",t)}get onstalled(){return this.eventCollection.getOn("stalled")}set onstalled(t){this.eventCollection.setOn("stalled",t)}get onsubmit(){return this.eventCollection.getOn("submit")}set onsubmit(t){this.eventCollection.setOn("submit",t)}get onsuspend(){return this.eventCollection.getOn("suspend")}set onsuspend(t){this.eventCollection.setOn("suspend",t)}get ontimeupdate(){return this.eventCollection.getOn("timeupdate")}set ontimeupdate(t){this.eventCollection.setOn("timeupdate",t)}get ontoggle(){return this.eventCollection.getOn("toggle")}set ontoggle(t){this.eventCollection.setOn("toggle",t)}get ontouchcancel(){return this.eventCollection.getOn("touchcancel")}set ontouchcancel(t){this.eventCollection.setOn("touchcancel",t)}get ontouchend(){return this.eventCollection.getOn("touchend")}set ontouchend(t){this.eventCollection.setOn("touchend",t)}get ontouchmove(){return this.eventCollection.getOn("touchmove")}set ontouchmove(t){this.eventCollection.setOn("touchmove",t)}get ontouchstart(){return this.eventCollection.getOn("touchstart")}set ontouchstart(t){this.eventCollection.setOn("touchstart",t)}get ontransitioncancel(){return this.eventCollection.getOn("transitioncancel")}set ontransitioncancel(t){this.eventCollection.setOn("transitioncancel",t)}get ontransitionend(){return this.eventCollection.getOn("transitionend")}set ontransitionend(t){this.eventCollection.setOn("transitionend",t)}get ontransitionrun(){return this.eventCollection.getOn("transitionrun")}set ontransitionrun(t){this.eventCollection.setOn("transitionrun",t)}get ontransitionstart(){return this.eventCollection.getOn("transitionstart")}set ontransitionstart(t){this.eventCollection.setOn("transitionstart",t)}get onvolumechange(){return this.eventCollection.getOn("volumechange")}set onvolumechange(t){this.eventCollection.setOn("volumechange",t)}get onwaiting(){return this.eventCollection.getOn("waiting")}set onwaiting(t){this.eventCollection.setOn("waiting",t)}get onwheel(){return this.eventCollection.getOn("wheel")}set onwheel(t){this.eventCollection.setOn("wheel",t)}addEventListener(t,e,n){this.eventCollection.addEventListener(t,e,n)}removeEventListener(t,e,n){this.eventCollection.removeEventListener(t,e,n)}}a(Ye,"CANVAS_UNITS",b.CANVAS),a(Ye,"CSS_UNITS",b.CSS);const ei=Ye;return ei.Units=b,ei});
